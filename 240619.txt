# ë‚´ì¼ë°°ì›€ìº í”„ 240619 TIL
Java 47ì¼ì°¨
My Select Shop í”„ë¡œì íŠ¸(17~20)
-------------------------------------------------------------------------------



## 17. íšŒì›ê¸°ëŠ¥ êµ¬í˜„

- API êµ¬í˜„
    - íšŒì› DBì— ë§¤í•‘ë˜ëŠ” **@Entity í´ë˜ìŠ¤** êµ¬í˜„
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] User**
            
            ```java
            package com.sparta.myselectshop.entity;
            
            import jakarta.persistence.*;
            import lombok.Getter;
            import lombok.NoArgsConstructor;
            import lombok.Setter;
            
            @Entity
            @Getter
            @Setter
            @NoArgsConstructor
            @Table(name = "users")
            public class User {
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;
            
                @Column(nullable = false, unique = true)
                private String username;
            
                @Column(nullable = false)
                private String password;
            
                @Column(nullable = false, unique = true)
                private String email;
            
                @Column(nullable = false)
                @Enumerated(value = EnumType.STRING)
                private UserRoleEnum role;
            
                public User(String username, String password, String email, UserRoleEnum role) {
                    this.username = username;
                    this.password = password;
                    this.email = email;
                    this.role = role;
                }
            }
            ```
            
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] UserRoleEnum**
            
            ```java
            package com.sparta.myselectshop.entity;
            
            public enum UserRoleEnum {
                USER(Authority.USER),  // ì‚¬ìš©ì ê¶Œí•œ
                ADMIN(Authority.ADMIN);  // ê´€ë¦¬ì ê¶Œí•œ
            
                private final String authority;
            
                UserRoleEnum(String authority) {
                    this.authority = authority;
                }
            
                public String getAuthority() {
                    return this.authority;
                }
            
                public static class Authority {
                    public static final String USER = "ROLE_USER";
                    public static final String ADMIN = "ROLE_ADMIN";
                }
            }
            ```
            
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] UserController**
        
        ```java
        package com.sparta.myselectshop.controller;
        
        import com.sparta.myselectshop.dto.SignupRequestDto;
        import com.sparta.myselectshop.dto.UserInfoDto;
        import com.sparta.myselectshop.entity.UserRoleEnum;
        import com.sparta.myselectshop.security.UserDetailsImpl;
        import com.sparta.myselectshop.service.UserService;
        import jakarta.validation.Valid;
        import lombok.RequiredArgsConstructor;
        import lombok.extern.slf4j.Slf4j;
        import org.springframework.security.core.annotation.AuthenticationPrincipal;
        import org.springframework.stereotype.Controller;
        import org.springframework.validation.BindingResult;
        import org.springframework.validation.FieldError;
        import org.springframework.web.bind.annotation.GetMapping;
        import org.springframework.web.bind.annotation.PostMapping;
        import org.springframework.web.bind.annotation.RequestMapping;
        import org.springframework.web.bind.annotation.ResponseBody;
        
        import java.util.List;
        
        @Slf4j
        @Controller
        @RequiredArgsConstructor
        @RequestMapping("/api")
        public class UserController {
        
            private final UserService userService;
        
            @GetMapping("/user/login-page")
            public String loginPage() {
                return "login";
            }
        
            @GetMapping("/user/signup")
            public String signupPage() {
                return "signup";
            }
        
            @PostMapping("/user/signup")
            public String signup(@Valid SignupRequestDto requestDto, BindingResult bindingResult) {
                // Validation ì˜ˆì™¸ì²˜ë¦¬
                List<FieldError> fieldErrors = bindingResult.getFieldErrors();
                if(fieldErrors.size() > 0) {
                    for (FieldError fieldError : bindingResult.getFieldErrors()) {
                        log.error(fieldError.getField() + " í•„ë“œ : " + fieldError.getDefaultMessage());
                    }
                    return "redirect:/api/user/signup";
                }
        
                userService.signup(requestDto);
        
                return "redirect:/api/user/login-page";
            }
        
            // íšŒì› ê´€ë ¨ ì •ë³´ ë°›ê¸°
            @GetMapping("/user-info")
            @ResponseBody
            public UserInfoDto getUserInfo(@AuthenticationPrincipal UserDetailsImpl userDetails) {
                String username = userDetails.getUser().getUsername();
                UserRoleEnum role = userDetails.getUser().getRole();
                boolean isAdmin = (role == UserRoleEnum.ADMIN);
        
                return new UserInfoDto(username, isAdmin);
            }
        }
        ```
        
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] SignupRequestDto**
        
        ```java
        package com.sparta.myselectshop.dto;
        
        import jakarta.validation.constraints.Email;
        import jakarta.validation.constraints.NotBlank;
        import lombok.Getter;
        import lombok.Setter;
        
        @Getter
        @Setter
        public class SignupRequestDto {
            @NotBlank
            private String username;
            @NotBlank
            private String password;
            @Email
            @NotBlank
            private String email;
            private boolean admin = false;
            private String adminToken = "";
        }
        ```
        
    - íšŒì› ì •ë³´ ìš”ì²­ API DTO
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] UserInfoDto**
            
            ```java
            package com.sparta.myselectshop.dto;
            
            import lombok.AllArgsConstructor;
            import lombok.Getter;
            
            @Getter
            @AllArgsConstructor
            public class UserInfoDto {
                String username;
                boolean isAdmin;
            }
            ```
            
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] UserService**
        
        ```java
        package com.sparta.myselectshop.service;
        
        import com.sparta.myselectshop.dto.SignupRequestDto;
        import com.sparta.myselectshop.entity.User;
        import com.sparta.myselectshop.entity.UserRoleEnum;
        import com.sparta.myselectshop.repository.UserRepository;
        import lombok.RequiredArgsConstructor;
        import org.springframework.security.crypto.password.PasswordEncoder;
        import org.springframework.stereotype.Service;
        
        import java.util.Optional;
        
        @Service
        @RequiredArgsConstructor
        public class UserService {
        
            private final UserRepository userRepository;
            private final PasswordEncoder passwordEncoder;
        
            // ADMIN_TOKEN
            private final String ADMIN_TOKEN = "AAABnvxRVklrnYxKZ0aHgTBcXukeZygoC";
        
            public void signup(SignupRequestDto requestDto) {
                String username = requestDto.getUsername();
                String password = passwordEncoder.encode(requestDto.getPassword());
        
                // íšŒì› ì¤‘ë³µ í™•ì¸
                Optional<User> checkUsername = userRepository.findByUsername(username);
                if (checkUsername.isPresent()) {
                    throw new IllegalArgumentException("ì¤‘ë³µëœ ì‚¬ìš©ìê°€ ì¡´ì¬í•©ë‹ˆë‹¤.");
                }
        
                // email ì¤‘ë³µí™•ì¸
                String email = requestDto.getEmail();
                Optional<User> checkEmail = userRepository.findByEmail(email);
                if (checkEmail.isPresent()) {
                    throw new IllegalArgumentException("ì¤‘ë³µëœ Email ì…ë‹ˆë‹¤.");
                }
        
                // ì‚¬ìš©ì ROLE í™•ì¸
                UserRoleEnum role = UserRoleEnum.USER;
                if (requestDto.isAdmin()) {
                    if (!ADMIN_TOKEN.equals(requestDto.getAdminToken())) {
                        throw new IllegalArgumentException("ê´€ë¦¬ì ì•”í˜¸ê°€ í‹€ë ¤ ë“±ë¡ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
                    }
                    role = UserRoleEnum.ADMIN;
                }
        
                // ì‚¬ìš©ì ë“±ë¡
                User user = new User(username, password, email, role);
                userRepository.save(user);
            }
        }
        ```
        
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] UserRepository**
        
        ```java
        package com.sparta.myselectshop.repository;
        
        import com.sparta.myselectshop.entity.User;
        import org.springframework.data.jpa.repository.JpaRepository;
        
        import java.util.Optional;
        
        public interface UserRepository extends JpaRepository<User, Long> {
            Optional<User> findByUsername(String username);
            Optional<User> findByEmail(String email);
        }
        ```
        
    
    - íšŒì› ê¸°ëŠ¥ ë° JWT ì¸ì¦ ë°©ì‹ì˜ ë³€ê²½ìœ¼ë¡œ ì¸í•œ Client ì½”ë“œ ë³€ê²½
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] basic.js**
            
            ```jsx
            const host = 'http://' + window.location.host;
            let targetId;
            
            $(document).ready(function () {
                const auth = getToken();
            
                if (auth !== undefined && auth !== '') {
                    $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
                        jqXHR.setRequestHeader('Authorization', auth);
                    });
                } else {
                    window.location.href = host + '/api/user/login-page';
                    return;
                }
            
                $.ajax({
                    type: 'GET',
                    url: `/api/user-info`,
                    contentType: 'application/json',
                })
                    .done(function (res, status, xhr) {
                        const username = res.username;
                        const isAdmin = !!res.admin;
            
                        if (!username) {
                            window.location.href = '/api/user/login-page';
                            return;
                        }
            
                        $('#username').text(username);
                        if (isAdmin) {
                            $('#admin').text(true);
                            showProduct(true);
                        } else {
                            showProduct();
                        }
                    })
                    .fail(function (jqXHR, textStatus) {
                        logout();
                    });
            
                // id ê°€ query ì¸ ë…€ì„ ìœ„ì—ì„œ ì—”í„°ë¥¼ ëˆ„ë¥´ë©´ execSearch() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.
                $('#query').on('keypress', function (e) {
                    if (e.key == 'Enter') {
                        execSearch();
                    }
                });
                $('#close').on('click', function () {
                    $('#container').removeClass('active');
                })
                $('#close2').on('click', function () {
                    $('#container2').removeClass('active');
                })
                $('.nav div.nav-see').on('click', function () {
                    $('div.nav-see').addClass('active');
                    $('div.nav-search').removeClass('active');
            
                    $('#see-area').show();
                    $('#search-area').hide();
                })
                $('.nav div.nav-search').on('click', function () {
                    $('div.nav-see').removeClass('active');
                    $('div.nav-search').addClass('active');
            
                    $('#see-area').hide();
                    $('#search-area').show();
                })
            
                $('#see-area').show();
                $('#search-area').hide();
            })
            
            function numberWithCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            function execSearch() {
                /**
                 * ê²€ìƒ‰ì–´ input id: query
                 * ê²€ìƒ‰ê²°ê³¼ ëª©ë¡: #search-result-box
                 * ê²€ìƒ‰ê²°ê³¼ HTML ë§Œë“œëŠ” í•¨ìˆ˜: addHTML
                 */
                    // 1. ê²€ìƒ‰ì°½ì˜ ì…ë ¥ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                let query = $('#query').val();
            
                // 2. ê²€ìƒ‰ì°½ ì…ë ¥ê°’ì„ ê²€ì‚¬í•˜ê³ , ì…ë ¥í•˜ì§€ ì•Šì•˜ì„ ê²½ìš° focus.
                if (query == '') {
                    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    $('#query').focus();
                    return;
                }
                // 3. GET /api/search?query=${query} ìš”ì²­
                $.ajax({
                    type: 'GET',
                    url: `/api/search?query=${query}`,
                    success: function (response) {
                        $('#search-result-box').empty();
                        // 4. for ë¬¸ë§ˆë‹¤ itemDtoë¥¼ êº¼ë‚´ì„œ HTML ë§Œë“¤ê³  ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ì— ë¶™ì´ê¸°!
                        for (let i = 0; i < response.length; i++) {
                            let itemDto = response[i];
                            let tempHtml = addHTML(itemDto);
                            $('#search-result-box').append(tempHtml);
                        }
                    },
                    error(error, status, request) {
                        logout();
                    }
                })
            
            }
            
            function addHTML(itemDto) {
                /**
                 * class="search-itemDto" ì¸ ë…€ì„ì—ì„œ
                 * image, title, lprice, addProduct í™œìš©í•˜ê¸°
                 * ì°¸ê³ ) onclick='addProduct(${JSON.stringify(itemDto)})'
                 */
                return `<div class="search-itemDto">
                    <div class="search-itemDto-left">
                        <img src="${itemDto.image}" alt="">
                    </div>
                    <div class="search-itemDto-center">
                        <div>${itemDto.title}</div>
                        <div class="price">
                            ${numberWithCommas(itemDto.lprice)}
                            <span class="unit">ì›</span>
                        </div>
                    </div>
                    <div class="search-itemDto-right">
                        <img src="../images/icon-save.png" alt="" onclick='addProduct(${JSON.stringify(itemDto)})'>
                    </div>
                </div>`
            }
            
            function addProduct(itemDto) {
                /**
                 * modal ëœ¨ê²Œ í•˜ëŠ” ë²•: $('#container').addClass('active');
                 * dataë¥¼ ajaxë¡œ ì „ë‹¬í•  ë•ŒëŠ” ë‘ ê°€ì§€ê°€ ë§¤ìš° ì¤‘ìš”
                 * 1. contentType: "application/json",
                 * 2. data: JSON.stringify(itemDto),
                 */
            
                // 1. POST /api/products ì— ê´€ì‹¬ ìƒí’ˆ ìƒì„± ìš”ì²­
                $.ajax({
                    type: 'POST',
                    url: '/api/products',
                    contentType: 'application/json',
                    data: JSON.stringify(itemDto),
                    success: function (response) {
                        // 2. ì‘ë‹µ í•¨ìˆ˜ì—ì„œ modalì„ ëœ¨ê²Œ í•˜ê³ , targetId ë¥¼ reponse.id ë¡œ ì„¤ì •
                        $('#container').addClass('active');
                        targetId = response.id;
                    },
                    error(error, status, request) {
                        logout();
                    }
                });
            }
            
            function showProduct(isAdmin = false) {
                /**
                 * ê´€ì‹¬ìƒí’ˆ ëª©ë¡: #product-container
                 * ê²€ìƒ‰ê²°ê³¼ ëª©ë¡: #search-result-box
                 * ê´€ì‹¬ìƒí’ˆ HTML ë§Œë“œëŠ” í•¨ìˆ˜: addProductItem
                 */
            
                let dataSource = null;
            
                // admin ê³„ì •
                if (isAdmin) {
                    dataSource = `/api/admin/products`;
                } else {
                    dataSource = `/api/products`;
                }
            
                $.ajax({
                    type: 'GET',
                    url: dataSource,
                    contentType: 'application/json',
                    success: function (response) {
                        $('#product-container').empty();
                        for (let i = 0; i < response.length; i++) {
                            let product = response[i];
                            let tempHtml = addProductItem(product);
                            $('#product-container').append(tempHtml);
                        }
                    },
                    error(error, status, request) {
                        if (error.status === 403) {
                            $('html').html(error.responseText);
                            return;
                        }
                        logout();
                    }
                });
            }
            
            function addProductItem(product) {
                console.log(product)
                return `<div class="product-card">
                            <div onclick="window.location.href='${product.link}'">
                                <div class="card-header">
                                    <img src="${product.image}"
                                         alt="">
                                </div>
                                <div class="card-body">
                                    <div class="title">
                                        ${product.title}
                                    </div>
                                    <div class="lprice">
                                        <span>${numberWithCommas(product.lprice)}</span>ì›
                                    </div>
                                    <div class="isgood ${product.lprice > product.myprice ? 'none' : ''}">
                                        ìµœì €ê°€
                                    </div>
                                </div>
                            </div>
                        </div>`;
            }
            
            function setMyprice() {
                /**
                 * 1. idê°€ myprice ì¸ input íƒœê·¸ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                 * 2. ë§Œì•½ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë©´ alertë¥¼ ë„ìš°ê³  ì¤‘ë‹¨í•œë‹¤.
                 * 3. PUT /api/product/${targetId} ì— dataë¥¼ ì „ë‹¬í•œë‹¤.
                 *    ì£¼ì˜) contentType: "application/json",
                 *         data: JSON.stringify({myprice: myprice}),
                 *         ë¹ ëœ¨ë¦¬ì§€ ë§ ê²ƒ!
                 * 4. ëª¨ë‹¬ì„ ì¢…ë£Œí•œë‹¤. $('#container').removeClass('active');
                 * 5, ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” alertë¥¼ ë„ìš´ë‹¤.
                 * 6. ì°½ì„ ìƒˆë¡œê³ ì¹¨í•œë‹¤. window.location.reload();
                 */
                    // 1. idê°€ myprice ì¸ input íƒœê·¸ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                let myprice = $('#myprice').val();
                // 2. ë§Œì•½ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë©´ alertë¥¼ ë„ìš°ê³  ì¤‘ë‹¨í•œë‹¤.
                if (myprice == '') {
                    alert('ì˜¬ë°”ë¥¸ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }
            
                // 3. PUT /api/product/${targetId} ì— dataë¥¼ ì „ë‹¬í•œë‹¤.
                $.ajax({
                    type: 'PUT',
                    url: `/api/products/${targetId}`,
                    contentType: 'application/json',
                    data: JSON.stringify({myprice: myprice}),
                    success: function (response) {
            
                        // 4. ëª¨ë‹¬ì„ ì¢…ë£Œí•œë‹¤. $('#container').removeClass('active');
                        $('#container').removeClass('active');
                        // 5. ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” alertë¥¼ ë„ìš´ë‹¤.
                        alert('ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        // 6. ì°½ì„ ìƒˆë¡œê³ ì¹¨í•œë‹¤. window.location.reload();
                        window.location.reload();
                    },
                    error(error, status, request) {
                        logout();
                    }
                })
            }
            
            function logout() {
                // í† í° ì‚­ì œ
                Cookies.remove('Authorization', {path: '/'});
                window.location.href = host + '/api/user/login-page';
            }
            
            function getToken() {
                let auth = Cookies.get('Authorization');
            
                if (auth === undefined) {
                    return '';
                }
            
                return auth;
            }
            ```
            
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] index.html**
            
            ```html
            <!doctype html>
            <html lang="en">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport"
                    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
              <meta http-equiv="X-UA-Compatible" content="ie=edge">
              <meta property="og:title" content="00ë§Œì˜ ì…€ë ‰ìƒµ">
              <meta property="og:description" content="ê´€ì‹¬ìƒí’ˆì„ ì„ íƒí•˜ê³ , ìµœì €ê°€ ì•Œë¦¼ì„ í™•ì¸í•´ë³´ì„¸ìš”!">
              <meta property="og:image" content="images/og_selectshop.png">
              <link rel="stylesheet" href="/css/style.css">
              <script src="https://code.jquery.com/jquery-3.7.0.min.js"
                      integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
              <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
              <script src="/js/basic.js"></script>
              <title>ë‚˜ë§Œì˜ ì…€ë ‰ìƒµ</title>
            </head>
            <body>
            <div class="header" style="position:relative;">
              <!--headr-->
              <div id="header-title-login-user">
                <span id="username"></span> ë‹˜ì˜
              </div>
              <div id="header-title-select-shop">
                Select Shop
              </div>
              <a id="login-text" href="javascript:logout()">
                ë¡œê·¸ì•„ì›ƒ
              </a>
              <!--/headr-->
            </div>
            <div class="nav">
              <div class="nav-see active">
                ëª¨ì•„ë³´ê¸°
              </div>
              <div class="nav-search">
                íƒìƒ‰í•˜ê¸°
              </div>
            </div>
            <div id="see-area">
              <div id="product-container">
            
              </div>
            </div>
            <div id="search-area">
              <div>
                <input type="text" id="query">
              </div>
              <div id="search-result-box">
            
              </div>
              <div id="container" class="popup-container">
                <div class="popup">
                  <button id="close" class="close">
                    X
                  </button>
                  <h1>â°ìµœì €ê°€ ì„¤ì •í•˜ê¸°</h1>
                  <p>ìµœì €ê°€ë¥¼ ì„¤ì •í•´ë‘ë©´ ì„ íƒí•˜ì‹  ìƒí’ˆì˜ ìµœì €ê°€ê°€ ë–´ì„ ë•Œ<br/> í‘œì‹œí•´ë“œë ¤ìš”!</p>
                  <div>
                    <input type="text" id="myprice" placeholder="200,000">ì›
                  </div>
                  <button class="cta" onclick="setMyprice()">ì„¤ì •í•˜ê¸°</button>
                </div>
              </div>
            </div>
            
            <input type="hidden" id="admin"/>
            </body>
            </html>
            ```
            
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] login.html**
            
            ```html
            <!DOCTYPE html>
            <html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport"
                      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="preconnect" href="https://fonts.gstatic.com">
                <link rel="stylesheet" type="text/css" href="/css/style.css">
                <script src="https://code.jquery.com/jquery-3.7.0.min.js"
                        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
                <meta charset="UTF-8">
                <title>ë¡œê·¸ì¸ í˜ì´ì§€</title>
            </head>
            <body>
            <div id="login-form">
                <div id="login-title">Log into Select Shop</div>
                <br>
                <button id="login-id-btn" onclick="location.href='/api/user/signup'">
                    íšŒì› ê°€ì…í•˜ê¸°
                </button>
                <div>
                    <div class="login-id-label">ì•„ì´ë””</div>
                    <input type="text" name="username" id="username" class="login-input-box">
            
                    <div class="login-id-label">ë¹„ë°€ë²ˆí˜¸</div>
                    <input type="password" name="password" id="password" class="login-input-box">
            
                    <button id="login-id-submit" onclick="onLogin()">ë¡œê·¸ì¸</button>
                </div>
                <div id="login-failed" style="display:none" class="alert alert-danger" role="alert">ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.</div>
            </div>
            </body>
            <script>
                $(document).ready(function () {
                    // í† í° ì‚­ì œ
                    Cookies.remove('Authorization', {path: '/'});
                });
            
                const href = location.href;
                const queryString = href.substring(href.indexOf("?") + 1)
                if (queryString === 'error') {
                    const errorDiv = document.getElementById('login-failed');
                    errorDiv.style.display = 'block';
                }
            
                const host = 'http://' + window.location.host;
            
                function onLogin() {
                    let username = $('#username').val();
                    let password = $('#password').val();
            
                    $.ajax({
                        type: "POST",
                        url: `/api/user/login`,
                        contentType: "application/json",
                        data: JSON.stringify({username: username, password: password}),
                    })
                        .done(function (res, status, xhr) {
                            const token = xhr.getResponseHeader('Authorization');
            
                            Cookies.set('Authorization', token, {path: '/'})
            
                            $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
                                jqXHR.setRequestHeader('Authorization', token);
                            });
            
                            window.location.href = host;
                        })
                        .fail(function (jqXHR, textStatus) {
                            alert("Login Fail");
                            window.location.href = host + '/api/user/login-page?error'
                        });
                }
            </script>
            </html>
            ```
            
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] signup.html**
            
            ```html
            <!DOCTYPE html>
            <html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport"
                    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
              <meta http-equiv="X-UA-Compatible" content="ie=edge">
              <link rel="preconnect" href="https://fonts.gstatic.com">
              <link rel="stylesheet" type="text/css" href="/css/style.css">
              <meta charset="UTF-8">
              <title>íšŒì›ê°€ì… í˜ì´ì§€</title>
              <script>
                function onclickAdmin() {
                  // Get the checkbox
                  var checkBox = document.getElementById("admin-check");
                  // Get the output text
                  var box = document.getElementById("admin-token");
            
                  // If the checkbox is checked, display the output text
                  if (checkBox.checked == true){
                    box.style.display = "block";
                  } else {
                    box.style.display = "none";
                  }
                }
              </script>
            </head>
            <body>
            <div id="login-form">
              <div id="login-title">Sign up Select Shop</div>
            
              <form action="/api/user/signup" method="post">
                <div class="login-id-label">Username</div>
                <input type="text" name="username" placeholder="Username" class="login-input-box">
            
                <div class="login-id-label">Password</div>
                <input type="password" name="password" class="login-input-box">
            
                <div class="login-id-label">E-mail</div>
                <input type="text" name="email" placeholder="E-mail" class="login-input-box">
            
                <div>
                  <input id="admin-check" type="checkbox" name="admin" onclick="onclickAdmin()" style="margin-top: 40px;">ê´€ë¦¬ì
                  <input id="admin-token" type="password" name="adminToken" placeholder="ê´€ë¦¬ì ì•”í˜¸" class="login-input-box" style="display:none">
                </div>
                <button id="login-id-submit">íšŒì› ê°€ì…</button>
              </form>
            </div>
            </body>
            </html>
            ```
            
        
- JWT ë¡œê·¸ì¸ ì¸ì¦ ì²˜ë¦¬ (Filter)
    
    <aside>
    ğŸ“Œ Clientì™€ Serverê°€ JWTë¥¼ ì£¼ê³ ë°›ëŠ” ë°©ì‹ì€ ê°œë°œìê°€ ì„ íƒí•©ë‹ˆë‹¤.
    ì´ì „ ê°•ì˜ì—ì„œ ë°°ì› ë˜ ë°©ì‹ì€ JWTë¥¼ ìƒì„±í•œ ì„œë²„ì—ì„œ ì¿ í‚¤ë¥¼ ì§ì ‘ ìƒì„±í•´ Clientë¡œ ì „ë‹¬í–ˆìŠµë‹ˆë‹¤.
    
    ![Screen Shot 2023-05-24 at 12.48.09 PM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/917a38f0-e198-471c-8d74-fe920ad59f81/Screen_Shot_2023-05-24_at_12.48.09_PM.png)
    
    ê·¸ëŸ¬ë©´ ì´ì²˜ëŸ¼ ì‘ë‹µ Headerì— Set-Cookieë¡œ ê°’ì´ ì „ë‹¬ë©ë‹ˆë‹¤.
    
    ê·¸ëŸ¼ ë”°ë¡œ Clientì—ì„œ ì¿ í‚¤ë¥¼ ì§ì ‘ ì¿ í‚¤ ì €ì¥ì†Œì— ì €ì¥í•˜ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ í•´ë‹¹ ê°’ì´ ì €ì¥ë©ë‹ˆë‹¤.
    
    ë˜í•œ ì´ì „ ê°•ì˜ì—ì„œëŠ” Clientì—ì„œ ë”°ë¡œ Headerì— JWTë¥¼ ì§ì ‘ ë‹´ì•„ì„œ ë³´ë‚´ì§€ ì•Šê³  ì„œë²„ì—ì„œ Requestì— ë‹´ê¸´ ì¿ í‚¤ ê°’ë“¤ ì¤‘ JWTì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ê°€ì ¸ì™€ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
    
    ì´ë²ˆì—ëŠ” Clientì™€ Server ëª¨ë‘ JWTë¥¼ ì§ì ‘ HTTP Headerì— ë‹´ì•„ì„œ ì „ë‹¬ë°›ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.
    
    </aside>
    
    - JWT ì‚¬ìš© íë¦„
        1. Client ê°€ username, password ë¡œ ë¡œê·¸ì¸ ì„±ê³µ ì‹œ
            1. ì„œë²„ì—ì„œ "ë¡œê·¸ì¸ ì •ë³´" â†’ JWT ë¡œ **ì•”í˜¸í™”** (Secret Key ì‚¬ìš©)
                
                **Sample**
                
                ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ef10ce2a-181e-4cf4-95bc-3a985e00fb6f/Untitled.png)
                
            2. **JWT** ë¥¼ Client ì‘ë‹µ Headerì— ì „ë‹¬
                1. ì‘ë‹µ **Header** ì— ì•„ë˜ **í˜•íƒœ**ë¡œ JWT ì „ë‹¬
                    
                    ```
                    **Authorization: Bearer** <JWT>
                    
                    ex)
                    **Authorization: Bearer** eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzcGFydGEiLCJVU0VSTkFNRSI6IuultO2DhOydtCIsIlVTRVJfUk9MRSI6IlJPTEVfVVNFUiIsIkVYUCI6MTYxODU1Mzg5OH0.9WTrWxCWx3YvaKZG14khp21fjkU1VjZV4e9VEf05Hok
                    ```
                    
                    !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/57dc742b-fc4b-47e2-8bcb-b3fd709d75d8/Untitled.png
                    
                
            3. Client ì—ì„œ JWT ì €ì¥ (ì¿ í‚¤)
            
        2. Client ì—ì„œ JWT í†µí•´ ì¸ì¦ë°©ë²•
            1. JWT ë¥¼ API ìš”ì²­ ì‹œë§ˆë‹¤ Header ì— í¬í•¨
                
                ì˜ˆ) HTTP Headers
                
                ```
                Content-Type: application/json
                **Authorization: Bearer** **<JWT>
                ...**
                ```
                
            2. Server
                1. Client ê°€ ì „ë‹¬í•œ **JWT ìœ„ì¡° ì—¬ë¶€ ê²€ì¦** (Secret Key ì‚¬ìš©)
                2. JWT ìœ íš¨ê¸°ê°„ì´ ì§€ë‚˜ì§€ ì•Šì•˜ëŠ”ì§€ ê²€ì¦
                3. ê²€ì¦ ì„±ê³µì‹œ,
                    1. JWT â†’ ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ í™•ì¸
                        
                        ex) **GET /api/products** : JWT ë³´ë‚¸ ì‚¬ìš©ìì˜ ê´€ì‹¬ìƒí’ˆ ëª©ë¡ ì¡°íšŒ
                        
            
    - **JwtUtil**
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] **JwtUtil**
            
            ```java
            package com.sparta.myselectshop.jwt;
            
            import com.sparta.myselectshop.entity.UserRoleEnum;
            import io.jsonwebtoken.*;
            import io.jsonwebtoken.security.Keys;
            import jakarta.annotation.PostConstruct;
            import jakarta.servlet.http.HttpServletRequest;
            import lombok.extern.slf4j.Slf4j;
            import org.springframework.beans.factory.annotation.Value;
            import org.springframework.stereotype.Component;
            import org.springframework.util.StringUtils;
            
            import java.security.Key;
            import java.util.Base64;
            import java.util.Date;
            
            @Slf4j(topic = "JwtUtil")
            @Component
            public class JwtUtil {
                // Header KEY ê°’
                public static final String AUTHORIZATION_HEADER = "Authorization";
                // ì‚¬ìš©ì ê¶Œí•œ ê°’ì˜ KEY
                public static final String AUTHORIZATION_KEY = "auth";
                // Token ì‹ë³„ì
                public static final String BEARER_PREFIX = "Bearer ";
                // í† í° ë§Œë£Œì‹œê°„
                private final long TOKEN_TIME = 60 * 60 * 1000L; // 60ë¶„
            
                @Value("${jwt.secret.key}") // Base64 Encode í•œ SecretKey
                private String secretKey;
                private Key key;
                private final SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;
            
                @PostConstruct
                public void init() {
                    byte[] bytes = Base64.getDecoder().decode(secretKey);
                    key = Keys.hmacShaKeyFor(bytes);
                }
            
                // í† í° ìƒì„±
                public String createToken(String username, UserRoleEnum role) {
                    Date date = new Date();
            
                    return BEARER_PREFIX +
                            Jwts.builder()
                                    .setSubject(username) // ì‚¬ìš©ì ì‹ë³„ìê°’(ID)
                                    .claim(AUTHORIZATION_KEY, role) // ì‚¬ìš©ì ê¶Œí•œ
                                    .setExpiration(new Date(date.getTime() + TOKEN_TIME)) // ë§Œë£Œ ì‹œê°„
                                    .setIssuedAt(date) // ë°œê¸‰ì¼
                                    .signWith(key, signatureAlgorithm) // ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜
                                    .compact();
                }
            
                // header ì—ì„œ JWT ê°€ì ¸ì˜¤ê¸°
                public String getJwtFromHeader(HttpServletRequest request) {
                    String bearerToken = request.getHeader(AUTHORIZATION_HEADER);
                    if (StringUtils.hasText(bearerToken) && bearerToken.startsWith(BEARER_PREFIX)) {
                        return bearerToken.substring(7);
                    }
                    return null;
                }
            
                // í† í° ê²€ì¦
                public boolean validateToken(String token) {
                    try {
                        Jwts.parserBuilder().setSigningKey(key).build().parseClaimsJws(token);
                        return true;
                    } catch (SecurityException | MalformedJwtException | SignatureException e) {
                        log.error("Invalid JWT signature, ìœ íš¨í•˜ì§€ ì•ŠëŠ” JWT ì„œëª… ì…ë‹ˆë‹¤.");
                    } catch (ExpiredJwtException e) {
                        log.error("Expired JWT token, ë§Œë£Œëœ JWT token ì…ë‹ˆë‹¤.");
                    } catch (UnsupportedJwtException e) {
                        log.error("Unsupported JWT token, ì§€ì›ë˜ì§€ ì•ŠëŠ” JWT í† í° ì…ë‹ˆë‹¤.");
                    } catch (IllegalArgumentException e) {
                        log.error("JWT claims is empty, ì˜ëª»ëœ JWT í† í° ì…ë‹ˆë‹¤.");
                    }
                    return false;
                }
            
                // í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                public Claims getUserInfoFromToken(String token) {
                    return Jwts.parserBuilder().setSigningKey(key).build().parseClaimsJws(token).getBody();
                }
            }
            ```
            
    - Spring Security ì ìš©
        - 'Spring Security' í™œì„±í™”
            - UserDetails & UserDetailsService êµ¬í˜„
                - **[ì½”ë“œ ìŠ¤ë‹ˆí«]  UserDetailsImpl**
                    
                    ```java
                    package com.sparta.myselectshop.security;
                    
                    import com.sparta.myselectshop.entity.User;
                    import com.sparta.myselectshop.entity.UserRoleEnum;
                    import org.springframework.security.core.GrantedAuthority;
                    import org.springframework.security.core.authority.SimpleGrantedAuthority;
                    import org.springframework.security.core.userdetails.UserDetails;
                    
                    import java.util.ArrayList;
                    import java.util.Collection;
                    
                    public class UserDetailsImpl implements UserDetails {
                    
                        private final User user;
                    
                        public UserDetailsImpl(User user) {
                            this.user = user;
                        }
                    
                        public User getUser() {
                            return user;
                        }
                    
                        @Override
                        public String getPassword() {
                            return user.getPassword();
                        }
                    
                        @Override
                        public String getUsername() {
                            return user.getUsername();
                        }
                    
                        @Override
                        public Collection<? extends GrantedAuthority> getAuthorities() {
                            UserRoleEnum role = user.getRole();
                            String authority = role.getAuthority();
                    
                            SimpleGrantedAuthority simpleGrantedAuthority = new SimpleGrantedAuthority(authority);
                            Collection<GrantedAuthority> authorities = new ArrayList<>();
                            authorities.add(simpleGrantedAuthority);
                    
                            return authorities;
                        }
                    
                        @Override
                        public boolean isAccountNonExpired() {
                            return true;
                        }
                    
                        @Override
                        public boolean isAccountNonLocked() {
                            return true;
                        }
                    
                        @Override
                        public boolean isCredentialsNonExpired() {
                            return true;
                        }
                    
                        @Override
                        public boolean isEnabled() {
                            return true;
                        }
                    }
                    ```
                    
                - **[ì½”ë“œ ìŠ¤ë‹ˆí«]  UserDetailsServiceImpl**
                    
                    ```java
                    package com.sparta.myselectshop.security;
                    
                    import com.sparta.myselectshop.entity.User;
                    import com.sparta.myselectshop.repository.UserRepository;
                    import lombok.RequiredArgsConstructor;
                    import org.springframework.security.core.userdetails.UserDetails;
                    import org.springframework.security.core.userdetails.UserDetailsService;
                    import org.springframework.security.core.userdetails.UsernameNotFoundException;
                    import org.springframework.stereotype.Service;
                    
                    @Service
                    @RequiredArgsConstructor
                    public class UserDetailsServiceImpl implements UserDetailsService {
                    
                        private final UserRepository userRepository;
                    
                        @Override
                        public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
                            User user = userRepository.findByUsername(username)
                                    .orElseThrow(() -> new UsernameNotFoundException("Not Found " + username));
                    
                            return new UserDetailsImpl(user);
                        }
                    }
                    ```
                    
            - **JwtAuthenticationFilter** : ë¡œê·¸ì¸ ì§„í–‰ ë° JWT ìƒì„±
                - **[ì½”ë“œ ìŠ¤ë‹ˆí«] LoginRequestDto**
                    
                    ```java
                    package com.sparta.myselectshop.dto;
                    
                    import lombok.Getter;
                    import lombok.Setter;
                    
                    @Setter
                    @Getter
                    public class LoginRequestDto {
                        private String username;
                        private String password;
                    }
                    ```
                    
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] **JwtAuthenticationFilter**
                    
                    ```java
                    package com.sparta.myselectshop.security;
                    
                    import com.fasterxml.jackson.databind.ObjectMapper;
                    import com.sparta.myselectshop.dto.LoginRequestDto;
                    import com.sparta.myselectshop.entity.UserRoleEnum;
                    import com.sparta.myselectshop.jwt.JwtUtil;
                    import jakarta.servlet.FilterChain;
                    import jakarta.servlet.http.HttpServletRequest;
                    import jakarta.servlet.http.HttpServletResponse;
                    import lombok.extern.slf4j.Slf4j;
                    import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
                    import org.springframework.security.core.Authentication;
                    import org.springframework.security.core.AuthenticationException;
                    import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
                    
                    import java.io.IOException;
                    
                    @Slf4j(topic = "ë¡œê·¸ì¸ ë° JWT ìƒì„±")
                    public class JwtAuthenticationFilter extends UsernamePasswordAuthenticationFilter {
                        private final JwtUtil jwtUtil;
                    
                        public JwtAuthenticationFilter(JwtUtil jwtUtil) {
                            this.jwtUtil = jwtUtil;
                            setFilterProcessesUrl("/api/user/login");
                        }
                    
                        @Override
                        public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {
                            try {
                                LoginRequestDto requestDto = new ObjectMapper().readValue(request.getInputStream(), LoginRequestDto.class);
                    
                                return getAuthenticationManager().authenticate(
                                        new UsernamePasswordAuthenticationToken(
                                                requestDto.getUsername(),
                                                requestDto.getPassword(),
                                                null
                                        )
                                );
                            } catch (IOException e) {
                                log.error(e.getMessage());
                                throw new RuntimeException(e.getMessage());
                            }
                        }
                    
                        @Override
                        protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) {
                            String username = ((UserDetailsImpl) authResult.getPrincipal()).getUsername();
                            UserRoleEnum role = ((UserDetailsImpl) authResult.getPrincipal()).getUser().getRole();
                    
                            String token = jwtUtil.createToken(username, role);
                            response.addHeader(JwtUtil.AUTHORIZATION_HEADER, token);
                        }
                    
                        @Override
                        protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed) {
                            response.setStatus(401);
                        }
                    
                    }
                    ```
                    
            - **JwtAuthorizationFilter** : APIì— ì „ë‹¬ë˜ëŠ” JWT ìœ íš¨ì„± ê²€ì¦ ë° ì¸ê°€ ì²˜ë¦¬
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] **JwtAuthorizationFilter**
                    
                    ```java
                    package com.sparta.myselectshop.security;
                    
                    import com.sparta.myselectshop.jwt.JwtUtil;
                    import io.jsonwebtoken.Claims;
                    import jakarta.servlet.FilterChain;
                    import jakarta.servlet.ServletException;
                    import jakarta.servlet.http.HttpServletRequest;
                    import jakarta.servlet.http.HttpServletResponse;
                    import lombok.extern.slf4j.Slf4j;
                    import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
                    import org.springframework.security.core.Authentication;
                    import org.springframework.security.core.context.SecurityContext;
                    import org.springframework.security.core.context.SecurityContextHolder;
                    import org.springframework.security.core.userdetails.UserDetails;
                    import org.springframework.util.StringUtils;
                    import org.springframework.web.filter.OncePerRequestFilter;
                    
                    import java.io.IOException;
                    
                    @Slf4j(topic = "JWT ê²€ì¦ ë° ì¸ê°€")
                    public class JwtAuthorizationFilter extends OncePerRequestFilter {
                    
                        private final JwtUtil jwtUtil;
                        private final UserDetailsServiceImpl userDetailsService;
                    
                        public JwtAuthorizationFilter(JwtUtil jwtUtil, UserDetailsServiceImpl userDetailsService) {
                            this.jwtUtil = jwtUtil;
                            this.userDetailsService = userDetailsService;
                        }
                    
                        @Override
                        protected void doFilterInternal(HttpServletRequest req, HttpServletResponse res, FilterChain filterChain) throws ServletException, IOException {
                    
                            String tokenValue = jwtUtil.getJwtFromHeader(req);
                    
                            if (StringUtils.hasText(tokenValue)) {
                    
                                if (!jwtUtil.validateToken(tokenValue)) {
                                    log.error("Token Error");
                                    return;
                                }
                    
                                Claims info = jwtUtil.getUserInfoFromToken(tokenValue);
                    
                                try {
                                    setAuthentication(info.getSubject());
                                } catch (Exception e) {
                                    log.error(e.getMessage());
                                    return;
                                }
                            }
                    
                            filterChain.doFilter(req, res);
                        }
                    
                        // ì¸ì¦ ì²˜ë¦¬
                        public void setAuthentication(String username) {
                            SecurityContext context = SecurityContextHolder.createEmptyContext();
                            Authentication authentication = createAuthentication(username);
                            context.setAuthentication(authentication);
                    
                            SecurityContextHolder.setContext(context);
                        }
                    
                        // ì¸ì¦ ê°ì²´ ìƒì„±
                        private Authentication createAuthentication(String username) {
                            UserDetails userDetails = userDetailsService.loadUserByUsername(username);
                            return new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
                        }
                    }
                    ```
                    
            - 'Spring Security' ì„¤ì • ë° ì¸ì¦/ì¸ê°€ í•„í„° ë“±ë¡
                - **[ì½”ë“œ ìŠ¤ë‹ˆí«] WebSecurityConfig**
                    
                    ```java
                    package com.sparta.myselectshop.config;
                    
                    import com.sparta.myselectshop.jwt.JwtUtil;
                    import com.sparta.myselectshop.security.JwtAuthenticationFilter;
                    import com.sparta.myselectshop.security.JwtAuthorizationFilter;
                    import com.sparta.myselectshop.security.UserDetailsServiceImpl;
                    import lombok.RequiredArgsConstructor;
                    import org.springframework.boot.autoconfigure.security.servlet.PathRequest;
                    import org.springframework.context.annotation.Bean;
                    import org.springframework.context.annotation.Configuration;
                    import org.springframework.security.authentication.AuthenticationManager;
                    import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
                    import org.springframework.security.config.annotation.web.builders.HttpSecurity;
                    import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
                    import org.springframework.security.config.http.SessionCreationPolicy;
                    import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
                    import org.springframework.security.crypto.password.PasswordEncoder;
                    import org.springframework.security.web.SecurityFilterChain;
                    import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
                    
                    @Configuration
                    @EnableWebSecurity // Spring Security ì§€ì›ì„ ê°€ëŠ¥í•˜ê²Œ í•¨
                    @RequiredArgsConstructor
                    public class WebSecurityConfig {
                    
                        private final JwtUtil jwtUtil;
                        private final UserDetailsServiceImpl userDetailsService;
                        private final AuthenticationConfiguration authenticationConfiguration;
                    
                        @Bean
                        public PasswordEncoder passwordEncoder() {
                            return new BCryptPasswordEncoder();
                        }
                    
                        @Bean
                        public AuthenticationManager authenticationManager(AuthenticationConfiguration configuration) throws Exception {
                            return configuration.getAuthenticationManager();
                        }
                    
                        @Bean
                        public JwtAuthenticationFilter jwtAuthenticationFilter() throws Exception {
                            JwtAuthenticationFilter filter = new JwtAuthenticationFilter(jwtUtil);
                            filter.setAuthenticationManager(authenticationManager(authenticationConfiguration));
                            return filter;
                        }
                    
                        @Bean
                        public JwtAuthorizationFilter jwtAuthorizationFilter() {
                            return new JwtAuthorizationFilter(jwtUtil, userDetailsService);
                        }
                    
                        @Bean
                        public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
                            // CSRF ì„¤ì •
                            http.csrf((csrf) -> csrf.disable());
                    
                            // ê¸°ë³¸ ì„¤ì •ì¸ Session ë°©ì‹ì€ ì‚¬ìš©í•˜ì§€ ì•Šê³  JWT ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •
                            http.sessionManagement((sessionManagement) ->
                                    sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                            );
                    
                            http.authorizeHttpRequests((authorizeHttpRequests) ->
                                    authorizeHttpRequests
                                            .requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll() // resources ì ‘ê·¼ í—ˆìš© ì„¤ì •
                                            .requestMatchers("/").permitAll() // ë©”ì¸ í˜ì´ì§€ ìš”ì²­ í—ˆê°€
                                            .requestMatchers("/api/user/**").permitAll() // '/api/user/'ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ ëª¨ë‘ ì ‘ê·¼ í—ˆê°€
                                            .anyRequest().authenticated() // ê·¸ ì™¸ ëª¨ë“  ìš”ì²­ ì¸ì¦ì²˜ë¦¬
                            );
                    
                            http.formLogin((formLogin) ->
                                    formLogin
                                            .loginPage("/api/user/login-page").permitAll()
                            );
                    
                            // í•„í„° ê´€ë¦¬
                            http.addFilterBefore(jwtAuthorizationFilter(), JwtAuthenticationFilter.class);
                            http.addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);
                    
                            return http.build();
                        }
                    }
                    ```
                    
                

## 18. íšŒì›ë³„ ìƒí’ˆ API êµ¬í˜„

- ìƒí’ˆê³¼ íšŒì›ì˜ ê´€ê³„
    1. ìƒí’ˆ ë“±ë¡ ì‹œ ëˆ„êµ¬ì˜ ìƒí’ˆì¸ì§€ ë“±ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤.
        - ê´€ì‹¬ ìƒí’ˆ ë“±ë¡ ì‹œ, ë“±ë¡ì„ ìš”ì²­í•œ "íšŒì› ì •ë³´" ì¶”ê°€ê°€ í•„ìš”í•©ë‹ˆë‹¤.
    2. ìƒí’ˆê³¼ íšŒì›ì˜ ê´€ê³„ë¥¼ ìƒê° í•´ë´…ë‹ˆë‹¤.
        
        ![data.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fc653ddc-58d8-42e4-b76c-4f8f6b97e691/data.png)
        
        <aside>
        ğŸ‘‰ ìƒí’ˆ : íšŒì› = N : 1
        
        </aside>
        
        - ìƒí’ˆê³¼ íšŒì›ì€ ë‹¤ëŒ€ì¼ ê´€ê³„ì…ë‹ˆë‹¤.
        - ì¦‰, í•œëª…ì˜ íšŒì›ì€ ë‹¤ìˆ˜ì˜ ìƒí’ˆì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            - My ì…€ë ‰ìƒµì˜ ìƒí’ˆì€ ê²€ìƒ‰ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰í•œ ìƒí’ˆì„ ê´€ì‹¬ ìƒí’ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ë§Œì•½ ê°™ì€ ìƒí’ˆì´ ê²€ìƒ‰ë˜ì–´ ì—¬ëŸ¬ íšŒì›ì—ê²Œ ë“±ë¡ ë˜ë”ë¼ë„ ì„œë¹„ìŠ¤ ìƒì—ì„œëŠ” ë‹¤ë¥¸ ìƒí’ˆìœ¼ë¡œ ì¸ì§€ë©ë‹ˆë‹¤.
    3. ì—°ê´€ê´€ê³„ì˜ ë°©í–¥ì„ ì„ íƒí•©ë‹ˆë‹¤.
        - íšŒì› ê°ì²´ì—ì„œ ìƒí’ˆ ê°ì²´ë¥¼ ì¡°íšŒí•˜ëŠ” ê²½ìš°ê°€ ì—†ê¸° ë•Œë¬¸ì— ìƒí’ˆê³¼ íšŒì›ì„  N : 1 ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
            - **Product**
                
                ```java
                @ManyToOne(fetch = FetchType.LAZY)
                @JoinColumn(name = "user_id", nullable = false)
                private User user;
                ```
                
    
- ìƒí’ˆ ë“±ë¡ ë° ì¡°íšŒ êµ¬í˜„
    - Controllerì—ì„œ ë¡œê·¸ì¸ íšŒì› ì •ë³´ë¥¼ ë°›ì•„ Service ë¡œ ì „ë‹¬
        
        ```java
        // ê´€ì‹¬ ìƒí’ˆ ë“±ë¡í•˜ê¸°
        @PostMapping("/products")
        public ProductResponseDto createProduct(@RequestBody ProductRequestDto requestDto, @AuthenticationPrincipal UserDetailsImpl userDetails) {
            // ì‘ë‹µ ë³´ë‚´ê¸°
            return productService.createProduct(requestDto, userDetails.getUser());
        }
        
        // ê´€ì‹¬ ìƒí’ˆ ì¡°íšŒí•˜ê¸°
        @GetMapping("/products")
        public List<ProductResponseDto> getProducts(@AuthenticationPrincipal UserDetailsImpl userDetails) {
            // ì‘ë‹µ ë³´ë‚´ê¸°
            return productService.getProducts(userDetails.getUser());
        }
        ```
        
    - Serviceì—ì„œ íšŒì›ë³„ ìƒí’ˆ ë“±ë¡ ë° ì¡°íšŒ êµ¬í˜„
        
        ```java
        public ProductResponseDto createProduct(ProductRequestDto requestDto, User user) {
            Product product = productRepository.save(new Product(requestDto, user));
            return new ProductResponseDto(product);
        }
        
        public List<ProductResponseDto> getProducts(User user) {
            List<Product> productList = productRepository.findALlByUser(user);
            List<ProductResponseDto> responseDtoList = new ArrayList<>();
        
            for (Product product : productList) {
                responseDtoList.add(new ProductResponseDto(product));
            }
            return responseDtoList;
        }
        ```
        
    - Repositoryì— íšŒì›ë³„ ìƒí’ˆì„ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œ ì¶”ê°€
        
        ```java
        public interface ProductRepository extends JpaRepository<Product, Long> {
            List<Product> findALlByUser(User user);
        }
        ```
        
    - Admin ê³„ì • ëª¨ë“  ìƒí’ˆ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€
        - **ProductController**
            
            ```java
            // ê´€ë¦¬ì ì¡°íšŒ
            @GetMapping("/admin/products")
            public List<ProductResponseDto> getAllProducts() {
                return productService.getAllProducts();
            }
            ```
            
        - **ProductService**
            
            ```java
            public List<ProductResponseDto> getAllProducts() {
                List<Product> productList = productRepository.findAll();
                List<ProductResponseDto> responseDtoList = new ArrayList<>();
            
                for (Product product : productList) {
                    responseDtoList.add(new ProductResponseDto(product));
                }
                return responseDtoList;
            }
            ```
            
        

## 19. ìƒí’ˆ í˜ì´ì§• ë° ì •ë ¬

- í˜ì´ì§• ë° ì •ë ¬ ì„¤ê³„
    - UI
        
        !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6ad2967e-cc45-4ee7-9a42-a5563b62bb9a/Untitled.png
        
    - ìƒí’ˆ ì¡°íšŒ API ìˆ˜ì • í•„ìš” (**GET /api/products**)
    - **Client â†’ Server**
        
        ![Screen Shot 2022-11-07 at 11.04.06 AM.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6d21246a-17b4-4383-af71-e3d2302bb25f/Screen_Shot_2022-11-07_at_11.04.06_AM.png)
        
        1. í˜ì´ì§•
            1. page :  ì¡°íšŒí•  í˜ì´ì§€ ë²ˆí˜¸ (**1ë¶€í„° ì‹œì‘**)
            2. size : í•œ í˜ì´ì§€ì— ë³´ì—¬ì¤„ ìƒí’ˆ ê°œìˆ˜ (**10ê°œë¡œ ê³ ì •**!)
        2. ì •ë ¬
            1. sortBy (ì •ë ¬ í•­ëª©)
                1. id : Product í…Œì´ë¸”ì˜ id
                2. title : ìƒí’ˆëª…
                3. lprice : ìµœì €ê°€
            2.  isAsc (ì˜¤ë¦„ì°¨ìˆœ?)
                1. true: ì˜¤ë¦„ì°¨ìˆœ (asc)
                2. false : ë‚´ë¦¼ì°¨ìˆœ (desc)
                
    - **Server â†’ Client**
        
        !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f966bae7-2173-4970-9837-066270e83c56/Untitled.png
        
        - number : ì¡°íšŒëœ í˜ì´ì§€ ë²ˆí˜¸ (**0ë¶€í„° ì‹œì‘**)
        - content : ì¡°íšŒëœ ìƒí’ˆ ì •ë³´ (ë°°ì—´)
        - size : í•œ í˜ì´ì§€ì— ë³´ì—¬ì¤„ ìƒí’ˆ ê°œìˆ˜
        - numberOfElements : ì‹¤ì œ ì¡°íšŒëœ ìƒí’ˆ ê°œìˆ˜
        - totalElements : ì „ì²´ ìƒí’ˆ ê°œìˆ˜ (íšŒì›ì´ ë“±ë¡í•œ ëª¨ë“  ìƒí’ˆì˜ ê°œìˆ˜)
        - totalPages : ì „ì²´ í˜ì´ì§€ ìˆ˜
            
            ```java
            totalPages = totalElement / size ê²°ê³¼ë¥¼ ì†Œìˆ˜ì  ì˜¬ë¦¼
            1 / 10 = 0.1 => ì´ 1 í˜ì´ì§€
            9 / 10 = 0.9 => ì´ 1í˜ì´ì§€
            10 / 10 = 1 => ì´ 1í˜ì´ì§€
            11 / 10 => 1.1 => ì´ 2í˜ì´ì§€
            
            ```
            
        - first: ì²« í˜ì´ì§€ì¸ì§€? (boolean)
        - last: ë§ˆì§€ë§‰ í˜ì´ì§€ì¸ì§€? (boolean)
        - Spring Data í˜ì´ì§•, ì •ë ¬ ê¸°ëŠ¥ í™•ì¸í•˜ê¸°
            - Spring Dataì—ì„œ í˜ì´ì§• ë° ì •ë ¬ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì— ì†ì‰½ê²Œ í˜ì´ì§•, ì •ë ¬ì„ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            
            ```java
            Sort.Direction direction = isAsc ? Sort.Direction.ASC : Sort.Direction.DESC;
            Sort sort = Sort.by(direction, sortBy);
            Pageable pageable = PageRequest.of(page, size, sort);
            
            Page<Product> products = productRepository.findAllByUser(user, pageable);
            ```
            
            - Pageableì€ ì†ì‰½ê²Œ í˜ì´ì§•, ì •ë ¬ ì²˜ë¦¬ë¥¼ í•˜ê¸°ìœ„í•´ ì œê³µë˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë©° PageRequestëŠ” í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì…ë‹ˆë‹¤.
            - íŒŒë¼ë¯¸í„°ë¡œ (í˜„ì¬ í˜ì´ì§€(0ì‹œì‘), ë°ì´í„° ë…¸ì¶œ ê°œìˆ˜,  ì •ë ¬ ë°©ë²•(ASC, DESC))
            - ë¥¼ ì „ë‹¬í•˜ì—¬ ìƒì„±ëœ Pageable êµ¬í˜„ ê°ì²´ë¥¼ Spring Data JPAì˜ Query Method íŒŒë¼ë¯¸í„°ì— í•¨ê»˜ ì „ë‹¬í•˜ë©´ í˜ì´ì§• ë° ì •ë ¬ ì²˜ë¦¬ê°€ ì™„ë£Œëœ ë°ì´í„°ë¥¼ Page íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
            - Page íƒ€ì…ì—ëŠ” Clientì— ì „ë‹¬í•´ì•¼í•  ë°ì´í„°ì¸ totalPages, totalElementsë“±ì˜ ë°ì´í„°ë¥¼ í•¨ê»˜ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.
        
- í˜ì´ì§• ë° ì •ë ¬ êµ¬í˜„
    - í˜ì´ì§• ë° ì •ë ¬ ê¸°ëŠ¥ ì¶”ê°€ë¡œ ì¸í•œ Client ì½”ë“œ ë³€ê²½
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] basic.js**
            
            ```jsx
            const host = 'http://' + window.location.host;
            let targetId;
            
            $(document).ready(function () {
                const auth = getToken();
            
                if (auth !== undefined && auth !== '') {
                    $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
                        jqXHR.setRequestHeader('Authorization', auth);
                    });
                } else {
                    window.location.href = host + '/api/user/login-page';
                    return;
                }
            
                $.ajax({
                    type: 'GET',
                    url: `/api/user-info`,
                    contentType: 'application/json',
                })
                    .done(function (res, status, xhr) {
                        const username = res.username;
                        const isAdmin = !!res.admin;
            
                        if (!username) {
                            window.location.href = '/api/user/login-page';
                            return;
                        }
            
                        $('#username').text(username);
                        if (isAdmin) {
                            $('#admin').text(true);
                            showProduct();
                        } else {
                            showProduct();
                        }
                    })
                    .fail(function (jqXHR, textStatus) {
                        logout();
                    });
            
                // id ê°€ query ì¸ ë…€ì„ ìœ„ì—ì„œ ì—”í„°ë¥¼ ëˆ„ë¥´ë©´ execSearch() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.
                $('#query').on('keypress', function (e) {
                    if (e.key == 'Enter') {
                        execSearch();
                    }
                });
                $('#close').on('click', function () {
                    $('#container').removeClass('active');
                })
                $('#close2').on('click', function () {
                    $('#container2').removeClass('active');
                })
                $('.nav div.nav-see').on('click', function () {
                    $('div.nav-see').addClass('active');
                    $('div.nav-search').removeClass('active');
            
                    $('#see-area').show();
                    $('#search-area').hide();
                })
                $('.nav div.nav-search').on('click', function () {
                    $('div.nav-see').removeClass('active');
                    $('div.nav-search').addClass('active');
            
                    $('#see-area').hide();
                    $('#search-area').show();
                })
            
                $('#see-area').show();
                $('#search-area').hide();
            })
            
            function numberWithCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            function execSearch() {
                /**
                 * ê²€ìƒ‰ì–´ input id: query
                 * ê²€ìƒ‰ê²°ê³¼ ëª©ë¡: #search-result-box
                 * ê²€ìƒ‰ê²°ê³¼ HTML ë§Œë“œëŠ” í•¨ìˆ˜: addHTML
                 */
                    // 1. ê²€ìƒ‰ì°½ì˜ ì…ë ¥ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                let query = $('#query').val();
            
                // 2. ê²€ìƒ‰ì°½ ì…ë ¥ê°’ì„ ê²€ì‚¬í•˜ê³ , ì…ë ¥í•˜ì§€ ì•Šì•˜ì„ ê²½ìš° focus.
                if (query == '') {
                    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    $('#query').focus();
                    return;
                }
                // 3. GET /api/search?query=${query} ìš”ì²­
                $.ajax({
                    type: 'GET',
                    url: `/api/search?query=${query}`,
                    success: function (response) {
                        $('#search-result-box').empty();
                        // 4. for ë¬¸ë§ˆë‹¤ itemDtoë¥¼ êº¼ë‚´ì„œ HTML ë§Œë“¤ê³  ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ì— ë¶™ì´ê¸°!
                        for (let i = 0; i < response.length; i++) {
                            let itemDto = response[i];
                            let tempHtml = addHTML(itemDto);
                            $('#search-result-box').append(tempHtml);
                        }
                    },
                    error(error, status, request) {
                        logout();
                    }
                })
            
            }
            
            function addHTML(itemDto) {
                /**
                 * class="search-itemDto" ì¸ ë…€ì„ì—ì„œ
                 * image, title, lprice, addProduct í™œìš©í•˜ê¸°
                 * ì°¸ê³ ) onclick='addProduct(${JSON.stringify(itemDto)})'
                 */
                return `<div class="search-itemDto">
                    <div class="search-itemDto-left">
                        <img src="${itemDto.image}" alt="">
                    </div>
                    <div class="search-itemDto-center">
                        <div>${itemDto.title}</div>
                        <div class="price">
                            ${numberWithCommas(itemDto.lprice)}
                            <span class="unit">ì›</span>
                        </div>
                    </div>
                    <div class="search-itemDto-right">
                        <img src="../images/icon-save.png" alt="" onclick='addProduct(${JSON.stringify(itemDto)})'>
                    </div>
                </div>`
            }
            
            function addProduct(itemDto) {
                /**
                 * modal ëœ¨ê²Œ í•˜ëŠ” ë²•: $('#container').addClass('active');
                 * dataë¥¼ ajaxë¡œ ì „ë‹¬í•  ë•ŒëŠ” ë‘ ê°€ì§€ê°€ ë§¤ìš° ì¤‘ìš”
                 * 1. contentType: "application/json",
                 * 2. data: JSON.stringify(itemDto),
                 */
            
                // 1. POST /api/products ì— ê´€ì‹¬ ìƒí’ˆ ìƒì„± ìš”ì²­
                $.ajax({
                    type: 'POST',
                    url: '/api/products',
                    contentType: 'application/json',
                    data: JSON.stringify(itemDto),
                    success: function (response) {
                        // 2. ì‘ë‹µ í•¨ìˆ˜ì—ì„œ modalì„ ëœ¨ê²Œ í•˜ê³ , targetId ë¥¼ reponse.id ë¡œ ì„¤ì •
                        $('#container').addClass('active');
                        targetId = response.id;
                    },
                    error(error, status, request) {
                        logout();
                    }
                });
            }
            
            function showProduct() {
                /**
                 * ê´€ì‹¬ìƒí’ˆ ëª©ë¡: #product-container
                 * ê²€ìƒ‰ê²°ê³¼ ëª©ë¡: #search-result-box
                 * ê´€ì‹¬ìƒí’ˆ HTML ë§Œë“œëŠ” í•¨ìˆ˜: addProductItem
                 */
            
                let dataSource = null;
            
                var sorting = $("#sorting option:selected").val();
                var isAsc = $(':radio[name="isAsc"]:checked').val();
            
                dataSource = `/api/products?sortBy=${sorting}&isAsc=${isAsc}`;
            
                $('#product-container').empty();
                $('#search-result-box').empty();
                $('#pagination').pagination({
                    dataSource,
                    locator: 'content',
                    alias: {
                        pageNumber: 'page',
                        pageSize: 'size'
                    },
                    totalNumberLocator: (response) => {
                        return response.totalElements;
                    },
                    pageSize: 10,
                    showPrevious: true,
                    showNext: true,
                    ajax: {
                        error(error, status, request) {
                            if (error.status === 403) {
                                $('html').html(error.responseText);
                                return;
                            }
                            logout();
                        }
                    },
                    callback: function(response, pagination) {
                        $('#product-container').empty();
                        for (let i = 0; i < response.length; i++) {
                            let product = response[i];
                            let tempHtml = addProductItem(product);
                            $('#product-container').append(tempHtml);
                        }
                    }
                });
            }
            
            function addProductItem(product) {
                console.log(product)
                return `<div class="product-card">
                            <div onclick="window.location.href='${product.link}'">
                                <div class="card-header">
                                    <img src="${product.image}"
                                         alt="">
                                </div>
                                <div class="card-body">
                                    <div class="title">
                                        ${product.title}
                                    </div>
                                    <div class="lprice">
                                        <span>${numberWithCommas(product.lprice)}</span>ì›
                                    </div>
                                    <div class="isgood ${product.lprice > product.myprice ? 'none' : ''}">
                                        ìµœì €ê°€
                                    </div>
                                </div>
                            </div>
                        </div>`;
            }
            
            function setMyprice() {
                /**
                 * 1. idê°€ myprice ì¸ input íƒœê·¸ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                 * 2. ë§Œì•½ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë©´ alertë¥¼ ë„ìš°ê³  ì¤‘ë‹¨í•œë‹¤.
                 * 3. PUT /api/product/${targetId} ì— dataë¥¼ ì „ë‹¬í•œë‹¤.
                 *    ì£¼ì˜) contentType: "application/json",
                 *         data: JSON.stringify({myprice: myprice}),
                 *         ë¹ ëœ¨ë¦¬ì§€ ë§ ê²ƒ!
                 * 4. ëª¨ë‹¬ì„ ì¢…ë£Œí•œë‹¤. $('#container').removeClass('active');
                 * 5, ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” alertë¥¼ ë„ìš´ë‹¤.
                 * 6. ì°½ì„ ìƒˆë¡œê³ ì¹¨í•œë‹¤. window.location.reload();
                 */
                    // 1. idê°€ myprice ì¸ input íƒœê·¸ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                let myprice = $('#myprice').val();
                // 2. ë§Œì•½ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë©´ alertë¥¼ ë„ìš°ê³  ì¤‘ë‹¨í•œë‹¤.
                if (myprice == '') {
                    alert('ì˜¬ë°”ë¥¸ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }
            
                // 3. PUT /api/product/${targetId} ì— dataë¥¼ ì „ë‹¬í•œë‹¤.
                $.ajax({
                    type: 'PUT',
                    url: `/api/products/${targetId}`,
                    contentType: 'application/json',
                    data: JSON.stringify({myprice: myprice}),
                    success: function (response) {
            
                        // 4. ëª¨ë‹¬ì„ ì¢…ë£Œí•œë‹¤. $('#container').removeClass('active');
                        $('#container').removeClass('active');
                        // 5. ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” alertë¥¼ ë„ìš´ë‹¤.
                        alert('ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        // 6. ì°½ì„ ìƒˆë¡œê³ ì¹¨í•œë‹¤. window.location.reload();
                        window.location.reload();
                    },
                    error(error, status, request) {
                        logout();
                    }
                })
            }
            
            function logout() {
                // í† í° ì‚­ì œ
                Cookies.remove('Authorization', {path: '/'});
                window.location.href = host + '/api/user/login-page';
            }
            
            function getToken() {
                let auth = Cookies.get('Authorization');
            
                if(auth === undefined) {
                    return '';
                }
            
                return auth;
            }
            ```
            
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] index.html**
            
            ```html
            <!doctype html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport"
                      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="preconnect" href="https://fonts.gstatic.com">
                <script src="https://code.jquery.com/jquery-3.7.0.min.js"
                        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.min.js"></script>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
            
                <link rel="stylesheet" href="/css/style.css">
                <script src="/js/basic.js"></script>
                <title>ë‚˜ë§Œì˜ ì…€ë ‰ìƒµ</title>
            </head>
            <body>
            <div class="header" style="position:relative;">
                <!--headr-->
                <div id="header-title-login-user">
                    <span id="username"></span> ë‹˜ì˜
                </div>
                <div id="header-title-select-shop">
                    Select Shop
                </div>
                <a id="login-text" href="javascript:logout()">
                    ë¡œê·¸ì•„ì›ƒ
                </a>
                <!--/headr-->
            </div>
            <div class="nav">
                <div class="nav-see active">
                    ëª¨ì•„ë³´ê¸°
                </div>
                <div class="nav-search">
                    íƒìƒ‰í•˜ê¸°
                </div>
            </div>
            <div id="see-area">
                <div class="pagination">
                    ì •ë ¬:
                    <select id="sorting" onchange="showProduct()">
                        <option value="id">ID</option>
                        <option value="title">ìƒí’ˆëª…</option>
                        <option value="lprice">ìµœì €ê°€</option>
                    </select>
                    <input type="radio" name="isAsc" value="true" onchange="showProduct()" checked/> ì˜¤ë¦„ì°¨ìˆœ
                    <input type="radio" name="isAsc" value="false" onchange="showProduct()"/> ë‚´ë¦¼ì°¨ìˆœ
                </div>
                <div id="pagination" class="pagination"></div>
                <br>
                <div id="product-container">
            
                </div>
            </div>
            <div id="search-area">
                <div>
                    <input type="text" id="query">
                </div>
                <div id="search-result-box">
            
                </div>
                <div id="container" class="popup-container">
                    <div class="popup">
                        <button id="close" class="close">
                            X
                        </button>
                        <h1>â°ìµœì €ê°€ ì„¤ì •í•˜ê¸°</h1>
                        <p>ìµœì €ê°€ë¥¼ ì„¤ì •í•´ë‘ë©´ ì„ íƒí•˜ì‹  ìƒí’ˆì˜ ìµœì €ê°€ê°€ ë–´ì„ ë•Œ<br/> í‘œì‹œí•´ë“œë ¤ìš”!</p>
                        <div>
                            <input type="text" id="myprice" placeholder="200,000">ì›
                        </div>
                        <button class="cta" onclick="setMyprice()">ì„¤ì •í•˜ê¸°</button>
                    </div>
                </div>
            </div>
            
            <input type="hidden" id="admin"/>
            </body>
            </html>
            ```
            
    - í˜ì´ì§• ë° ì •ë ¬ ê¸°ëŠ¥ ì¶”ê°€ë¡œ ì¸í•œ Server ì½”ë“œ ë³€ê²½
        - **ProductController**
            
            ```java
            // ê´€ì‹¬ ìƒí’ˆ ì¡°íšŒí•˜ê¸°
            @GetMapping("/products")
            public Page<ProductResponseDto> getProducts(
                    @RequestParam("page") int page,
                    @RequestParam("size") int size,
                    @RequestParam("sortBy") String sortBy,
                    @RequestParam("isAsc") boolean isAsc,
                    @AuthenticationPrincipal UserDetailsImpl userDetails) {
                // ì‘ë‹µ ë³´ë‚´ê¸°
                return productService.getProducts(userDetails.getUser(),  page-1, size, sortBy, isAsc);
            }
            ```
            
        - **ProductService**
            
            ```java
            public Page<ProductResponseDto> getProducts(User user,
                                                        int page, int size, String sortBy, boolean isAsc) {
                // í˜ì´ì§• ì²˜ë¦¬
                Sort.Direction direction = isAsc ? Sort.Direction.ASC : Sort.Direction.DESC;
                Sort sort = Sort.by(direction, sortBy);
                Pageable pageable = PageRequest.of(page, size, sort);
            
                // ì‚¬ìš©ì ê¶Œí•œ ê°€ì ¸ì™€ì„œ ADMIN ì´ë©´ ì „ì²´ ì¡°íšŒ, USER ë©´ ë³¸ì¸ì´ ì¶”ê°€í•œ ë¶€ë¶„ ì¡°íšŒ
                UserRoleEnum userRoleEnum = user.getRole();
            
                Page<Product> productList;
            
                if (userRoleEnum == UserRoleEnum.USER) {
                    // ì‚¬ìš©ì ê¶Œí•œì´ USER ì¼ ê²½ìš°
                    productList = productRepository.findAllByUser(user, pageable);
                } else {
                    productList = productRepository.findAll(pageable);
                }
            
                return productList.map(ProductResponseDto::new);
            }
            ```
            
        - **ProductRepository**
            
            ```java
            public interface ProductRepository extends JpaRepository<Product, Long> {
                Page<Product> findAllByUser(User user, Pageable pageable);
            }
            ```
            
    
- í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] util > TestDataRunner**
        
        ```java
        package com.sparta.myselectshop.util;
        
        import com.sparta.myselectshop.entity.Product;
        import com.sparta.myselectshop.entity.User;
        import com.sparta.myselectshop.entity.UserRoleEnum;
        import com.sparta.myselectshop.naver.dto.ItemDto;
        import com.sparta.myselectshop.naver.service.NaverApiService;
        import com.sparta.myselectshop.repository.ProductRepository;
        import com.sparta.myselectshop.repository.UserRepository;
        import com.sparta.myselectshop.service.UserService;
        import org.springframework.beans.factory.annotation.Autowired;
        import org.springframework.boot.ApplicationArguments;
        import org.springframework.boot.ApplicationRunner;
        import org.springframework.security.crypto.password.PasswordEncoder;
        import org.springframework.stereotype.Component;
        
        import java.util.ArrayList;
        import java.util.List;
        
        import static com.sparta.myselectshop.service.ProductService.MIN_MY_PRICE;
        
        @Component
        public class TestDataRunner implements ApplicationRunner {
        
            @Autowired
            UserService userService;
            @Autowired
            ProductRepository productRepository;
            @Autowired
            UserRepository userRepository;
            @Autowired
            PasswordEncoder passwordEncoder;
            @Autowired
            NaverApiService naverApiService;
        
            @Override
            public void run(ApplicationArguments args) {
                // í…ŒìŠ¤íŠ¸ User ìƒì„±
                User testUser = new User("Robbie", passwordEncoder.encode("1234"), "robbie@sparta.com", UserRoleEnum.USER);
                testUser = userRepository.save(testUser);
        
                // í…ŒìŠ¤íŠ¸ User ì˜ ê´€ì‹¬ìƒí’ˆ ë“±ë¡
                // ê²€ìƒ‰ì–´ ë‹¹ ê´€ì‹¬ìƒí’ˆ 10ê°œ ë“±ë¡
                createTestData(testUser, "ì‹ ë°œ");
                createTestData(testUser, "ê³¼ì");
                createTestData(testUser, "í‚¤ë³´ë“œ");
                createTestData(testUser, "íœ´ì§€");
                createTestData(testUser, "íœ´ëŒ€í°");
                createTestData(testUser, "ì•¨ë²”");
                createTestData(testUser, "í—¤ë“œí°");
                createTestData(testUser, "ì´ì–´í°");
                createTestData(testUser, "ë…¸íŠ¸ë¶");
                createTestData(testUser, "ë¬´ì„  ì´ì–´í°");
                createTestData(testUser, "ëª¨ë‹ˆí„°");
            }
        
            private void createTestData(User user, String searchWord) {
                // ë„¤ì´ë²„ ì‡¼í•‘ API í†µí•´ ìƒí’ˆ ê²€ìƒ‰
                List<ItemDto> itemDtoList = naverApiService.searchItems(searchWord);
        
                List<Product> productList = new ArrayList<>();
        
                for (ItemDto itemDto : itemDtoList) {
                    Product product = new Product();
                    // ê´€ì‹¬ìƒí’ˆ ì €ì¥ ì‚¬ìš©ì
                    product.setUser(user);
                    // ê´€ì‹¬ìƒí’ˆ ì •ë³´
                    product.setTitle(itemDto.getTitle());
                    product.setLink(itemDto.getLink());
                    product.setImage(itemDto.getImage());
                    product.setLprice(itemDto.getLprice());
        
                    // í¬ë§ ìµœì €ê°€ ëœë¤ê°’ ìƒì„±
                    // ìµœì € (100ì›) ~ ìµœëŒ€ (ìƒí’ˆì˜ í˜„ì¬ ìµœì €ê°€ + 10000ì›)
                    int myPrice = getRandomNumber(MIN_MY_PRICE, itemDto.getLprice() + 10000);
                    product.setMyprice(myPrice);
        
                    productList.add(product);
                }
        
                productRepository.saveAll(productList);
            }
        
            public int getRandomNumber(int min, int max) {
                return (int) ((Math.random() * (max - min)) + min);
            }
        }
        ```
        
    

## 20. ìƒí’ˆ í´ë” ì„¤ê³„

- ìš”êµ¬ì‚¬í•­ ë¶„ì„
    
    !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e454c30f-9363-4e05-8a11-a9ca2c567287/Untitled.png
    
    1. ë°°ê²½
        1. íšŒì›ë“¤ ì¤‘ í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ëŠ¥ë§Œìœ¼ë¡œëŠ” ì›í•˜ëŠ” ê´€ì‹¬ìƒí’ˆì„ ì‰½ê²Œ ì°¾ê¸° ì–´ë µë‹¤ëŠ” ë¶ˆë§Œì´ ë§ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.
        2. ë”°ë¼ì„œ í´ë” ë³„ë¡œ ê´€ì‹¬ìƒí’ˆì„ ì €ì¥/ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸°ë¡œ ê²°ì •ë‚¬ìŠµë‹ˆë‹¤.
        
    2. ìš”êµ¬ì‚¬í•­
        1. í´ë” ìƒì„±
            1. íšŒì›ë³„ í´ë”ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            2. í´ë”ë¥¼ ì¶”ê°€í•  ë•Œ 1ê°œ~Nê°œë¥¼ í•œë²ˆì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                
                !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/782a4107-6e8c-4a39-acf0-8fafc5a01a90/Untitled.png
                
        2. ê´€ì‹¬ìƒí’ˆì— í´ë” ì„¤ì •
            1. ê´€ì‹¬ìƒí’ˆì— í´ë”ëŠ” Nê°œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            2. ê´€ì‹¬ìƒí’ˆì´ ë“±ë¡ë˜ëŠ” ì‹œì ì—ëŠ” ì–´ëŠ í´ë”ì—ë„ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            3. ê´€ì‹¬ìƒí’ˆ ë³„ë¡œ 1ë²ˆì—ì„œ ìƒì„±í•œ í´ë”ë¥¼ ì„ íƒí•˜ì—¬ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                
                !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8708dd4e-68c7-4623-bd3d-9547f2107473/Untitled.png
                
        3. í´ë” ë³„ ì¡°íšŒ
            1. íšŒì›ì€ í´ë” ë³„ë¡œ ê´€ì‹¬ìƒí’ˆ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                
                !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6de70d19-6823-4993-85ff-b49818abe09e/Untitled.png
                
            2. ì¡°íšŒ ë°©ë²•
                1. 'ì „ì²´' í´ë¦­ ì‹œ: í´ë”ì™€ ìƒê´€ ì—†ì´ íšŒì›ì´ ì €ì¥í•œ ì „ì²´ ê´€ì‹¬ìƒí’ˆë“¤ì„ ì¡°íšŒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                2. 'í´ë”ëª…' í´ë¦­ ì‹œ: í´ë”ë³„ ì €ì¥ëœ ê´€ì‹¬ìƒí’ˆë“¤ì„ ì¡°íšŒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                
    - í´ë” ê¸°ëŠ¥ ì¶”ê°€ë¡œ ì¸í•œ Client ì½”ë“œ ë³€ê²½
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] basic.js**
            
            ```jsx
            const host = 'http://' + window.location.host;
            let targetId;
            let folderTargetId;
            
            $(document).ready(function () {
                const auth = getToken();
            
                if (auth !== undefined && auth !== '') {
                    $.ajaxPrefilter(function (options, originalOptions, jqXHR) {
                        jqXHR.setRequestHeader('Authorization', auth);
                    });
                } else {
                    window.location.href = host + '/api/user/login-page';
                    return;
                }
            
                $.ajax({
                    type: 'GET',
                    url: `/api/user-info`,
                    contentType: 'application/json',
                })
                    .done(function (res, status, xhr) {
                        const username = res.username;
                        const isAdmin = !!res.admin;
            
                        if (!username) {
                            window.location.href = '/api/user/login-page';
                            return;
                        }
            
                        $('#username').text(username);
                        if (isAdmin) {
                            $('#admin').text(true);
                            showProduct();
                        } else {
                            showProduct();
                        }
            
                        // ë¡œê·¸ì¸í•œ ìœ ì €ì˜ í´ë”
                        $.ajax({
                            type: 'GET',
                            url: `/api/user-folder`,
                            error(error) {
                                logout();
                            }
                        }).done(function (fragment) {
                            $('#fragment').replaceWith(fragment);
                        });
            
                    })
                    .fail(function (jqXHR, textStatus) {
                        logout();
                    });
            
                // id ê°€ query ì¸ ë…€ì„ ìœ„ì—ì„œ ì—”í„°ë¥¼ ëˆ„ë¥´ë©´ execSearch() í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ëœ»ì…ë‹ˆë‹¤.
                $('#query').on('keypress', function (e) {
                    if (e.key == 'Enter') {
                        execSearch();
                    }
                });
                $('#close').on('click', function () {
                    $('#container').removeClass('active');
                })
                $('#close2').on('click', function () {
                    $('#container2').removeClass('active');
                })
                $('.nav div.nav-see').on('click', function () {
                    $('div.nav-see').addClass('active');
                    $('div.nav-search').removeClass('active');
            
                    $('#see-area').show();
                    $('#search-area').hide();
                })
                $('.nav div.nav-search').on('click', function () {
                    $('div.nav-see').removeClass('active');
                    $('div.nav-search').addClass('active');
            
                    $('#see-area').hide();
                    $('#search-area').show();
                })
            
                $('#see-area').show();
                $('#search-area').hide();
            })
            
            function numberWithCommas(x) {
                return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }
            
            function execSearch() {
                /**
                 * ê²€ìƒ‰ì–´ input id: query
                 * ê²€ìƒ‰ê²°ê³¼ ëª©ë¡: #search-result-box
                 * ê²€ìƒ‰ê²°ê³¼ HTML ë§Œë“œëŠ” í•¨ìˆ˜: addHTML
                 */
                    // 1. ê²€ìƒ‰ì°½ì˜ ì…ë ¥ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                let query = $('#query').val();
            
                // 2. ê²€ìƒ‰ì°½ ì…ë ¥ê°’ì„ ê²€ì‚¬í•˜ê³ , ì…ë ¥í•˜ì§€ ì•Šì•˜ì„ ê²½ìš° focus.
                if (query == '') {
                    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    $('#query').focus();
                    return;
                }
                // 3. GET /api/search?query=${query} ìš”ì²­
                $.ajax({
                    type: 'GET',
                    url: `/api/search?query=${query}`,
                    success: function (response) {
                        $('#search-result-box').empty();
                        // 4. for ë¬¸ë§ˆë‹¤ itemDtoë¥¼ êº¼ë‚´ì„œ HTML ë§Œë“¤ê³  ê²€ìƒ‰ê²°ê³¼ ëª©ë¡ì— ë¶™ì´ê¸°!
                        for (let i = 0; i < response.length; i++) {
                            let itemDto = response[i];
                            let tempHtml = addHTML(itemDto);
                            $('#search-result-box').append(tempHtml);
                        }
                    },
                    error(error, status, request) {
                        logout();
                    }
                })
            
            }
            
            function addHTML(itemDto) {
                /**
                 * class="search-itemDto" ì¸ ë…€ì„ì—ì„œ
                 * image, title, lprice, addProduct í™œìš©í•˜ê¸°
                 * ì°¸ê³ ) onclick='addProduct(${JSON.stringify(itemDto)})'
                 */
                return `<div class="search-itemDto">
                    <div class="search-itemDto-left">
                        <img src="${itemDto.image}" alt="">
                    </div>
                    <div class="search-itemDto-center">
                        <div>${itemDto.title}</div>
                        <div class="price">
                            ${numberWithCommas(itemDto.lprice)}
                            <span class="unit">ì›</span>
                        </div>
                    </div>
                    <div class="search-itemDto-right">
                        <img src="../images/icon-save.png" alt="" onclick='addProduct(${JSON.stringify(itemDto)})'>
                    </div>
                </div>`
            }
            
            function addProduct(itemDto) {
                /**
                 * modal ëœ¨ê²Œ í•˜ëŠ” ë²•: $('#container').addClass('active');
                 * dataë¥¼ ajaxë¡œ ì „ë‹¬í•  ë•ŒëŠ” ë‘ ê°€ì§€ê°€ ë§¤ìš° ì¤‘ìš”
                 * 1. contentType: "application/json",
                 * 2. data: JSON.stringify(itemDto),
                 */
            
                // 1. POST /api/products ì— ê´€ì‹¬ ìƒí’ˆ ìƒì„± ìš”ì²­
                $.ajax({
                    type: 'POST',
                    url: '/api/products',
                    contentType: 'application/json',
                    data: JSON.stringify(itemDto),
                    success: function (response) {
                        // 2. ì‘ë‹µ í•¨ìˆ˜ì—ì„œ modalì„ ëœ¨ê²Œ í•˜ê³ , targetId ë¥¼ reponse.id ë¡œ ì„¤ì •
                        $('#container').addClass('active');
                        targetId = response.id;
                    },
                    error(error, status, request) {
                        logout();
                    }
                });
            }
            
            function showProduct(folderId = null) {
                /**
                 * ê´€ì‹¬ìƒí’ˆ ëª©ë¡: #product-container
                 * ê²€ìƒ‰ê²°ê³¼ ëª©ë¡: #search-result-box
                 * ê´€ì‹¬ìƒí’ˆ HTML ë§Œë“œëŠ” í•¨ìˆ˜: addProductItem
                 */
            
                let dataSource = null;
            
                var sorting = $("#sorting option:selected").val();
                var isAsc = $(':radio[name="isAsc"]:checked').val();
            
                if (folderId) {
                    dataSource = `/api/folders/${folderId}/products?sortBy=${sorting}&isAsc=${isAsc}`;
                } else if(folderTargetId === undefined) {
                    dataSource = `/api/products?sortBy=${sorting}&isAsc=${isAsc}&folderId=${folderId}`;
                } else {
                    dataSource = `/api/folders/${folderTargetId}/products?sortBy=${sorting}&isAsc=${isAsc}`;
                }
            
                $('#product-container').empty();
                $('#search-result-box').empty();
                $('#pagination').pagination({
                    dataSource,
                    locator: 'content',
                    alias: {
                        pageNumber: 'page',
                        pageSize: 'size'
                    },
                    totalNumberLocator: (response) => {
                        return response.totalElements;
                    },
                    pageSize: 10,
                    showPrevious: true,
                    showNext: true,
                    ajax: {
                        beforeSend: function () {
                            $('#product-container').html('ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
                        },
                        error(error, status, request) {
                            if (error.status === 403) {
                                $('html').html(error.responseText);
                                return;
                            }
                            logout();
                        }
                    },
                    callback: function (response, pagination) {
                        $('#product-container').empty();
                        for (let i = 0; i < response.length; i++) {
                            let product = response[i];
                            let tempHtml = addProductItem(product);
                            $('#product-container').append(tempHtml);
                        }
                    }
                });
            }
            
            // Folder ê´€ë ¨ ê¸°ëŠ¥
            function openFolder(folderId) {
                folderTargetId = folderId;
                $("button.product-folder").removeClass("folder-active");
                if (!folderId) {
                    $("button#folder-all").addClass('folder-active');
                } else {
                    $(`button[value='${folderId}']`).addClass('folder-active');
                }
                showProduct(folderId);
            }
            
            // í´ë” ì¶”ê°€ íŒì—…
            function openAddFolderPopup() {
                $('#container2').addClass('active');
            }
            
            // í´ë” Input ì¶”ê°€
            function addFolderInput() {
                $('#folders-input').append(
                    `<input type="text" class="folderToAdd" placeholder="ì¶”ê°€í•  í´ë”ëª…">
                   <span onclick="closeFolderInput(this)" style="margin-right:5px">
                        <svg xmlns="http://www.w3.org/2000/svg" width="30px" fill="red" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                          <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
                        </svg>
                   </span>
                  `
                );
            }
            
            function closeFolderInput(folder) {
                $(folder).prev().remove();
                $(folder).next().remove();
                $(folder).remove();
            }
            
            function addFolder() {
                const folderNames = $('.folderToAdd').toArray().map(input => input.value);
                try {
                    folderNames.forEach(name => {
                        if (name === '') {
                            alert('ì˜¬ë°”ë¥¸ í´ë”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                            throw new Error("stop loop");
                        }
                    });
                } catch (e) {
                    console.log(e);
                    return;
                }
            
                $.ajax({
                    type: "POST",
                    url: `/api/folders`,
                    contentType: "application/json",
                    data: JSON.stringify({
                        folderNames
                    })
                }).done(function (data, textStatus, xhr) {
                    if(data !== '') {
                        alert("ì¤‘ë³µëœ í´ë”ì…ë‹ˆë‹¤.");
                        return;
                    }
                    $('#container2').removeClass('active');
                    alert('ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    window.location.reload();
                })
                    .fail(function(xhr, textStatus, errorThrown) {
                        alert("ì¤‘ë³µëœ í´ë”ì…ë‹ˆë‹¤.");
                    });
            }
            
            function addProductItem(product) {
                const folders = product.productFolderList.map(folder =>
                    `
                        <span onclick="openFolder(${folder.id})">
                            #${folder.name}
                        </span>
                    `
                );
                return `<div class="product-card">
                            <div onclick="window.location.href='${product.link}'">
                                <div class="card-header">
                                    <img src="${product.image}"
                                         alt="">
                                </div>
                                <div class="card-body">
                                    <div class="title">
                                        ${product.title}
                                    </div>
                                    <div class="lprice">
                                        <span>${numberWithCommas(product.lprice)}</span>ì›
                                    </div>
                                    <div class="isgood ${product.lprice > product.myprice ? 'none' : ''}">
                                        ìµœì €ê°€
                                    </div>
                                </div>
                            </div>
                            <div class="product-tags" style="margin-bottom: 20px;">
                                ${folders}
                                <span onclick="addInputForProductToFolder(${product.id}, this)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30px" fill="currentColor" class="bi bi-folder-plus" viewBox="0 0 16 16">
                                        <path d="M.5 3l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.684.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
                                        <path d="M13.5 10a.5.5 0 0 1 .5.5V12h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V13h-1.5a.5.5 0 0 1 0-1H13v-1.5a.5.5 0 0 1 .5-.5z"/>
                                    </svg>
                                </span>
                            </div>
                        </div>`;
            }
            
            function addInputForProductToFolder(productId, button) {
                $.ajax({
                    type: 'GET',
                    url: `/api/folders`,
                    success: function (folders) {
                        const options = folders.map(folder => `<option value="${folder.id}">${folder.name}</option>`)
                        const form = `
                            <span>
                                <form id="folder-select" method="post" autocomplete="off" action="/api/products/${productId}/folder">
                                    <select name="folderId" form="folder-select">
                                        ${options}
                                    </select>
                                    <input type="submit" value="ì¶”ê°€" style="padding: 5px; font-size: 12px; margin-left: 5px;">
                                </form>
                            </span>
                        `;
                        $(form).insertBefore(button);
                        $(button).remove();
                        $("#folder-select").on('submit', function (e) {
                            e.preventDefault();
                            $.ajax({
                                type: $(this).prop('method'),
                                url: $(this).prop('action'),
                                data: $(this).serialize(),
                            }).done(function (data, textStatus, xhr) {
                                if(data !== '') {
                                    alert("ì¤‘ë³µëœ í´ë”ì…ë‹ˆë‹¤.");
                                    return;
                                }
                                alert('ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                window.location.reload();
                            })
                                .fail(function(xhr, textStatus, errorThrown) {
                                    alert("ì¤‘ë³µëœ í´ë”ì…ë‹ˆë‹¤.");
                                });
                        });
                    },
                    error(error, status, request) {
                        logout();
                    }
                });
            }
            
            function setMyprice() {
                /**
                 * 1. idê°€ myprice ì¸ input íƒœê·¸ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                 * 2. ë§Œì•½ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë©´ alertë¥¼ ë„ìš°ê³  ì¤‘ë‹¨í•œë‹¤.
                 * 3. PUT /api/product/${targetId} ì— dataë¥¼ ì „ë‹¬í•œë‹¤.
                 *    ì£¼ì˜) contentType: "application/json",
                 *         data: JSON.stringify({myprice: myprice}),
                 *         ë¹ ëœ¨ë¦¬ì§€ ë§ ê²ƒ!
                 * 4. ëª¨ë‹¬ì„ ì¢…ë£Œí•œë‹¤. $('#container').removeClass('active');
                 * 5, ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” alertë¥¼ ë„ìš´ë‹¤.
                 * 6. ì°½ì„ ìƒˆë¡œê³ ì¹¨í•œë‹¤. window.location.reload();
                 */
                    // 1. idê°€ myprice ì¸ input íƒœê·¸ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
                let myprice = $('#myprice').val();
                // 2. ë§Œì•½ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë©´ alertë¥¼ ë„ìš°ê³  ì¤‘ë‹¨í•œë‹¤.
                if (myprice == '') {
                    alert('ì˜¬ë°”ë¥¸ ê°€ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                    return;
                }
            
                // 3. PUT /api/product/${targetId} ì— dataë¥¼ ì „ë‹¬í•œë‹¤.
                $.ajax({
                    type: 'PUT',
                    url: `/api/products/${targetId}`,
                    contentType: 'application/json',
                    data: JSON.stringify({myprice: myprice}),
                    success: function (response) {
            
                        // 4. ëª¨ë‹¬ì„ ì¢…ë£Œí•œë‹¤. $('#container').removeClass('active');
                        $('#container').removeClass('active');
                        // 5. ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŒì„ ì•Œë¦¬ëŠ” alertë¥¼ ë„ìš´ë‹¤.
                        alert('ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        // 6. ì°½ì„ ìƒˆë¡œê³ ì¹¨í•œë‹¤. window.location.reload();
                        window.location.reload();
                    },
                    error(error, status, request) {
                        logout();
                    }
                })
            }
            
            function logout() {
                // í† í° ì‚­ì œ
                Cookies.remove('Authorization', {path: '/'});
                window.location.href = host + '/api/user/login-page';
            }
            
            function getToken() {
                let auth = Cookies.get('Authorization');
            
                if(auth === undefined) {
                    return '';
                }
            
                return auth;
            }
            ```
            
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] index.html**
            
            ```html
            <!doctype html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport"
                      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="preconnect" href="https://fonts.gstatic.com">
                <script src="https://code.jquery.com/jquery-3.7.0.min.js"
                        integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.min.js"></script>
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/paginationjs/2.1.4/pagination.css"/>
            
                <link rel="stylesheet" href="/css/style.css">
                <script src="/js/basic.js"></script>
                <title>ë‚˜ë§Œì˜ ì…€ë ‰ìƒµ</title>
            </head>
            <body>
            <div class="header" style="position:relative;">
                <!--headr-->
                <div id="header-title-login-user">
                    <span id="username"></span> ë‹˜ì˜
                </div>
                <div id="header-title-select-shop">
                    Select Shop
                </div>
                <a id="login-text" href="javascript:logout()">
                    ë¡œê·¸ì•„ì›ƒ
                </a>
                <!--/headr-->
            </div>
            <div class="nav">
                <div class="nav-see active">
                    ëª¨ì•„ë³´ê¸°
                </div>
                <div class="nav-search">
                    íƒìƒ‰í•˜ê¸°
                </div>
            </div>
            <div id="see-area">
                <div class="folder-bar folder-black">
                    <div>
                        <button id="folder-all" class="folder-bar-item folder-button product-folder folder-active" onclick="openFolder()">ì „ì²´</button>
                    </div>
                    <div id="fragment">
                        <div th:each="folder : ${folders}">
                            <button class="folder-bar-item folder-button product-folder"
                                    th:value="${folder.id}"
                                    th:utext="${folder.name}"
                                    th:attr="onclick=|openFolder(${folder.id})|">
                            </button>
                        </div>
                    </div>
                    <div>
                        <button id="folder-add" class="folder-bar-item folder-button product-folder" onclick="openAddFolderPopup()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30px" fill="currentColor" class="bi bi-folder-plus" viewBox="0 0 16 16">
                                <path d="M.5 3l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.684.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
                                <path d="M13.5 10a.5.5 0 0 1 .5.5V12h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V13h-1.5a.5.5 0 0 1 0-1H13v-1.5a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="pagination">
                    ì •ë ¬:
                    <select id="sorting" onchange="showProduct()">
                        <option value="id">ID</option>
                        <option value="title">ìƒí’ˆëª…</option>
                        <option value="lprice">ìµœì €ê°€</option>
                    </select>
                    <input type="radio" name="isAsc" value="true" onchange="showProduct()" checked/> ì˜¤ë¦„ì°¨ìˆœ
                    <input type="radio" name="isAsc" value="false" onchange="showProduct()"/> ë‚´ë¦¼ì°¨ìˆœ
                </div>
                <div id="pagination" class="pagination"></div>
                <br>
                <div id="product-container">
                </div>
                <div id="container2" class="popup-container">
                    <div class="popup" style="width:410px; height:auto">
                        <button id="close2" class="close">
                            X
                        </button>
                        <h1>ğŸ—‚ í´ë” ì¶”ê°€í•˜ê¸°</h1>
                        <p>í´ë”ë¥¼ ì¶”ê°€í•´ì„œ ê´€ì‹¬ìƒí’ˆì„ ê´€ë¦¬í•´ë³´ì„¸ìš”!</p>
                        <div id="folders-input">
                            <input type="text" class="folderToAdd" placeholder="ì¶”ê°€í•  í´ë”ëª…">
                            <!--                <div class="control" data-v-79d84978="" style="width:20px"><a class="button is-primary is-outlined" data-v-79d84978=""><span class="icon" data-v-79d84978=""><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512" class="svg-inline&#45;&#45;fa fa-times fa-w-11" data-v-79d84978=""><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z" data-v-79d84978="" class=""></path></svg></span></a></div>-->
                        </div>
                        <div onclick="addFolderInput()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="30px" fill="currentColor" class="bi bi-folder-plus" viewBox="0 0 16 16">
                                <path d="M.5 3l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2zm5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19c-.24 0-.47.042-.684.12L1.5 2.98a1 1 0 0 1 1-.98h3.672z"/>
                                <path d="M13.5 10a.5.5 0 0 1 .5.5V12h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V13h-1.5a.5.5 0 0 1 0-1H13v-1.5a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </div>
                        <button id="add-folder-btn" class="cta2" onclick="addFolder()">ì¶”ê°€í•˜ê¸°</button>
                    </div>
                </div>
            </div>
            <div id="search-area">
                <div>
                    <input type="text" id="query">
                </div>
                <div id="search-result-box">
            
                </div>
                <div id="container" class="popup-container">
                    <div class="popup">
                        <button id="close" class="close">
                            X
                        </button>
                        <h1>â°ìµœì €ê°€ ì„¤ì •í•˜ê¸°</h1>
                        <p>ìµœì €ê°€ë¥¼ ì„¤ì •í•´ë‘ë©´ ì„ íƒí•˜ì‹  ìƒí’ˆì˜ ìµœì €ê°€ê°€ ë–´ì„ ë•Œ<br/> í‘œì‹œí•´ë“œë ¤ìš”!</p>
                        <div>
                            <input type="text" id="myprice" placeholder="200,000">ì›
                        </div>
                        <button class="cta" onclick="setMyprice()">ì„¤ì •í•˜ê¸°</button>
                    </div>
                </div>
            </div>
            
            <input type="hidden" id="admin"/>
            </body>
            </html>
            ```
            
        
- í´ë” í…Œì´ë¸” ì„¤ê³„ ë° í´ë”ì™€ íšŒì›ì˜ ê´€ê³„
    - í´ë” í…Œì´ë¸”ì— í•„ìš”í•œ ì •ë³´
        1. **í´ë”ëª…(name)**: íšŒì›ì´ ë“±ë¡í•œ í´ë” ì´ë¦„ì„ ì €ì¥
        2. **íšŒì›ID(user)**: í´ë”ë¥¼ ë“±ë¡í•œ íšŒì›ì˜ ID ë¥¼ ì €ì¥
            - A íšŒì›ì´ ìƒì„±í•œ í´ë”ëŠ” A íšŒì›ì—ê²Œë§Œ ë³´ì—¬ì•¼ í•©ë‹ˆë‹¤.
            - í´ë”ì™€ íšŒì›ì˜ ê´€ê³„
                - 'í´ë”ì™€ íšŒì›'ì˜ ê´€ê³„ëŠ” 'ìƒí’ˆê³¼ íšŒì›'ì˜ ê´€ê³„ì™€ ë™ì¼í•©ë‹ˆë‹¤.
                
                !https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a4968f41-278f-4089-af61-d346b70c504a/Untitled.png
                
                - í´ë” : íšŒì› = N : 1, ë‹¤ëŒ€ì¼ ê´€ê³„ì…ë‹ˆë‹¤.
            - íšŒì› ê°ì²´ì—ì„œ í´ë” ê°ì²´ë¥¼ ì¡°íšŒí•˜ëŠ” ê²½ìš°ê°€ ì—†ê¸° ë•Œë¬¸ì— í´ë”ì™€ íšŒì›ì„  N : 1 ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] entity > Folder**
            
            ```java
            package com.sparta.myselectshop.entity;
            
            import jakarta.persistence.*;
            import lombok.Getter;
            import lombok.NoArgsConstructor;
            import lombok.Setter;
            
            @Entity
            @Getter
            @Setter
            @NoArgsConstructor
            @Table(name = "folder")
            public class Folder {
            
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;
            
                @Column(nullable = false)
                private String name;
            
                @ManyToOne(fetch = FetchType.LAZY)
                @JoinColumn(name = "user_id", nullable = false)
                private User user;
            
                public Folder(String name, User user) {
                    this.name = name;
                    this.user = user;
                }
            }
            ```
            
    
- ìƒí’ˆê³¼ í´ë”ì˜ ê´€ê³„
    1. ìƒí’ˆì€ ì¶”ê°€ë  í´ë”ì˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.
        
        ![data.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/37daa598-f0d4-417f-ab9a-4f4d43e8820d/data.png)
        
        - ê´€ì‹¬ ìƒí’ˆì— í´ë”ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
        - ìƒí’ˆì€ ì—¬ëŸ¬ ê°œì˜ í´ë”ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - í´ë” : ìƒí’ˆ = N : 1
    2. í´ë”ì— ê´€ì‹¬ ìƒí’ˆì„ ë“±ë¡í•©ë‹ˆë‹¤.
        
        ![data.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/24f91240-aba5-4cbc-9453-f41d2097aeb6/data.png)
        
        - í•˜ë‚˜ì˜ í´ë”ëŠ” ì—¬ëŸ¬ ê°œì˜ ìƒí’ˆì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - í´ë” : ìƒí’ˆ = 1 : N
    3. ê²°ê³¼ì ìœ¼ë¡œ ìƒí’ˆê³¼ í´ë”ëŠ” N : M ë‹¤ëŒ€ë‹¤ ê´€ê³„ì…ë‹ˆë‹¤.
        
        ![data.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a5d8f505-37fc-4dbf-b548-9f090d92c2c1/data.png)
        
        - @ManyToMany ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í’€ ìˆ˜ë„ ìˆì§€ë§Œ ìƒí’ˆ_í´ë” ì¤‘ê°„ í…Œì´ë¸”ì„ ì§ì ‘ ë§Œë“¤ì–´ í’€ì–´ë³´ê² ìŠµë‹ˆë‹¤.
        - ìƒí’ˆ : ìƒí’ˆ_í´ë” = 1 : N
        - í´ë” : ìƒí’ˆ_í´ë” = 1 : N
    4. ì—°ê´€ê´€ê³„ì˜ ë°©í–¥ì„ ì„ íƒí•©ë‹ˆë‹¤.
        - ê´€ì‹¬ ìƒí’ˆì„ ì¡°íšŒí•  ë•Œ í¬í•¨ëœ í´ë”ë“¤ì˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤. (ìƒí’ˆ ê°ì²´ê°€ í´ë” ê°ì²´ ì¡°íšŒ í•„ìš”!)
        - ìƒí’ˆ ê°ì²´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•´ë‹¹ í´ë”ì— í¬í•¨ëœ ìƒí’ˆë“¤ì„ ì¡°íšŒí•´ì•¼í•©ë‹ˆë‹¤. (ìƒí’ˆ ê°ì²´ê°€ í´ë” ê°ì²´ ì¡°íšŒ í•„ìš”!)
        - ë”°ë¼ì„œ ìƒí’ˆê³¼ ìƒí’ˆ_í´ë”ëŠ” ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì„¤ì •í•˜ê² ìŠµë‹ˆë‹¤.
        - í´ë” ê°ì²´ì—ì„œ ìƒí’ˆ ê°ì²´ë¥¼ ì¡°íšŒí•˜ì§€ ì•Šì„ ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— í´ë”ëŠ” ìƒí’ˆ_í´ë”ì™€ ê´€ê³„ë¥¼ ë§ºì§€ ì•Šê² ìŠµë‹ˆë‹¤.
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] entity > ProductFolder**
        
        ```java
        package com.sparta.myselectshop.entity;
        
        import jakarta.persistence.*;
        import lombok.Getter;
        import lombok.NoArgsConstructor;
        import lombok.Setter;
        
        @Entity
        @Getter
        @Setter
        @NoArgsConstructor
        @Table(name = "product_folder")
        public class ProductFolder {
            @Id
            @GeneratedValue(strategy = GenerationType.IDENTITY)
            private Long id;
        
            @ManyToOne(fetch = FetchType.LAZY)
            @JoinColumn(name = "product_id", nullable = false)
            private Product product;
        
            @ManyToOne(fetch = FetchType.LAZY)
            @JoinColumn(name = "folder_id", nullable = false)
            private Folder folder;
        
            public ProductFolder(Product product, Folder folder) {
                this.product = product;
                this.folder = folder;
            }
        }
        ```
        
    - **Product**
        
        ```java
        @OneToMany(mappedBy = "product")
        private List<ProductFolder> productFolderList = new ArrayList<>();
        ```
