# ë‚´ì¼ë°°ì›€ìº í”„ 240603 TIL
Java 35ì¼ì°¨
ì‚¬ìš©ì ê´€ë¦¬í•˜ê¸° (7~9)
-------------------------------------------------------------------------------


ì‚¬ìš©ì ê´€ë¦¬í•˜ê¸°
## 07. íšŒì›ê°€ì… êµ¬í˜„
- í”„ë¡œì íŠ¸ ì¤€ë¹„
    - í”„ë¡œì íŠ¸ ì„¤ì •ì¶”ê°€
        - build.gradle
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] build.gradle : JPA, MySQL ì¶”ê°€

                ```groovy
                // JPA
                implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
                // MySQL
                runtimeOnly 'com.mysql:mysql-connector-j'
                ```

        - application.properties
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] application.properties

                ```
                spring.datasource.url=jdbc:mysql://localhost:3306/auth
                spring.datasource.username=root
                spring.datasource.password={ë¹„ë°€ë²ˆí˜¸}
                spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

                spring.jpa.hibernate.ddl-auto=update

                spring.jpa.properties.hibernate.show_sql=true
                spring.jpa.properties.hibernate.format_sql=true
                spring.jpa.properties.hibernate.use_sql_comments=true
                ```

        - Intellij Database ì—°ë™
            - CREATE DATABASE

                ```sql
                CREATE DATABASE auth;
                ```

            - ì—°ë™ ìˆœì„œ
                1. Database íƒ­ì„ í´ë¦­í•˜ì‹œê³  + ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.
                2. Data Source > MySQL ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
                3. User, Password, Database ì •ë³´ë¥¼ ì¶”ê°€í•œ í›„ Okë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
                4. MySQL Databaseì— ì—°ê²°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

        - í˜ì´ì§€ Controller
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] HomeController

                ```java
                package com.sparta.springauth.controller;

                import org.springframework.stereotype.Controller;
                import org.springframework.ui.Model;
                import org.springframework.web.bind.annotation.GetMapping;

                @Controller
                public class HomeController {

                    @GetMapping("/")
                    public String home(Model model) {
                        model.addAttribute("username", "username");
                        return "index";
                    }
                }
                ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] UserController

                ```java
                package com.sparta.springauth.controller;

                import org.springframework.stereotype.Controller;
                import org.springframework.web.bind.annotation.GetMapping;
                import org.springframework.web.bind.annotation.RequestMapping;

                @Controller
                @RequestMapping("/api")
                public class UserController {

                    @GetMapping("/user/login-page")
                    public String loginPage() {
                        return "login";
                    }

                    @GetMapping("/user/signup")
                    public String signupPage() {
                        return "signup";
                    }
                }
                ```

    - ì‹œì‘ì½”ë“œ
        ğŸ‘‰ src > main > resources > templates ì— ì•„ë˜ html íŒŒì¼ë“¤ì˜ ì½”ë“œìŠ¤ë‹ˆí«ì„ ì‚¬ìš©í•˜ì—¬ ì¶”ê°€ í•´ì£¼ì„¸ìš”.
        (í˜¹ì‹œ ì—†ë‹¤ë©´ ë§Œë“¤ì–´ì£¼ì„¸ìš”.)
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] index.html**

            ```html
            <!doctype html>
            <html lang="en">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport"
                    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
              <meta http-equiv="X-UA-Compatible" content="ie=edge">
            	<link rel="preconnect" href="https://fonts.gstatic.com">

              <link rel="stylesheet" href="/css/style.css">
              <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
              <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
              <script src="/js/basic.js"></script>
              <title>ë‚˜ë§Œì˜ ì…€ë ‰ìƒµ</title>
            </head>
            <body>
            <div class="header" style="position:relative;">
              <div id="login-true" style="display: none">
                <div id="header-title-login-user">
                  <span th:text="${username}"></span> ë‹˜ì˜
                </div>
                <div id="header-title-select-shop">
                  Select Shop
                </div>
                <a id="login-text" href="javascript:logout()">
                  ë¡œê·¸ì•„ì›ƒ
                </a>
              </div>
              <div id="login-false" >
                <div id="header-title-select-shop">
                  My Select Shop
                </div>
                <a id="sign-text" href="/api/user/signup">
                  íšŒì›ê°€ì…
                </a>
                <a id="login-text" href="/api/user/login-page">
                  ë¡œê·¸ì¸
                </a>
              </div>
            </div>
            </body>
            </html>
            ```

        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] login.html**

            ```html
            <!DOCTYPE html>
            <html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport"
                    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
              <meta http-equiv="X-UA-Compatible" content="ie=edge">
              <link rel="preconnect" href="https://fonts.gstatic.com">
              <link rel="stylesheet" type="text/css" href="/css/style.css">
              <meta charset="UTF-8">
              <title>ë¡œê·¸ì¸ í˜ì´ì§€</title>
            </head>
            <body>
            <div id="login-form">
              <div id="login-title">Log into Select Shop</div>
              <br>
              <br>
              <button id="login-id-btn" onclick="location.href='/api/user/signup'">
                íšŒì› ê°€ì…í•˜ê¸°
              </button>
              <form action="/api/user/login" method="post">
                <div class="login-id-label">ì•„ì´ë””</div>
                <input type="text" name="username" class="login-input-box">

                <div class="login-id-label">ë¹„ë°€ë²ˆí˜¸</div>
                <input type="password" name="password" class="login-input-box">

                <button id="login-id-submit">ë¡œê·¸ì¸</button>
              </form>
              <div id="login-failed" style="display: none" class="alert alert-danger" role="alert">ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.</div>
            </div>
            </body>
            <script>
              const href = location.href;
              const queryString = href.substring(href.indexOf("?")+1)
              if (queryString === 'error') {
                const errorDiv = document.getElementById('login-failed');
                errorDiv.style.display = 'block';
              }
            </script>
            </html>
            ```

        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] signup.html**

            ```html
            <!DOCTYPE html>
            <html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
            <head>
              <meta charset="UTF-8">
              <meta name="viewport"
                    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
              <meta http-equiv="X-UA-Compatible" content="ie=edge">
              <link rel="preconnect" href="https://fonts.gstatic.com">
              <link rel="stylesheet" type="text/css" href="/css/style.css">
              <meta charset="UTF-8">
              <title>íšŒì›ê°€ì… í˜ì´ì§€</title>
              <script>
                function onclickAdmin() {
                  // Get the checkbox
                  var checkBox = document.getElementById("admin-check");
                  // Get the output text
                  var box = document.getElementById("admin-token");

                  // If the checkbox is checked, display the output text
                  if (checkBox.checked == true){
                    box.style.display = "block";
                  } else {
                    box.style.display = "none";
                  }
                }
              </script>
            </head>
            <body>
            <div id="login-form">
              <div id="login-title">Sign up Select Shop</div>

              <form action="/api/user/signup" method="post">
                <div class="login-id-label">Username</div>
                <input type="text" name="username" placeholder="Username" class="login-input-box">

                <div class="login-id-label">Password</div>
                <input type="password" name="password" class="login-input-box">

                <div class="login-id-label">E-mail</div>
                <input type="text" name="email" placeholder="E-mail" class="login-input-box">

                <div>
                  <input id="admin-check" type="checkbox" name="admin" onclick="onclickAdmin()" style="margin-top: 40px;">ê´€ë¦¬ì
                  <input id="admin-token" type="password" name="adminToken" placeholder="ê´€ë¦¬ì ì•”í˜¸" class="login-input-box" style="display:none">
                </div>
                <button id="login-id-submit">íšŒì› ê°€ì…</button>
              </form>
            </div>
            </body>
            </html>
            ```

        ğŸ‘‰ src > main > resources > static ì— css, js í´ë”ë¥¼ ë§Œë“¤ê³ , ì•„ë˜ css, js íŒŒì¼ì„ ë„£ì–´ì£¼ì„¸ìš”.
        - css
            - **[ì½”ë“œ ìŠ¤ë‹ˆí«] style.css**

                ```css
                * {
                    font-family: 'Georgia', serif;
                }

                body {
                    margin: 0px;
                }

                .header {
                    height: 255px;
                    box-sizing: border-box;
                    background-color: #15aabf;
                    color: white;
                    text-align: center;
                    padding-top: 80px;
                    /*padding: 50px;*/
                    font-size: 45px;
                    font-weight: bold;
                }

                #header-title-login-user {
                    font-size: 36px;
                    letter-spacing: -1.08px;
                }

                #header-title-select-shop {
                    margin-top: 20px;
                    font-size: 45px;
                    letter-spacing: 1.1px;
                }

                #login-form {
                    width: 538px;
                    height: 710px;
                    margin: 70px auto 141px auto;
                    display: flex;
                    flex-direction: column;
                    justify-content: flex-start;
                    align-items: center;
                    /*gap: 96px;*/
                    padding: 56px 0 0;
                    border-radius: 10px;
                    box-shadow: 0 4px 25px 0 rgba(0, 0, 0, 0.15);
                    background-color: #ffffff;
                }

                #login-title {
                    width: 303px;
                    height: 32px;
                    /*margin: 56px auto auto auto;*/
                    flex-grow: 0;
                    font-family: SpoqaHanSansNeo;
                    font-size: 32px;
                    font-weight: bold;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: 1;
                    letter-spacing: -0.96px;
                    text-align: left;
                    color: #212529;
                }

                #login-kakao-btn {
                    border-width: 0;
                    margin: 96px 0 8px;
                    width: 393px;
                    height: 62px;
                    flex-grow: 0;
                    display: flex;
                    flex-direction: row;
                    justify-content: center;
                    align-items: center;
                    gap: 10px;
                    /*margin: 0 0 8px;*/
                    padding: 11px 12px;
                    border-radius: 5px;
                    background-color: #ffd43b;

                    font-family: SpoqaHanSansNeo;
                    font-size: 20px;
                    font-weight: bold;
                    font-stretch: normal;
                    font-style: normal;
                    color: #414141;
                }

                #login-id-btn {
                    width: 393px;
                    height: 62px;
                    flex-grow: 0;
                    display: flex;
                    flex-direction: row;
                    justify-content: center;
                    align-items: center;
                    gap: 10px;
                    /*margin: 8px 0 0;*/
                    padding: 11px 12px;
                    border-radius: 5px;
                    border: solid 1px #212529;
                    background-color: #ffffff;

                    font-family: SpoqaHanSansNeo;
                    font-size: 20px;
                    font-weight: bold;
                    font-stretch: normal;
                    font-style: normal;
                    color: #414141;
                }

                .login-input-box {
                    border-width: 0;

                    width: 370px !important;
                    height: 52px;
                    margin: 14px 0 0;
                    border-radius: 5px;
                    background-color: #e9ecef;
                }

                .login-id-label {
                    /*width: 44.1px;*/
                    /*height: 16px;*/
                    width: 382px;
                    padding-left: 11px;
                    margin-top: 40px;
                    /*margin: 0 337.9px 14px 11px;*/
                    font-family: NotoSansCJKKR;
                    font-size: 16px;
                    font-weight: normal;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: 1;
                    letter-spacing: -0.8px;
                    text-align: left;
                    color: #212529;
                }

                #login-id-submit {
                    border-width: 0;
                    width: 393px;
                    height: 62px;
                    flex-grow: 0;
                    display: flex;
                    flex-direction: row;
                    justify-content: center;
                    align-items: center;
                    gap: 10px;
                    margin: 40px 0 0;
                    padding: 11px 12px;
                    border-radius: 5px;
                    background-color: #15aabf;

                    font-family: SpoqaHanSansNeo;
                    font-size: 20px;
                    font-weight: bold;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: 1;
                    letter-spacing: normal;
                    text-align: center;
                    color: #ffffff;
                }

                #sign-text {
                    position:absolute;
                    top:48px;
                    right:110px;
                    font-size: 18px;
                    font-family: SpoqaHanSansNeo;
                    font-size: 18px;
                    font-weight: 500;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: 1;
                    letter-spacing: 0.36px;
                    text-align: center;
                    color: #ffffff;
                }

                #login-text {
                    position:absolute;
                    top:48px;
                    right:50px;
                    font-size: 18px;
                    font-family: SpoqaHanSansNeo;
                    font-size: 18px;
                    font-weight: 500;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: 1;
                    letter-spacing: 0.36px;
                    text-align: center;
                    color: #ffffff;
                }

                .alert-danger {
                    color: #721c24;
                    background-color: #f8d7da;
                    border-color: #f5c6cb;
                }

                .alert {
                    width: 300px;
                    margin-top: 22px;
                    padding: 1.75rem 1.25rem;
                    border: 1px solid transparent;
                    border-radius: .25rem;
                }
                ```

        - js
            - **[ì½”ë“œ ìŠ¤ë‹ˆí«] basic.js**

                ```jsx
                let host = 'http://' + window.location.host;

                $(document).ready(function () {
                    const auth = getToken();
                    if(auth === '') {
                        window.location.href = host + "/api/user/login-page";
                    } else {
                        $('#login-true').show();
                        $('#login-false').hide();
                    }
                })

                function logout() {
                    // í† í° ì‚­ì œ
                    Cookies.remove('Authorization', { path: '/' });
                    window.location.href = host + "/api/user/login-page";
                }

                function getToken() {
                	  let auth = Cookies.get('Authorization');

                		if(auth === undefined) {
                	        return '';
                	   }

                		return auth;
                }
                ```

- íšŒì›ê°€ì… ì„¤ê³„
    [User í…Œì´ë¸”](https://www.notion.so/5377a9732499480a9ec298f53f500e25?pvs=21)

    - íšŒì› DBì— ë§¤í•‘ë˜ëŠ” **@Entity í´ë˜ìŠ¤** êµ¬í˜„
        - **[ì½”ë“œ ìŠ¤ë‹ˆí«] User**

            ```java
            package com.sparta.springauth.entity;

            import jakarta.persistence.*;
            import lombok.Getter;
            import lombok.NoArgsConstructor;
            import lombok.Setter;

            @Entity
            @Getter
            @Setter
            @NoArgsConstructor
            @Table(name = "users")
            public class User {
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;

                @Column(nullable = false, unique = true)
                private String username;

                @Column(nullable = false)
                private String password;

                @Column(nullable = false, unique = true)
                private String email;

                @Column(nullable = false)
                @Enumerated(value = EnumType.STRING)
                private UserRoleEnum role;
            }
            ```

        - `@Enumerated(value = EnumType.*STRING*)`
            - EnumTypeì„ DB ì»¬ëŸ¼ì— ì €ì¥í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì• ë„ˆí…Œì´ì…˜ì…ë‹ˆë‹¤.
            - `EnumType.*STRING`* ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ **Enumì˜ ì´ë¦„ì„ DBì— ê·¸ëŒ€ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
            - `USER(Authority.USER)` â†’ USER

    - ê´€ë¦¬ì íšŒì› ê°€ì… ì¸ê°€ ë°©ë²•
        - **'ê´€ë¦¬ì ê°€ì… í† í°'** ì…ë ¥ í•„ìš”

            : ëœë¤í•˜ê²Œ ìƒì„±ëœ í† í° ì‚¬ìš©

            ```
            "AAABnvxRVklrnYxKZ0aHgTBcXukeZygoC"
            ```

            ğŸ’¡ ì ê¹!
            ì‹¤ì œë¡œ 'ê´€ë¦¬ì' ê¶Œí•œì„ ì´ë ‡ê²Œ ì—‰ì„±í•˜ê²Œ ë¶€ì—¬í•´ ì£¼ëŠ” ê²½ìš°ëŠ” ë“œë­…ë‹ˆë‹¤.
            í•´ì»¤ê°€ í•´ë‹¹ ì•”í˜¸ë¥¼ ê°ˆì·¨í•˜ê²Œ ë˜ë©´, ê´€ë¦¬ì ê¶Œí•œì„ ë„ˆë¬´ ì‰½ê²Œ íšë“í•  ìˆ˜ ìˆê²Œ ë˜ê² ì£ ?

            ë³´í†µ í˜„ì—…ì—ì„œëŠ”
            1) 'ê´€ë¦¬ì' ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆëŠ” ê´€ë¦¬ì í˜ì´ì§€ êµ¬í˜„
            2) ìŠ¹ì¸ìì— ì˜í•œ ê²°ì¬ ê³¼ì • êµ¬í˜„ â†’ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬

- íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™” ì´í•´
    ğŸ”¥ íšŒì› ë“±ë¡ ì‹œ 'ë¹„ë°€ë²ˆí˜¸'ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ì ê·¸ëŒ€ë¡œ DB ì— ë“±ë¡í•˜ë©´  ì•ˆ ë©ë‹ˆë‹¤.
    'ì •ë³´í†µì‹ ë§ë²•, ê°œì¸ì •ë³´ë³´í˜¸ë²•' ì— ì˜í•´ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”(Encryption)ê°€ ì˜ë¬´ì…ë‹ˆë‹¤.

    - ì˜ˆë¥¼ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.
        - ì•¨ë¦¬ìŠ¤ê°€ ì—¬ëŸ¬ë¶„ì˜ ì‚¬ì´íŠ¸ì— íšŒì›ê°€ì…ì„ í•˜ë©° ì•„ì´ë””, íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì˜€ìŠµë‹ˆë‹¤.
            - ì•„ì´ë””: alice
            - íŒ¨ìŠ¤ì›Œë“œ: nobodynobody

        - ì•„ë¬´ë„ ì•Œ ìˆ˜ ì—†ê¸°ë¥¼ ë°”ë¼ë©° ì ì€ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ DB ì— í‰ë¬¸ ê·¸ëŒ€ë¡œ ì €ì¥í•´ ë‘ì—ˆë‹¤ê³  í•´ë³´ê² ìŠµë‹ˆë‹¤.
            - ë§Œì•½ í•´ì»¤ì— ì˜í•´ íšŒì›ì •ë³´ê°€ ê°ˆì·¨ë‹¹í•œë‹¤ë©´ ì•¨ë¦¬ìŠ¤ì˜ íŒ¨ìŠ¤ì›Œë“œëŠ” ëª¨ë‘ê°€ ì•Œê²Œ ë©ë‹ˆë‹¤.
            - ê¼­ í•´ì»¤ ë¿ë§Œ ì•„ë‹ˆê² ì£ . DB ì¡°íšŒê°€ ê°€ëŠ¥í•œ ë‚´ë¶€ ê´€ê³„ìë“¤ë„ ì•¨ë¦¬ìŠ¤ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ë³´ìë§ˆì ì˜ì›íˆ ê¸°ì–µí•´ ë²„ë¦´ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.

        - ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ **ì•”í˜¸í™” í›„ íŒ¨ìŠ¤ì›Œë“œ ì €ì¥**ì´ í•„ìš” í•©ë‹ˆë‹¤.
            - í‰ë¬¸ â†’ **(ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜)** â†’ ì•”í˜¸ë¬¸
                - "nobodynobody" â†’ "$2a$10$.."

        - ë§Œì•½ í•´ì»¤ê°€ DB ì— ìˆëŠ” ì•¨ë¦¬ìŠ¤ì˜ íŒ¨ìŠ¤ì›Œë“œ ì •ë³´ë¥¼ ê°ˆì·¨í•˜ë”ë¼ë„ ì‹¤ì œ ì•”í˜¸ë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•œ **'ë‹¨ë°©í–¥' ì•”í˜¸ ì•Œê³ ë¦¬ì¦˜** ì‚¬ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤.

    - ì–‘ë°©í–¥ â†”Â ë‹¨ë°©í–¥
        - ì–‘ë°©í–¥ ì•”í˜¸ ì•Œê³ ë¦¬ì¦˜
            - ì•”í˜¸í™”: í‰ë¬¸ â†’ **(ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜)** â†’ ì•”í˜¸ë¬¸
            - ë³µí˜¸í™”: ì•”í˜¸ë¬¸ â†’ (ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜) â†’ í‰ë¬¸
        - ë‹¨ë°©í–¥ ì•”í˜¸ ì•Œê³ ë¦¬ì¦˜
            - ì•”í˜¸í™”: í‰ë¬¸ â†’ **(ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜)** â†’ ì•”í˜¸ë¬¸
            - ë³µí˜¸í™”: **ë¶ˆê°€** (~~ì•”í˜¸ë¬¸ â†’ (ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜) â†’ í‰ë¬¸)~~

            â“ê·¸ëŸ¼ **ì‚¬ìš©ì**ê°€ ë¡œê·¸ì¸í•  ë•ŒëŠ” **ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œë¥¼ ê¸°ì–µ**í•´ì•¼ í• ê¹Œìš”?

            - Password í™•ì¸ì ˆì°¨
                1. ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ ìœ„í•´ "**ì•„ì´ë””,** **íŒ¨ìŠ¤ì›Œë“œ (í‰ë¬¸)"** ì…ë ¥ â†’ ì„œë²„ì— ë¡œê·¸ì¸ ìš”ì²­
                    1. ì„œë²„ì—ì„œ íŒ¨ìŠ¤ì›Œë“œ (í‰ë¬¸) ì„ ì•”í˜¸í™”
                    2. í‰ë¬¸ â†’ **(ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜)** â†’ ì•”í˜¸ë¬¸
                2. DB ì— ì €ì¥ëœ "**ì•„ì´ë””, íŒ¨ìŠ¤ì›Œë“œ (ì•”í˜¸ë¬¸)**"ì™€ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸

    - Password Matching
        ğŸ”¥ Spring Securityë¼ëŠ” í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.
        ì¼ì „ì— Bean ìˆ˜ë™ë“±ë¡ ì˜ˆì œë¡œ ë´¤ë˜ PasswordEncoderê°€ í•´ë‹¹ Securityì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ë©”ì„œë“œ ì…ë‹ˆë‹¤.
        ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„êµí•˜ì—¬ ì¼ì¹˜ì—¬ë¶€ë¥¼ í™•ì¸í•´ì£¼ëŠ” ê¸°ëŠ¥ë„ ê°€ì§€ê³  ìˆì–´ ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

        ```java
        // ì‚¬ìš©ì˜ˆì‹œ
        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        if(!passwordEncoder.matches("ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸", "ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸")) {
        		   throw new IllegalAccessError("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
         }
        ```

        - boolean matches(CharSequence rawPassword, String encodedPassword);
            - rawPassword : ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸
            - encodedPassword : ì•”í˜¸í™”ë˜ì–´ DB ì— ì €ì¥ëœ ë¹„ë°€ë²ˆí˜¸

- íšŒì›ê°€ì… API êµ¬í˜„
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] SignupRequestDto**

        ```java
        package com.sparta.springauth.dto;

        import lombok.Getter;
        import lombok.Setter;

        @Getter
        @Setter
        public class SignupRequestDto {
            private String username;
            private String password;
            private String email;
            private boolean admin = false;
            private String adminToken = "";
        }
        ```

    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] UserService**

        ```java
        package com.sparta.springauth.service;

        import com.sparta.springauth.dto.SignupRequestDto;
        import com.sparta.springauth.entity.User;
        import com.sparta.springauth.entity.UserRoleEnum;
        import com.sparta.springauth.repository.UserRepository;
        import org.springframework.security.crypto.password.PasswordEncoder;
        import org.springframework.stereotype.Service;

        import java.util.Optional;

        @Service
        public class UserService {

            private final UserRepository userRepository;
            private final PasswordEncoder passwordEncoder;

            public UserService(UserRepository userRepository, PasswordEncoder passwordEncoder) {
                this.userRepository = userRepository;
                this.passwordEncoder = passwordEncoder;
            }

            // ADMIN_TOKEN
            private final String ADMIN_TOKEN = "AAABnvxRVklrnYxKZ0aHgTBcXukeZygoC";

            public void signup(SignupRequestDto requestDto) {
                String username = requestDto.getUsername();
                String password = passwordEncoder.encode(requestDto.getPassword());

                // íšŒì› ì¤‘ë³µ í™•ì¸
                Optional<User> checkUsername = userRepository.findByUsername(username);
                if (checkUsername.isPresent()) {
                    throw new IllegalArgumentException("ì¤‘ë³µëœ ì‚¬ìš©ìê°€ ì¡´ì¬í•©ë‹ˆë‹¤.");
                }

                // email ì¤‘ë³µí™•ì¸
                String email = requestDto.getEmail();
                Optional<User> checkEmail = userRepository.findByEmail(email);
                if (checkEmail.isPresent()) {
                    throw new IllegalArgumentException("ì¤‘ë³µëœ Email ì…ë‹ˆë‹¤.");
                }

                // ì‚¬ìš©ì ROLE í™•ì¸
                UserRoleEnum role = UserRoleEnum.USER;
                if (requestDto.isAdmin()) {
                    if (!ADMIN_TOKEN.equals(requestDto.getAdminToken())) {
                        throw new IllegalArgumentException("ê´€ë¦¬ì ì•”í˜¸ê°€ í‹€ë ¤ ë“±ë¡ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
                    }
                    role = UserRoleEnum.ADMIN;
                }

                // ì‚¬ìš©ì ë“±ë¡
                User user = new User(username, password, email, role);
                userRepository.save(user);
            }
        }
        ```

## 08. ë¡œê·¸ì¸ êµ¬í˜„ : JWT
- ë¡œê·¸ì¸ API êµ¬í˜„
    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] LoginRequestDto**

        ```java
        package com.sparta.springauth.dto;

        import lombok.Getter;
        import lombok.Setter;

        @Setter
        @Getter
        public class LoginRequestDto {
            private String username;
            private String password;
        }
        ```

    - **[ì½”ë“œ ìŠ¤ë‹ˆí«] UserService**

        ```java
        package com.sparta.springauth.service;

        import com.sparta.springauth.dto.LoginRequestDto;
        import com.sparta.springauth.dto.SignupRequestDto;
        import com.sparta.springauth.entity.User;
        import com.sparta.springauth.entity.UserRoleEnum;
        import com.sparta.springauth.jwt.JwtUtil;
        import com.sparta.springauth.repository.UserRepository;
        import jakarta.servlet.http.HttpServletResponse;
        import org.springframework.security.crypto.password.PasswordEncoder;
        import org.springframework.stereotype.Service;

        import java.util.Optional;

        @Service
        public class UserService {

            private final UserRepository userRepository;
            private final PasswordEncoder passwordEncoder;
            private final JwtUtil jwtUtil;

            public UserService(UserRepository userRepository, PasswordEncoder passwordEncoder, JwtUtil jwtUtil) {
                this.userRepository = userRepository;
                this.passwordEncoder = passwordEncoder;
                this.jwtUtil = jwtUtil;
            }

            // ADMIN_TOKEN
            private final String ADMIN_TOKEN = "AAABnvxRVklrnYxKZ0aHgTBcXukeZygoC";

            public void signup(SignupRequestDto requestDto) {
                String username = requestDto.getUsername();
                String password = passwordEncoder.encode(requestDto.getPassword());

                // íšŒì› ì¤‘ë³µ í™•ì¸
                Optional<User> checkUsername = userRepository.findByUsername(username);
                if (checkUsername.isPresent()) {
                    throw new IllegalArgumentException("ì¤‘ë³µëœ ì‚¬ìš©ìê°€ ì¡´ì¬í•©ë‹ˆë‹¤.");
                }

                // email ì¤‘ë³µí™•ì¸
                String email = requestDto.getEmail();
                Optional<User> checkEmail = userRepository.findByEmail(email);
                if (checkEmail.isPresent()) {
                    throw new IllegalArgumentException("ì¤‘ë³µëœ Email ì…ë‹ˆë‹¤.");
                }

                // ì‚¬ìš©ì ROLE í™•ì¸
                UserRoleEnum role = UserRoleEnum.USER;
                if (requestDto.isAdmin()) {
                    if (!ADMIN_TOKEN.equals(requestDto.getAdminToken())) {
                        throw new IllegalArgumentException("ê´€ë¦¬ì ì•”í˜¸ê°€ í‹€ë ¤ ë“±ë¡ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
                    }
                    role = UserRoleEnum.ADMIN;
                }

                // ì‚¬ìš©ì ë“±ë¡
                User user = new User(username, password, email, role);
                userRepository.save(user);
            }

            public void login(LoginRequestDto requestDto, HttpServletResponse res) {
                String username = requestDto.getUsername();
                String password = requestDto.getPassword();

                // ì‚¬ìš©ì í™•ì¸
                User user = userRepository.findByUsername(username).orElseThrow(
                        () -> new IllegalArgumentException("ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.")
                );

                // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                if (!passwordEncoder.matches(password, user.getPassword())) {
                    throw new IllegalArgumentException("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }

                // JWT ìƒì„± ë° ì¿ í‚¤ì— ì €ì¥ í›„ Response ê°ì²´ì— ì¶”ê°€
                String token = jwtUtil.createToken(user.getUsername(), user.getRole());
                jwtUtil.addJwtToCookie(token, res);
            }
        }
        ```

## 09. í•„í„°
- Filterë€?
    - Filterë€ Web ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ê´€ë¦¬ë˜ëŠ” ì˜ì—­ìœ¼ë¡œ Clientë¡œ ë¶€í„° ì˜¤ëŠ” ìš”ì²­ê³¼ ì‘ë‹µì— ëŒ€í•´ ìµœì´ˆ/ìµœì¢… ë‹¨ê³„ì˜ ìœ„ì¹˜ì´ë©° ì´ë¥¼ í†µí•´ ìš”ì²­ê³¼ ì‘ë‹µì˜ ì •ë³´ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ì£¼ë¡œ ë²”ìš©ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ì‘ì—…ë“¤, ì˜ˆë¥¼ë“¤ì–´ ë¡œê¹… ë° ë³´ì•ˆ ì²˜ë¦¬ì— í™œìš©í•©ë‹ˆë‹¤.
        - ë˜í•œ ì¸ì¦, ì¸ê°€ì™€ ê´€ë ¨ëœ ë¡œì§ë“¤ì„ ì²˜ë¦¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
        - Filterë¥¼ ì‚¬ìš©í•˜ë©´ ì¸ì¦, ì¸ê°€ì™€ ê´€ë ¨ëœ ë¡œì§ì„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.

- Filter Chain
    - FilterëŠ” í•œ ê°œë§Œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì´ë ‡ê²Œ ì—¬ëŸ¬ ê°œê°€ Chain í˜•ì‹ìœ¼ë¡œ ë¬¶ì—¬ì„œ ì²˜ë¦¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- Filter ì ìš©
    ğŸ“Œ ìš”ì²­ URLì˜ ì¸ê°€ ì²˜ë¦¬ ë° ì¸ì¦ ì²˜ë¦¬ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆëŠ” Filterë¥¼ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.
    ì¶”ê°€ë¡œ ìš”ì²­ URLì„ ë¡œê¹…í•´ì£¼ëŠ” Filterë„ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.

    1. Request URL Logging

        ```java
        @Slf4j(topic = "LoggingFilter")
        @Component
        @Order(1)
        public class LoggingFilter implements Filter {
            @Override
            public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
                // ì „ì²˜ë¦¬
                HttpServletRequest httpServletRequest = (HttpServletRequest) request;
                String url = httpServletRequest.getRequestURI();
                log.info(url);

                chain.doFilter(request, response); // ë‹¤ìŒ Filter ë¡œ ì´ë™

                // í›„ì²˜ë¦¬
                log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì™„ë£Œ");
            }
        }
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] filter > LoggingFilter

            ```java
            package com.sparta.springauth.filter;

            import jakarta.servlet.*;
            import jakarta.servlet.http.HttpServletRequest;
            import lombok.extern.slf4j.Slf4j;
            import org.springframework.core.annotation.Order;
            import org.springframework.stereotype.Component;

            import java.io.IOException;

            @Slf4j(topic = "LoggingFilter")
            @Component
            @Order(1)
            public class LoggingFilter implements Filter {
                @Override
                public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
                    // ì „ì²˜ë¦¬
                    HttpServletRequest httpServletRequest = (HttpServletRequest) request;
                    String url = httpServletRequest.getRequestURI();
                    log.info(url);

                    chain.doFilter(request, response); // ë‹¤ìŒ Filter ë¡œ ì´ë™

                    // í›„ì²˜ë¦¬
                    log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì™„ë£Œ");
                }
            }
            ```

        - `@Order(1)` ë¡œ í•„í„°ì˜ ìˆœì„œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.
        - `chain.doFilter(request, response);` ë‹¤ìŒ Filterë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
        - `log.info("ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì™„ë£Œ");`
            - ì‘ì—…ì´ ë‹¤ ì™„ë£Œëœ í›„ Clientì— ì‘ë‹µ ì „ ë¡œê·¸ê°€ ì‘ì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    2. AuthFilter : ì¸ì¦ ë° ì¸ê°€ ì²˜ë¦¬ í•„í„°

        ```java
        @Slf4j(topic = "AuthFilter")
        @Component
        @Order(2)
        public class AuthFilter implements Filter {

            private final UserRepository userRepository;
            private final JwtUtil jwtUtil;

            public AuthFilter(UserRepository userRepository, JwtUtil jwtUtil) {
                this.userRepository = userRepository;
                this.jwtUtil = jwtUtil;
            }

            @Override
            public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
                HttpServletRequest httpServletRequest = (HttpServletRequest) request;
                String url = httpServletRequest.getRequestURI();

                if (StringUtils.hasText(url) &&
                        (url.startsWith("/api/user") || url.startsWith("/css") || url.startsWith("/js"))
                ) {
                    // íšŒì›ê°€ì…, ë¡œê·¸ì¸ ê´€ë ¨ API ëŠ” ì¸ì¦ í•„ìš”ì—†ì´ ìš”ì²­ ì§„í–‰
                    chain.doFilter(request, response); // ë‹¤ìŒ Filter ë¡œ ì´ë™
                } else {
                    // ë‚˜ë¨¸ì§€ API ìš”ì²­ì€ ì¸ì¦ ì²˜ë¦¬ ì§„í–‰
                    // í† í° í™•ì¸
                    String tokenValue = jwtUtil.getTokenFromRequest(httpServletRequest);

                    if (StringUtils.hasText(tokenValue)) { // í† í°ì´ ì¡´ì¬í•˜ë©´ ê²€ì¦ ì‹œì‘
                        // JWT í† í° substring
                        String token = jwtUtil.substringToken(tokenValue);

                        // í† í° ê²€ì¦
                        if (!jwtUtil.validateToken(token)) {
                            throw new IllegalArgumentException("Token Error");
                        }

                        // í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                        Claims info = jwtUtil.getUserInfoFromToken(token);

                        User user = userRepository.findByUsername(info.getSubject()).orElseThrow(() ->
                                new NullPointerException("Not Found User")
                        );

                        request.setAttribute("user", user);
                        chain.doFilter(request, response); // ë‹¤ìŒ Filter ë¡œ ì´ë™
                    } else {
                        throw new IllegalArgumentException("Not Found Token");
                    }
                }
            }

        }
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] filter > AuthFilter

            ```java
            package com.sparta.springauth.filter;

            import com.sparta.springauth.entity.User;
            import com.sparta.springauth.jwt.JwtUtil;
            import com.sparta.springauth.repository.UserRepository;
            import io.jsonwebtoken.Claims;
            import jakarta.servlet.*;
            import jakarta.servlet.http.HttpServletRequest;
            import lombok.extern.slf4j.Slf4j;
            import org.springframework.core.annotation.Order;
            import org.springframework.stereotype.Component;
            import org.springframework.util.StringUtils;

            import java.io.IOException;

            @Slf4j(topic = "AuthFilter")
            @Component
            @Order(2)
            public class AuthFilter implements Filter {

                private final UserRepository userRepository;
                private final JwtUtil jwtUtil;

                public AuthFilter(UserRepository userRepository, JwtUtil jwtUtil) {
                    this.userRepository = userRepository;
                    this.jwtUtil = jwtUtil;
                }

                @Override
                public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
                    HttpServletRequest httpServletRequest = (HttpServletRequest) request;
                    String url = httpServletRequest.getRequestURI();

                    if (StringUtils.hasText(url) &&
                            (url.startsWith("/api/user") || url.startsWith("/css") || url.startsWith("/js"))
                    ) {
                        // íšŒì›ê°€ì…, ë¡œê·¸ì¸ ê´€ë ¨ API ëŠ” ì¸ì¦ í•„ìš”ì—†ì´ ìš”ì²­ ì§„í–‰
                        chain.doFilter(request, response); // ë‹¤ìŒ Filter ë¡œ ì´ë™
                    } else {
                        // ë‚˜ë¨¸ì§€ API ìš”ì²­ì€ ì¸ì¦ ì²˜ë¦¬ ì§„í–‰
                        // í† í° í™•ì¸
                        String tokenValue = jwtUtil.getTokenFromRequest(httpServletRequest);

                        if (StringUtils.hasText(tokenValue)) { // í† í°ì´ ì¡´ì¬í•˜ë©´ ê²€ì¦ ì‹œì‘
                            // JWT í† í° substring
                            String token = jwtUtil.substringToken(tokenValue);

                            // í† í° ê²€ì¦
                            if (!jwtUtil.validateToken(token)) {
                                throw new IllegalArgumentException("Token Error");
                            }

                            // í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                            Claims info = jwtUtil.getUserInfoFromToken(token);

                            User user = userRepository.findByUsername(info.getSubject()).orElseThrow(() ->
                                    new NullPointerException("Not Found User")
                            );

                            request.setAttribute("user", user);
                            chain.doFilter(request, response); // ë‹¤ìŒ Filter ë¡œ ì´ë™
                        } else {
                            throw new IllegalArgumentException("Not Found Token");
                        }
                    }
                }

            }
            ```

        - `httpServletRequest.getRequestURI()` ìš”ì²­ URLì„ ê°€ì ¸ì™€ì„œ êµ¬ë¶„í•©ë‹ˆë‹¤. (ì¸ê°€)
            - `"/api/user"`, `"/css"`, `"/js"` ë¡œ ì‹œì‘í•˜ëŠ” URLì€ ì¸ì¦ ì²˜ë¦¬ì—ì„œ ì œì™¸ ì‹œí‚µë‹ˆë‹¤.
        - ê·¸ ì™¸ URLì€ ì¸ì¦ ì²˜ë¦¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
            - `jwtUtil.getTokenFromRequest(httpServletRequest);`
                - `httpServletRequest` ì—ì„œ Cookie ëª©ë¡ì„ ê°€ì ¸ì™€ JWTê°€ ì €ì¥ëœ Cookieë¥¼ ì°¾ìŠµë‹ˆë‹¤.
                - `getTokenFromRequest` ë©”ì„œë“œë¥¼ JwtUtilì— êµ¬í˜„í•©ë‹ˆë‹¤.

                    ```java
                    // HttpServletRequest ì—ì„œ Cookie Value : JWT ê°€ì ¸ì˜¤ê¸°
                    public String getTokenFromRequest(HttpServletRequest req) {
                        Cookie[] cookies = req.getCookies();
                        if(cookies != null) {
                            for (Cookie cookie : cookies) {
                                if (cookie.getName().equals(AUTHORIZATION_HEADER)) {
                                    try {
                                        return URLDecoder.decode(cookie.getValue(), "UTF-8"); // Encode ë˜ì–´ ë„˜ì–´ê°„ Value ë‹¤ì‹œ Decode
                                    } catch (UnsupportedEncodingException e) {
                                        return null;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                    ```

                    - [ì½”ë“œ ìŠ¤ë‹ˆí«] getTokenFromRequest

                        ```java
                        // HttpServletRequest ì—ì„œ Cookie Value : JWT ê°€ì ¸ì˜¤ê¸°
                        public String getTokenFromRequest(HttpServletRequest req) {
                            Cookie[] cookies = req.getCookies();
                            if(cookies != null) {
                                for (Cookie cookie : cookies) {
                                    if (cookie.getName().equals(AUTHORIZATION_HEADER)) {
                                        try {
                                            return URLDecoder.decode(cookie.getValue(), "UTF-8"); // Encode ë˜ì–´ ë„˜ì–´ê°„ Value ë‹¤ì‹œ Decode
                                        } catch (UnsupportedEncodingException e) {
                                            return null;
                                        }
                                    }
                                }
                            }
                            return null;
                        }
                        ```

            - tokenValueê°€ ì¡´ì¬í•˜ë©´ í† í° íŒŒì‹±, ê²€ì¦ì„ ì§„í–‰í•˜ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            - ê°€ì ¸ì˜¨ ì‚¬ìš©ì usernameì„ ì‚¬ìš©í•´ì„œ DBì— ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì¡´ì¬í•˜ë©´ ì¸ì¦ì´ ì™„ë£Œëœ ê²ƒì…ë‹ˆë‹¤.
            - ì‚¬ìš©ì ì •ë³´ê°€ í•„ìš”í•œ Controller APIì— ì¸ì¦ì™„ë£Œëœ User ê°ì²´ë¥¼ ì „ë‹¬í•´ ì¤ë‹ˆë‹¤.

                ```java
                @Controller
                @RequestMapping("/api")
                public class ProductController {

                    @GetMapping("/products")
                    public String getProducts(HttpServletRequest req) {
                        System.out.println("ProductController.getProducts : ì¸ì¦ ì™„ë£Œ");
                        User user = (User) req.getAttribute("user");
                        System.out.println("user.getUsername() = " + user.getUsername());

                       return "redirect:/";
                    }
                }
                ```

                - [ì½”ë“œ ìŠ¤ë‹ˆí«] ProductController

                    ```java
                    package com.sparta.springauth.controller;

                    import com.sparta.springauth.entity.User;
                    import jakarta.servlet.http.HttpServletRequest;
                    import org.springframework.stereotype.Controller;
                    import org.springframework.web.bind.annotation.GetMapping;
                    import org.springframework.web.bind.annotation.RequestMapping;

                    @Controller
                    @RequestMapping("/api")
                    public class ProductController {

                        @GetMapping("/products")
                        public String getProducts(HttpServletRequest req) {
                            System.out.println("ProductController.getProducts : ì¸ì¦ ì™„ë£Œ");
                            User user = (User) req.getAttribute("user");
                            System.out.println("user.getUsername() = " + user.getUsername());

                            return "redirect:/";
                        }
                    }
                    ```

                - ì‚¬ìš©ì ë³¸ì¸ì´ ë“±ë¡í•œ ì œí’ˆë§Œ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì˜ APIë¼ ê°€ì •í•´ë³´ê² ìŠµë‹ˆë‹¤.
                - Filterì—ì„œ ì¸ì¦ ì²˜ë¦¬ë˜ì–´ ë„˜ì–´ì˜¨ User ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ API ìš”ì²­ì„ í•œ í•´ë‹¹ ì‚¬ìš©ìê°€ ë“±ë¡í•œ ì œí’ˆë§Œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.