# ë‚´ì¼ë°°ì›€ìº í”„ 240522 TIL
Java 25ì¼ì°¨
JPA CORE(~9)
-------------------------------------------------------------------------------


## JPAë€ ë¬´ì—‡ì¼ê¹Œ?
- DBë¥¼ ì§ì ‘ ë‹¤ë£° ë•Œì˜ ë¬¸ì œì 
    ### 1. ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì•„ë˜ í˜•íƒœì˜ ê°ì²´ ë°ì´í„°ë¥¼ DBì— ì €ì¥í•´ì„œ ê´€ë¦¬í•´ì•¼í•œë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?
    ```java
    public class Memo {
        private Long id;
        private String username;
        private String contents;
    }

    - 1) DB í…Œì´ë¸” ë§Œë“¤ê¸°
        ```sql
        create table memo (
               id bigint not null auto_increment,
                contents varchar(500) not null,
                username varchar(255) not null,
                primary key (id)
        );
        ```
        - ì´ì²˜ëŸ¼ ì§ì ‘ DBë¡œ ì ‘ì†í•´ì„œ SQLì„ í˜¸ì¶œí•´ì•¼í•©ë‹ˆë‹¤.

    - 2) ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ SQL ì‘ì„±
        ```java
        String sql = "INSERT INTO memo (username, contents) VALUES (?, ?)";
        String sql = "SELECT * FROM memo";
        ```

    - 3) SQLì„ JDBCë¥¼ ì‚¬ìš©í•´ì„œ ì§ì ‘ ì‹¤í–‰í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
        ```java
        jdbcTemplate.update(sql, "Robbie", "ì˜¤ëŠ˜ í•˜ë£¨ë„ í™”ì´íŒ…!");
        jdbcTemplate.query(sql, ...);
        ```

    - 4) SQL ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ì§ì ‘ ë§Œë“¤ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
        ```java
        @Override
        public MemoResponseDto mapRow(ResultSet rs, int rowNum) throws SQLException {
        		// SQL ì˜ ê²°ê³¼ë¡œ ë°›ì•„ì˜¨ Memo ë°ì´í„°ë“¤ì„ MemoResponseDto íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•´ì¤„ ë©”ì„œë“œ
        		Long id = rs.getLong("id");
        		String username = rs.getString("username");
        		String contents = rs.getString("contents");
        		return new MemoResponseDto(id, username, contents);
        }
        ```

    ### 2. SQL ì˜ì¡´ì ì´ë¼ ë³€ê²½ì— ì·¨ì•½í•©ë‹ˆë‹¤
    - ë©”ëª¨ ë°ì´í„°ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ê°€í•´ì•¼ í•œë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œìš”?
    ```java
    public class Memo {
        private Long id;
        private String username;
        private String contents;

    		// ë¹„ë°€ë²ˆí˜¸ ì¶”ê°€
    		private String password;
    }

    - 1) SQLì„ ì§ì ‘ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
        ```java
        String sql = "INSERT INTO memo (username, contents, password) VALUES (?, ?, ?)";
        ```

    - 2) MemoResponseDto ê°ì²´ì— ê°’ì„ ë„£ì–´ì£¼ëŠ” ë¶€ë¶„ë„ ë‹¹ì—°íˆ ì¶”ê°€í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
        ```java
        @Override
        public MemoResponseDto mapRow(ResultSet rs, int rowNum) throws SQLException {
        		// SQL ì˜ ê²°ê³¼ë¡œ ë°›ì•„ì˜¨ Memo ë°ì´í„°ë“¤ì„ MemoResponseDto íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•´ì¤„ ë©”ì„œë“œ
        		Long id = rs.getLong("id");
        		String username = rs.getString("username");
        		String contents = rs.getString("contents");
        		String password = rs.getString("password");
        		return new MemoResponseDto(id, username, contents, password);
        }
        ```

    ğŸ“Œ ë‹¨ìˆœíˆ ë©”ëª¨ì¥ì— ë¹„ë°€ë²ˆí˜¸ í•˜ë‚˜ ë” ì¶”ê°€í–ˆëŠ”ë° í•´ì•¼í•˜ëŠ” ì¼ë“¤ì´ ì—„ì²­ ë§ì´ ìƒê²¼ìŠµë‹ˆë‹¤.
    ì´ì²˜ëŸ¼ ORM ì´ ì—†ëŠ” í™˜ê²½ì—ì„œëŠ” ë°±ì—”ë“œ ê°œë°œìê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê°œë°œë³´ë‹¤,
    SQL ì‘ì„± ë° ìˆ˜ì •ì— ë” ë§ì€ ë…¸ë ¥ì„ ë“¤ì—¬ì•¼ í–ˆì—ˆìŠµë‹ˆë‹¤.

- ORMì´ë€?

    ğŸ’¡ ORM : Object-Relational Mapping
    Object : **"ê°ì²´"**ì§€í–¥ ì–¸ì–´ (ìë°”, íŒŒì´ì¬)
    Relational : **"ê´€ê³„í˜•"** ë°ì´í„°ë² ì´ìŠ¤ (H2, MySQL)
    ğŸ“Œ ë°˜ë³µì ì´ê³  ë²ˆê±°ë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ì—ì„œì˜ SQL ì‘ì—…ì„ ì¤„ì—¬ì£¼ê¸° ìœ„í•´ì„œ ORM(ê°ì²´ ê´€ê³„ ë§¤í•‘)ê¸°ìˆ ë“¤ì´ ë“±ì¥ í•˜ê²Œ ë©ë‹ˆë‹¤.
    - ORMì€ ì´ë¦„ ê·¸ëŒ€ë¡œ ê°ì²´ì™€ DBì˜ ê´€ê³„ë¥¼ ë§¤í•‘ í•´ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
        - ê°ì²´ ì¦‰, ìë°”ì˜ í´ë˜ìŠ¤ì™€ DBì˜ ë°ì´í„°ë¥¼ ì§ì ‘ ë§¤í•‘ í•˜ë ¤ë©´ ì•ì„œ ì‚´í´ë³¸ ê²ƒ ì²˜ëŸ¼ ë§¤ìš° ë²ˆê±°ë¡­ê³  ë§ì€ ì‘ì—…ë“¤ì´ í•„ìš”í–ˆì§€ë§Œ ORMì„ ì‚¬ìš©í•˜ë©´ ì´ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤ë‹ˆë‹¤.

- JPAë€?
    ğŸ’¡ JPA: Java Persistence API
    ìë°” ORM ê¸°ìˆ ì— ëŒ€í•œ í‘œì¤€ ëª…ì„¸
    - JPAëŠ” Java ORM ê¸°ìˆ ì˜ ëŒ€í‘œì ì¸ í‘œì¤€ ëª…ì„¸ì…ë‹ˆë‹¤.
    - JPAëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ JDBC ì‚¬ì´ì—ì„œ ë™ì‘ë˜ê³  ìˆìŠµë‹ˆë‹¤.
    - JPAë¥¼ ì‚¬ìš©í•˜ë©´ DB ì—°ê²° ê³¼ì •ì„ ì§ì ‘ ê°œë°œí•˜ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì¤ë‹ˆë‹¤.
    - ë˜í•œ ê°ì²´ë¥¼ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ DB ë°ì´í„°ë¥¼ ë‹¤ë£° ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë§¤ìš° ì‰½ê²Œ DB ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    - í•˜ì´ë²„ë„¤ì´íŠ¸(Hibernate)ë€?
        - JPA ëŠ” í‘œì¤€ ëª…ì„¸ì´ê³ , ì´ë¥¼ ì‹¤ì œ êµ¬í˜„í•œ í”„ë ˆì„ì›Œí¬ ì¤‘ **ì‚¬ì‹¤ìƒ í‘œì¤€**ì´ **í•˜ì´ë²„ë„¤ì´íŠ¸**ì…ë‹ˆë‹¤.
        - ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ â€˜**í•˜ì´ë²„ë„¤ì´íŠ¸â€™** êµ¬í˜„ì²´ë¥¼ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.
        > ì‚¬ì‹¤ìƒ í‘œì¤€ (de facto, ë””íŒ©í† )
        ë³´í†µ ê¸°ì—…ê°„ ì¹˜ì—´í•œ ê²½ìŸì„ í†µí•´ ì‹œì¥ì—ì„œ ê²°ì •ë˜ëŠ” ë¹„ ê³µì‹ì  í‘œì¤€ì´ë‹¤

## 07. Entity ì´í•´í•˜ê¸°
- Entityë€?
    - JPAì—ì„œ ê´€ë¦¬ë˜ëŠ” í´ë˜ìŠ¤ ì¦‰, ê°ì²´ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
    - Entity í´ë˜ìŠ¤ëŠ” DBì˜ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ì–´ JPAì— ì˜í•´ ê´€ë¦¬ë©ë‹ˆë‹¤.

- í”„ë¡œì íŠ¸ ìƒì„±
    - í”„ë¡œì íŠ¸ ì¤€ë¹„í•˜ê¸°
        1. IntelliJë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        2. New Projectë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        3. ì™¼ìª½ ë©”ë‰´ì—ì„œ "New Projectâ€ë¥¼ í´ë¦­í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
        4.  ğŸš’**[ì¤‘ìš”] ê¼­ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.**
            - Name: jpa-core
            - **Language: Java**
            - **Build system: Gradle**
            - **JDK: 17**
            - **Gradle DSL:** **Groovy**
            - GroupId: com.sparta
            - ArtifactId: jpa-core
            - í”„ë¡œì íŠ¸ ê²½ë¡œ(Location)ëŠ” ììœ ë¡­ê²Œ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
        5. Createë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

    - í”„ë¡œì íŠ¸ ì„¤ì •ì¶”ê°€
        - src > main > resources > META-INF > persistence.xml
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] persistence.xml
                ```xml
                <?xml version="1.0" encoding="UTF-8"?>
                <persistence version="2.2"
                             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
                    <persistence-unit name="memo">
                        <class>com.sparta.entity.Memo</class>
                        <properties>
                            <property name="jakarta.persistence.jdbc.driver" value="com.mysql.cj.jdbc.Driver"/>
                            <property name="jakarta.persistence.jdbc.user" value="root"/>
                            <property name="jakarta.persistence.jdbc.password" value="{ë¹„ë°€ë²ˆí˜¸}"/>
                            <property name="jakarta.persistence.jdbc.url" value="jdbc:mysql://localhost:3306/memo"/>

                            <property name="hibernate.hbm2ddl.auto" value="create" />

                            <property name="hibernate.show_sql" value="true"/>
                            <property name="hibernate.format_sql" value="true"/>
                            <property name="hibernate.use_sql_comments" value="true"/>
                        </properties>
                    </persistence-unit>
                </persistence>
                ```

        - build.gradle
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] build.gradle : JPA, MySQL ì¶”ê°€
                ```groovy
                // JPA êµ¬í˜„ì²´ì¸ hibernate
                implementation 'org.hibernate:hibernate-core:6.1.7.Final'
                // MySQL
                implementation 'mysql:mysql-connector-java:8.0.28'
                ```

        - Intellij Database ì—°ë™
            - CREATE DATABASE
                ```sql
                CREATE DATABASE memo;
                ```

            - ì—°ë™ ìˆœì„œ
                1. Database íƒ­ì„ í´ë¦­í•˜ì‹œê³  + ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.
                2. Data Source > MySQL ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
                3. User, Password, Database ì •ë³´ë¥¼ ì¶”ê°€í•œ í›„ Okë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
                4. MySQL Databaseì— ì—°ê²°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

        - EntityTest
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] EntityTest
                ```java
                import jakarta.persistence.EntityManager;
                import jakarta.persistence.EntityManagerFactory;
                import jakarta.persistence.Persistence;
                import org.junit.jupiter.api.BeforeEach;
                import org.junit.jupiter.api.Test;

                public class EntityTest {

                    EntityManagerFactory emf;
                    EntityManager em;

                    @BeforeEach
                    void setUp() {
                        emf = Persistence.createEntityManagerFactory("memo");
                        em = emf.createEntityManager();
                    }

                    @Test
                    void test1() {

                    }
                }
                ```

- Entity í´ë˜ìŠ¤ ë§Œë“¤ê¸°
    - Memo Entity
    ```java
    @Entity // JPAê°€ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” Entity í´ë˜ìŠ¤ ì§€ì •
    @Table(name = "memo") // ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì§€ì •
    public class Memo {
        @Id
        private Long id;

        // nullable: null í—ˆìš© ì—¬ë¶€
        // unique: ì¤‘ë³µ í—ˆìš© ì—¬ë¶€ (false ì¼ë•Œ ì¤‘ë³µ í—ˆìš©)
        @Column(name = "username", nullable = false, unique = true)
        private String username;

        // length: ì»¬ëŸ¼ ê¸¸ì´ ì§€ì •
        @Column(name = "contents", nullable = false, length = 500)
        private String contents;
    }
    ```
    - [ì½”ë“œ ìŠ¤ë‹ˆí«] Memo Entity

        ```java
        package com.sparta.entity;

        import jakarta.persistence.Column;
        import jakarta.persistence.Entity;
        import jakarta.persistence.Id;
        import jakarta.persistence.Table;

        @Entity // JPAê°€ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” Entity í´ë˜ìŠ¤ ì§€ì •
        @Table(name = "memo") // ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì§€ì •
        public class Memo {
            @Id
            private Long id;

            // nullable: null í—ˆìš© ì—¬ë¶€
            // unique: ì¤‘ë³µ í—ˆìš© ì—¬ë¶€ (false ì¼ë•Œ ì¤‘ë³µ í—ˆìš©)
            @Column(name = "username", nullable = false, unique = true)
            private String username;

            // length: ì»¬ëŸ¼ ê¸¸ì´ ì§€ì •
            @Column(name = "contents", nullable = false, length = 500)
            private String contents;
        }
        ```

    - SQL í™•ì¸
        - create memo table
            ```sql
            create table memo (
                   id bigint not null,
                    contents varchar(500) not null,
                    username varchar(255) not null,
                    primary key (id)
            );
            ```
        - alter username unique
            ```sql
            alter table memo
                   add constraint username_UK unique (username);
            ```

    - **@Entity** : JPAê°€ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” Entity í´ë˜ìŠ¤ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - **@Entity(name = "Memo") :** Entity í´ë˜ìŠ¤ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (default: í´ë˜ìŠ¤ëª…)
        - JPAê°€ Entity í´ë˜ìŠ¤ë¥¼ ì¸ìŠ¤í„´ìŠ¤í™” í•  ë•Œ ê¸°ë³¸ ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ í˜„ì¬ Entity í´ë˜ìŠ¤ì—ì„œ ê¸°ë³¸ ìƒì„±ìê°€ ìƒì„±ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
    - **@Table** : ë§¤í•‘í•  í…Œì´ë¸”ì„ ì§€ì •í•´ì¤ë‹ˆë‹¤.
        - **@Table(name = "memo") :** ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (default: Entity ëª…)
    - **@Column** :
        - **@Column(name = "username") :** í•„ë“œì™€ ë§¤í•‘í•  ****í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (default: ê°ì²´ì˜ í•„ë“œëª…)
        - **@Column(nullable =  false) :** ë°ì´í„°ì˜ null ê°’ í—ˆìš© ì—¬ë¶€ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (default: true)
        - **@Column(unique = true) :** ë°ì´í„°ì˜ ì¤‘ë³µ ê°’ í—ˆìš© ì—¬ë¶€ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (default: false)
        - **@Column(length =  500) :** ë°ì´í„° ê°’(ë¬¸ì)ì˜ ê¸¸ì´ì— ì œì•½ì¡°ê±´ì„ ê±¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (default: 255)
    - **@Id** : í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ì§€ì •í•´ì¤ë‹ˆë‹¤.
        - ì´ ê¸°ë³¸ í‚¤ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ Entityë¥¼ êµ¬ë¶„í•˜ê³  ê´€ë¦¬í•  ë•Œ ì‚¬ìš©ë˜ëŠ” ì‹ë³„ì ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
            - ë”°ë¼ì„œ ê¸°ë³¸ í‚¤ ì¦‰, ì‹ë³„ì ê°’ì„ ë„£ì–´ì£¼ì§€ ì•Šê³  ì €ì¥í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
        - **@Id** ì˜µì…˜ë§Œ ì„¤ì •í•˜ë©´ ê¸°ë³¸ í‚¤ ê°’ì„ ê°œë°œìê°€ ì§ì ‘ í™•ì¸í•˜ê³  ë„£ì–´ì¤˜ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ë°œìƒí•©ë‹ˆë‹¤.

    - **@GeneratedValue** ì˜µì…˜ì„ ****ì¶”ê°€í•˜ë©´ ê¸°ë³¸ í‚¤ ìƒì„±ì„ DBì— ìœ„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        ```java
        @Entity // JPAê°€ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” Entity í´ë˜ìŠ¤ ì§€ì •
        @Table(name = "memo") // ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì§€ì •
        public class Memo {
            @Id
        		@GeneratedValue(strategy = GenerationType.IDENTITY)
            private Long id;

            // nullable: null í—ˆìš© ì—¬ë¶€
            // unique: ì¤‘ë³µ í—ˆìš© ì—¬ë¶€ (false ì¼ë•Œ ì¤‘ë³µ í—ˆìš©)
            @Column(name = "username", nullable = false, unique = true)
            private String username;

            // length: ì»¬ëŸ¼ ê¸¸ì´ ì§€ì •
            @Column(name = "contents", nullable = false, length = 500)
            private String contents;
        }
        ```

        - SQL í™•ì¸
            - create memo table

                ```sql
                create table memo (
                       id bigint not null auto_increment,
                        contents varchar(500) not null,
                        username varchar(255) not null,
                        primary key (id)
                );
                ```

        - ì—¬ëŸ¬ê°€ì§€ ì „ëµ ì¤‘ **IDENTITY** ì „ëµì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
        - **@GeneratedValue(strategy = GenerationType**.IDENTITY**)**
            - `id bigint not null auto_increment` : **auto_increment** ì¡°ê±´ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            - í•´ë‹¹ ì˜µì…˜ì„ ì¶”ê°€í•´ì£¼ë©´ ê°œë°œìê°€ ì§ì ‘ id ê°’ì„ ë„£ì–´ì£¼ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ ìˆœì„œì— ë§ê²Œ ê¸°ë³¸ í‚¤ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.
        ğŸ“Œ jpa-core í”„ë¡œì íŠ¸ì—ì„œëŠ” í•™ìŠµì„ ìœ„í•´ **@GeneratedValue** ì˜µì…˜ì„ ì¶”ê°€í•˜ì§€ ì•Šê² ìŠµë‹ˆë‹¤.

## ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€ ë¬´ì—‡ì¼ê¹Œ?
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€?

    - Persistenceë¥¼ í•œê¸€ë¡œ ë²ˆì—­í•˜ë©´ ì˜ì†ì„±, ì§€ì†ì„± ì´ë¼ëŠ” ëœ»ì´ ë©ë‹ˆë‹¤.
        > Persistenceë¥¼ ê°ì²´ì˜ ê´€ì ìœ¼ë¡œ í•´ì„í•´ ë³´ìë©´ â€˜**ê°ì²´ê°€ ìƒëª…(ê°ì²´ê°€ ìœ ì§€ë˜ëŠ” ì‹œê°„)ì´ë‚˜ ê³µê°„(ê°ì²´ì˜ ìœ„ì¹˜)ì„ ììœ ë¡­ê²Œ ìœ ì§€í•˜ê³  ì´ë™í• ìˆ˜ ìˆëŠ” ê°ì²´ì˜ ì„±ì§ˆ**â€™ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢€ ë” ì‰½ê²Œ í‘œí˜„í•´ ë³´ìë©´ **Entity ê°ì²´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‰½ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ê³µê°„**ì…ë‹ˆë‹¤.
    - ê°œë°œìë“¤ì€ ì´ì œ ì§ì ‘ SQLì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ JPAë¥¼ ì‚¬ìš©í•˜ì—¬ DBì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ì¡°íšŒí•  ìˆ˜ ìˆìœ¼ë©° ìˆ˜ì •, ì‚­ì œ ë˜í•œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    - ì´ëŸ¬í•œ ì¼ë ¨ì˜ ê³¼ì •ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ JPAëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— Entity ê°ì²´ë“¤ì„ ì €ì¥í•˜ì—¬ ê´€ë¦¬í•˜ë©´ì„œ DBì™€ ì†Œí†µí•©ë‹ˆë‹¤.

- EntityManager

    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ì—¬ Entity ê°ì²´ë“¤ì„ ì¡°ì‘í•˜ê¸° ìœ„í•´ì„œëŠ” EntityManagerê°€ í•„ìš”í•©ë‹ˆë‹¤.
        > EntityManagerëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ Entityë¥¼ ê´€ë¦¬í•˜ëŠ” ê´€ë¦¬ìì…ë‹ˆë‹¤.
    - ê°œë°œìë“¤ì€ EntityManagerë¥¼ ì‚¬ìš©í•´ì„œ Entityë¥¼ ì €ì¥í•˜ê³  ì¡°íšŒí•˜ê³  ìˆ˜ì •í•˜ê³  ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - EntityManagerëŠ” EntityManagerFactoryë¥¼ í†µí•´ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- EntityManagerFactory

    - EntityManagerFactoryëŠ” ì¼ë°˜ì ìœ¼ë¡œ DB í•˜ë‚˜ì— í•˜ë‚˜ë§Œ ìƒì„±ë˜ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•˜ëŠ” ë™ì•ˆ ì‚¬ìš©ë©ë‹ˆë‹¤.
    - EntityManagerFactoryë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” DBì— ëŒ€í•œ ì •ë³´ë¥¼ ì „ë‹¬í•´ì•¼í•©ë‹ˆë‹¤.
        - ì •ë³´ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œëŠ” **/resources/META-INF/**  ìœ„ì¹˜ì— **persistence.xml** íŒŒì¼ì„ ë§Œë“¤ì–´ ì •ë³´ë¥¼ ë„£ì–´ë‘ë©´ ë©ë‹ˆë‹¤.

            ```xml
            <?xml version="1.0" encoding="UTF-8"?>
            <persistence version="2.2"
                         xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
                <persistence-unit name="memo">
                    <class>com.sparta.entity.Memo</class>
                    <properties>
                        <property name="jakarta.persistence.jdbc.driver" value="com.mysql.cj.jdbc.Driver"/>
                        <property name="jakarta.persistence.jdbc.user" value="root"/>
                        <property name="jakarta.persistence.jdbc.password" value="{ë¹„ë°€ë²ˆí˜¸}"/>
                        <property name="jakarta.persistence.jdbc.url" value="jdbc:mysql://localhost:3306/memo"/>

                        <property name="hibernate.hbm2ddl.auto" value="create" />

                        <property name="hibernate.show_sql" value="true"/>
                        <property name="hibernate.format_sql" value="true"/>
                        <property name="hibernate.use_sql_comments" value="true"/>
                    </properties>
                </persistence-unit>
            </persistence>
            ```

    ```java
    EntityManagerFactory emf = Persistence.createEntityManagerFactory("memo");
    EntityManager em = emf.createEntityManager();
    ```

    - `EntityManagerFactory emf = Persistence.createEntityManagerFactory("memo");`
    - í•´ë‹¹ ì½”ë“œë¥¼ í˜¸ì¶œí•˜ë©´ JPAëŠ” **persistence.xml** ì˜ ì •ë³´ë¥¼ í† ëŒ€ë¡œ EntityManagerFactoryë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    - `EntityManager em = emf.createEntityManager();` ì½”ë“œë¥¼ í˜¸ì¶œí•˜ë©´ EntityManagerFactoryë¥¼ ì‚¬ìš©í•˜ì—¬ EntityManagerë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- JPAì˜ íŠ¸ëœì­ì…˜
    ### íŠ¸ëœì­ì…˜ì´ë€?
    - íŠ¸ëœì­ì…˜ì€ DB ë°ì´í„°ë“¤ì˜ ë¬´ê²°ì„±ê³¼ ì •í•©ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•œ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ê°œë…ì…ë‹ˆë‹¤.
        - ì‰½ê²Œ í‘œí˜„í•˜ìë©´ DBì˜ ë°ì´í„°ë“¤ì„ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ ìƒê²¨ë‚œ ê°œë…ì…ë‹ˆë‹¤.
    - ê°€ì¥ í° íŠ¹ì§•ì€ ì—¬ëŸ¬ ê°œì˜ SQLì´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì— í¬í•¨ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.
    - ì´ë•Œ, ëª¨ë“  SQLì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ì´ ë˜ë©´ DBì— ì˜êµ¬ì ìœ¼ë¡œ ë³€ê²½ì„ ë°˜ì˜í•˜ì§€ë§Œ SQL ì¤‘ ë‹¨ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•œë‹¤ë©´ ëª¨ë“  ë³€ê²½ì„ ë˜ëŒë¦½ë‹ˆë‹¤.
        - MySQLì—ì„œ ì§ì ‘ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•´ ë³´ê² ìŠµë‹ˆë‹¤.

        ```sql
        START TRANSACTION; # íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.

        INSERT INTO memo (id, username, contents) VALUES (1, 'Robbie', 'Robbie Memo');
        INSERT INTO memo (id, username, contents) VALUES (2, 'Robbert', 'Robbert Memo');
        SELECT * FROM memo;

        COMMIT; # íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•©ë‹ˆë‹¤.

        SELECT * FROM memo;
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] DB íŠ¸ëœì­ì…˜ í™•ì¸í•˜ê¸°

            ```sql
            START TRANSACTION; # íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.

            INSERT INTO memo (id, username, contents) VALUES (1, 'Robbie', 'Robbie Memo');
            INSERT INTO memo (id, username, contents) VALUES (2, 'Robbert', 'Robbert Memo');
            SELECT * FROM memo;

            COMMIT; # íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•©ë‹ˆë‹¤.

            SELECT * FROM memo;
            ```

    - JPAëŠ” DBì˜ ì´ëŸ¬í•œ íŠ¸ëœì­ì…˜ ê°œë…ì„ ì‚¬ìš©í•˜ì—¬ íš¨ìœ¨ì ìœ¼ë¡œ Entityë¥¼ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

    ### JPAì˜ íŠ¸ëœì­ì…˜
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— Entity ê°ì²´ë“¤ì„ ì €ì¥í–ˆë‹¤ê³  í•´ì„œ DBì— ë°”ë¡œ ë°˜ì˜ ë˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.
    - DBì—ì„œ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì— ì—¬ëŸ¬ ê°œì˜ SQLì„ í¬í•¨í•˜ê³  ìˆë‹¤ê°€ ë§ˆì§€ë§‰ì— ì˜êµ¬ì ìœ¼ë¡œ ë³€ê²½ì„ ë°˜ì˜í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ JPAì—ì„œë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¡œ ê´€ë¦¬í•˜ê³  ìˆëŠ” ë³€ê²½ì´ ë°œìƒí•œ ê°ì²´ë“¤ì˜ ì •ë³´ë¥¼ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì— ì „ë¶€ ê°€ì§€ê³  ìˆë‹¤ê°€ ë§ˆì§€ë§‰ì— SQLì„ í•œë²ˆì— DBì— ìš”ì²­í•´ ë³€ê²½ì„ ë°˜ì˜í•©ë‹ˆë‹¤.
    - ì €ì¥ ì„±ê³µ ì˜ˆì œ)
    ```java
    @Test
    @DisplayName("EntityTransaction ì„±ê³µ í…ŒìŠ¤íŠ¸")
    void test1() {
        EntityTransaction et = em.getTransaction(); // EntityManager ì—ì„œ EntityTransaction ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

        et.begin(); // íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.

        try { // DB ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

            Memo memo = new Memo(); // ì €ì¥í•  Entity ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
            memo.setId(1L); // ì‹ë³„ì ê°’ì„ ë„£ì–´ì¤ë‹ˆë‹¤.
            memo.setUsername("Robbie");
            memo.setContents("ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ íŠ¸ëœì­ì…˜ ì´í•´í•˜ê¸°");

            em.persist(memo); // EntityManager ì‚¬ìš©í•˜ì—¬ memo ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•©ë‹ˆë‹¤.

            et.commit(); // ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šê³  ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆë‹¤ë©´ commit ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
            // commit ì´ í˜¸ì¶œë˜ë©´ì„œ DB ì— ìˆ˜í–‰í•œ DB ì‘ì—…ë“¤ì´ ë°˜ì˜ë©ë‹ˆë‹¤.
        } catch (Exception ex) {
            ex.printStackTrace();
            et.rollback(); // DB ì‘ì—… ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ rollback ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
        } finally {
            em.close(); // ì‚¬ìš©í•œ EntityManager ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
        }

        emf.close(); // ì‚¬ìš©í•œ EntityManagerFactory ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
    }
    ```

    - [ì½”ë“œ ìŠ¤ë‹ˆí«] EntityTransaction ì„±ê³µ í…ŒìŠ¤íŠ¸

        ```java
        @Test
        @DisplayName("EntityTransaction ì„±ê³µ í…ŒìŠ¤íŠ¸")
        void test1() {
            EntityTransaction et = em.getTransaction(); // EntityManager ì—ì„œ EntityTransaction ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

            et.begin(); // íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.

            try { // DB ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

                Memo memo = new Memo(); // ì €ì¥í•  Entity ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                memo.setId(1L); // ì‹ë³„ì ê°’ì„ ë„£ì–´ì¤ë‹ˆë‹¤.
                memo.setUsername("Robbie");
                memo.setContents("ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ íŠ¸ëœì­ì…˜ ì´í•´í•˜ê¸°");

                em.persist(memo); // EntityManager ì‚¬ìš©í•˜ì—¬ memo ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•©ë‹ˆë‹¤.

                et.commit(); // ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šê³  ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆë‹¤ë©´ commit ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
                // commit ì´ í˜¸ì¶œë˜ë©´ì„œ DB ì— ìˆ˜í–‰í•œ DB ì‘ì—…ë“¤ì´ ë°˜ì˜ë©ë‹ˆë‹¤.
            } catch (Exception ex) {
                ex.printStackTrace();
                et.rollback(); // DB ì‘ì—… ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ rollback ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
            } finally {
                em.close(); // ì‚¬ìš©í•œ EntityManager ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
            }

            emf.close(); // ì‚¬ìš©í•œ EntityManagerFactory ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
        }
        ```

    - JPAì—ì„œ ì´ëŸ¬í•œ íŠ¸ëœì­ì…˜ì˜ ê°œë…ì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” EntityManagerì—ì„œ EntityTransactionì„ ê°€ì ¸ì™€ íŠ¸ëœì­ì…˜ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - `EntityTransaction et = em.getTransaction();`
        - í•´ë‹¹ ì½”ë“œë¥¼ í˜¸ì¶œí•˜ì—¬ EntityTransactionì„ ê°€ì ¸ì™€ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - `et.begin();`
        - íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤.
    - `et.commit();`
        - íŠ¸ëœì­ì…˜ì˜ ì‘ì—…ë“¤ì„ ì˜êµ¬ì ìœ¼ë¡œ DBì— ë°˜ì˜í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤.
    - `et.rollback();`
        - ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ íŠ¸ëœì­ì…˜ì˜ ì‘ì—…ì„ ëª¨ë‘ ì·¨ì†Œí•˜ê³ , ì´ì „ ìƒíƒœë¡œ ë˜ëŒë¦¬ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤.
    - ì €ì¥ ì‹¤íŒ¨ ì˜ˆì œ)

    ```java
    @Test
    @DisplayName("EntityTransaction ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸")
    void test2() {
        EntityTransaction et = em.getTransaction(); // EntityManager ì—ì„œ EntityTransaction ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

        et.begin(); // íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.

        try { // DB ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

            Memo memo = new Memo(); // ì €ì¥í•  Entity ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
            memo.setUsername("Robbert");
            memo.setContents("ì‹¤íŒ¨ ì¼€ì´ìŠ¤");

            em.persist(memo); // EntityManager ì‚¬ìš©í•˜ì—¬ memo ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•©ë‹ˆë‹¤.

            et.commit(); // ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šê³  ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆë‹¤ë©´ commit ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
            // commit ì´ í˜¸ì¶œë˜ë©´ì„œ DB ì— ìˆ˜í–‰í•œ DB ì‘ì—…ë“¤ì´ ë°˜ì˜ë©ë‹ˆë‹¤.
        } catch (Exception ex) {
            System.out.println("ì‹ë³„ì ê°’ì„ ë„£ì–´ì£¼ì§€ ì•Šì•„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            ex.printStackTrace();
            et.rollback(); // DB ì‘ì—… ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ rollback ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
        } finally {
            em.close(); // ì‚¬ìš©í•œ EntityManager ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
        }

        emf.close(); // ì‚¬ìš©í•œ EntityManagerFactory ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
    }
    ```

    - [ì½”ë“œ ìŠ¤ë‹ˆí«] EntityTransaction ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸

        ```java
        @Test
        @DisplayName("EntityTransaction ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸")
        void test2() {
            EntityTransaction et = em.getTransaction(); // EntityManager ì—ì„œ EntityTransaction ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

            et.begin(); // íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.

            try { // DB ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

                Memo memo = new Memo(); // ì €ì¥í•  Entity ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                memo.setUsername("Robbert");
                memo.setContents("ì‹¤íŒ¨ ì¼€ì´ìŠ¤");

                em.persist(memo); // EntityManager ì‚¬ìš©í•˜ì—¬ memo ê°ì²´ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•©ë‹ˆë‹¤.

                et.commit(); // ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šê³  ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆë‹¤ë©´ commit ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
                // commit ì´ í˜¸ì¶œë˜ë©´ì„œ DB ì— ìˆ˜í–‰í•œ DB ì‘ì—…ë“¤ì´ ë°˜ì˜ë©ë‹ˆë‹¤.
            } catch (Exception ex) {
                System.out.println("ì‹ë³„ì ê°’ì„ ë„£ì–´ì£¼ì§€ ì•Šì•„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                ex.printStackTrace();
                et.rollback(); // DB ì‘ì—… ì¤‘ ì˜¤ë¥˜ ë°œìƒ ì‹œ rollback ì„ í˜¸ì¶œí•©ë‹ˆë‹¤.
            } finally {
                em.close(); // ì‚¬ìš©í•œ EntityManager ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
            }

            emf.close(); // ì‚¬ìš©í•œ EntityManagerFactory ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
        }
        ```

    - ì‹ë³„ì ê°’ì„ ë„£ì–´ì£¼ì§€ ì•Šì•„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
    - ë”°ë¼ì„œ `et.rollback();` ì½”ë“œê°€ í˜¸ì¶œì´ë˜ì–´ íŠ¸ëœì­ì…˜ ì‘ì—… ë‚´ìš©ë“¤ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.
        - DBë¥¼ í™•ì¸í•´ë³´ë©´ í•´ë‹¹ ì‘ì—…ì´ ë°˜ì˜ë˜ì–´ìˆì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ Debuggingìœ¼ë¡œ í™•ì¸í•˜ê¸°
    1. í…ŒìŠ¤íŠ¸ ì‹œì‘ ìœ„ì¹˜ ê°€ì¥ ì™¼ìª½ì„ í´ë¦­í•˜ì—¬ ë¹¨ê°„ìƒ‰ ì›ì„ ë§Œë“­ë‹ˆë‹¤. ê·¸ë¦¬ê³  í•´ë‹¹ ì›ì— ìš°ì¸¡í´ë¦­ í›„ Thread ë¶€ë¶„ì„ í´ë¦­í•œ ë‹¤ìŒ Make Default í´ë¦­ í›„ Doneì„ ëˆ„ë¦…ë‹ˆë‹¤.
    2. ì´ˆë¡ìƒ‰ í™”ì‚´í‘œ ì‹œì‘ ë²„íŠ¼ì„ í´ë¦­ í›„ Debugë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
    3. ì²´í¬ ë¶€ë¶„ì„ í´ë¦­í•˜ì—¬ ìˆœì°¨ì ìœ¼ë¡œ ì½”ë“œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
    4. `em.persist(memo);` ì½”ë“œ í˜¸ì¶œ í›„ persistenceContext ìœ„ì¹˜ì— memo ê°ì²´ê°€ ì €ì¥ë˜ì–´ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 09. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ê¸°ëŠ¥
ğŸ“Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” **Entity ê°ì²´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‰½ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ê³µê°„**ì…ë‹ˆë‹¤.
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì–´ë–»ê²Œ Entity ê°ì²´ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ìˆëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
- 1ì°¨ ìºì‹œ
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ìºì‹œ ì €ì¥ì†Œë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
        - ìš°ë¦¬ê°€ ì €ì¥í•˜ëŠ” Entity ê°ì²´ë“¤ì´ 1ì°¨ ìºì‹œ ì¦‰, ìºì‹œ ì €ì¥ì†Œì— ì €ì¥ëœë‹¤ê³  ìƒê°í•˜ì‹œë©´ë©ë‹ˆë‹¤.
        - ìºì‹œ ì €ì¥ì†ŒëŠ” Map ìë£Œêµ¬ì¡° í˜•íƒœë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.
            - **key**ì—ëŠ” @Idë¡œ ë§¤í•‘í•œ ê¸°ë³¸ í‚¤ ì¦‰, ì‹ë³„ì ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤.
            - **value**ì—ëŠ” í•´ë‹¹ Entity í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
            - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ìºì‹œ ì €ì¥ì†Œ **Key**ì— ì €ì¥í•œ ì‹ë³„ìê°’ì„ ì‚¬ìš©í•˜ì—¬ Entity ê°ì²´ë¥¼ êµ¬ë¶„í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ì´ ìºì‹œ ì €ì¥ì†Œë¥¼ ì–´ë–»ê²Œ í™œìš©í•˜ê³  ìˆëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
    - Entity ì €ì¥
        - `em.persist(memo);` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©´ memo Entity ê°ì²´ë¥¼ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥í•©ë‹ˆë‹¤.

        - memo ì €ì¥

        ```sql
        @Test
        @DisplayName("1ì°¨ ìºì‹œ : Entity ì €ì¥")
        void test1() {
            EntityTransaction et = em.getTransaction();

            et.begin();

            try {

                Memo memo = new Memo();
                memo.setId(1L);
                memo.setUsername("Robbie");
                memo.setContents("1ì°¨ ìºì‹œ Entity ì €ì¥");

                em.persist(memo);

                et.commit();

            } catch (Exception ex) {
                ex.printStackTrace();
                et.rollback();
            } finally {
                em.close();
            }

            emf.close();
        }
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] memo ì €ì¥

            ```java
            @Test
            @DisplayName("1ì°¨ ìºì‹œ : Entity ì €ì¥")
            void test1() {
                EntityTransaction et = em.getTransaction();

                et.begin();

                try {

                    Memo memo = new Memo();
                    memo.setId(1L);
                    memo.setUsername("Robbie");
                    memo.setContents("1ì°¨ ìºì‹œ Entity ì €ì¥");

                    em.persist(memo);

                    et.commit();

                } catch (Exception ex) {
                    ex.printStackTrace();
                    et.rollback();
                } finally {
                    em.close();
                }

                emf.close();
            }
            ```
        - em > persistenceContext > entitiesBykeyë¥¼ í™•ì¸í•´ ë³´ì‹œë©´key-value í˜•íƒœë¡œ ì •ë³´ê°€ ì €ì¥ë˜ì–´ìˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    - Entity ì¡°íšŒ
        1. ìºì‹œ ì €ì¥ì†Œì— ì¡°íšŒí•˜ëŠ” Idê°€ ì¡´ì¬í•˜ì§€ ì•Šì€ ê²½ìš°
            1. ìºì‹œ ì €ì¥ì†Œ ì¡°íšŒ
            2. DB SELECT ì¡°íšŒ í›„ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥
            - `em.find(Memo.class, 1);` í˜¸ì¶œ ì‹œ ìºì‹œ ì €ì¥ì†Œë¥¼ í™•ì¸ í•œ í›„ í•´ë‹¹ ê°’ì´ ì—†ë‹¤ë©´?
            - DBì— SELECT ì¡°íšŒ í›„ í•´ë‹¹ ê°’ì„ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥í•˜ê³  ë°˜í™˜í•©ë‹ˆë‹¤.
            - memo ì¡°íšŒ ì˜ˆì œ1)

            ```sql
            @Test
            @DisplayName("Entity ì¡°íšŒ : ìºì‹œ ì €ì¥ì†Œì— í•´ë‹¹í•˜ëŠ” Idê°€ ì¡´ì¬í•˜ì§€ ì•Šì€ ê²½ìš°")
            void test2() {
                try {

                    Memo memo = em.find(Memo.class, 1);
                    System.out.println("memo.getId() = " + memo.getId());
                    System.out.println("memo.getUsername() = " + memo.getUsername());
                    System.out.println("memo.getContents() = " + memo.getContents());

                } catch (Exception ex) {
                    ex.printStackTrace();
                } finally {
                    em.close();
                }

                emf.close();
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] memo ì¡°íšŒ ì˜ˆì œ1)

                ```java
                @Test
                @DisplayName("Entity ì¡°íšŒ : ìºì‹œ ì €ì¥ì†Œì— í•´ë‹¹í•˜ëŠ” Idê°€ ì¡´ì¬í•˜ì§€ ì•Šì€ ê²½ìš°")
                void test2() {
                    try {

                        Memo memo = em.find(Memo.class, 1);
                        System.out.println("memo.getId() = " + memo.getId());
                        System.out.println("memo.getUsername() = " + memo.getUsername());
                        System.out.println("memo.getContents() = " + memo.getContents());

                    } catch (Exception ex) {
                        ex.printStackTrace();
                    } finally {
                        em.close();
                    }

                    emf.close();
                }
                ```

            - DBì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒë§Œ í•˜ëŠ” ê²½ìš°ì—ëŠ” ë°ì´í„°ì˜ ë³€ê²½ì´ ë°œìƒí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì´ ì—†ì–´ë„ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
            - `Memo memo = em.find(Memo.class, 1);` í˜¸ì¶œ ì‹œ ìºì‹œ ì €ì¥ì†Œì— í•´ë‹¹ ê°’ì´ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— DBì— SELECT ì¡°íšŒí•˜ì—¬ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥í•œ í›„ ë°˜í™˜í•©ë‹ˆë‹¤.

        2. ìºì‹œ ì €ì¥ì†Œì— ì¡°íšŒí•˜ëŠ” Idê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°
            - `em.find(Memo.class, 1);` í˜¸ì¶œ ì‹œ ìºì‹œ ì €ì¥ì†Œì— ì‹ë³„ì ê°’ì´ 1ì´ë©´ì„œ Memo Entity íƒ€ì…ì¸ ê°’ì´ ìˆëŠ”ì§€ ì¡°íšŒí•©ë‹ˆë‹¤.
                - ê°’ì´ ìˆë‹¤ë©´ í•´ë‹¹ Entity ê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

            - memo ì¡°íšŒ ì˜ˆì œ2)

            ```sql
            @Test
            @DisplayName("Entity ì¡°íšŒ : ìºì‹œ ì €ì¥ì†Œì— í•´ë‹¹í•˜ëŠ” Idê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°")
            void test3() {
                try {

                    Memo memo1 = em.find(Memo.class, 1);
                    System.out.println("memo1 ì¡°íšŒ í›„ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥\n");

                    Memo memo2 = em.find(Memo.class, 1);
                    System.out.println("memo2.getId() = " + memo2.getId());
                    System.out.println("memo2.getUsername() = " + memo2.getUsername());
                    System.out.println("memo2.getContents() = " + memo2.getContents());

                } catch (Exception ex) {
                    ex.printStackTrace();
                } finally {
                    em.close();
                }

                emf.close();
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] memo ì¡°íšŒ ì˜ˆì œ2)

                ```java
                @Test
                @DisplayName("Entity ì¡°íšŒ : ìºì‹œ ì €ì¥ì†Œì— í•´ë‹¹í•˜ëŠ” Idê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°")
                void test3() {
                    try {

                        Memo memo1 = em.find(Memo.class, 1);
                        System.out.println("memo1 ì¡°íšŒ í›„ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥\n");

                        Memo memo2 = em.find(Memo.class, 1);
                        System.out.println("memo2.getId() = " + memo2.getId());
                        System.out.println("memo2.getUsername() = " + memo2.getUsername());
                        System.out.println("memo2.getContents() = " + memo2.getContents());

                    } catch (Exception ex) {
                        ex.printStackTrace();
                    } finally {
                        em.close();
                    }

                    emf.close();
                }
                ```

            - `Memo memo1 = em.find(Memo.class, 1);` í˜¸ì¶œ ë•ŒëŠ” ìºì‹œ ì €ì¥ì†Œì— ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— DBì— SELECT ì¡°íšŒí•˜ì—¬ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥í•©ë‹ˆë‹¤.
            - `Memo memo2 = em.find(Memo.class, 1);` ë¥¼ í˜¸ì¶œ í–ˆì„ ë•ŒëŠ” ì´ë¯¸ ìºì‹œ ì €ì¥ì†Œì— í•´ë‹¹ ê°’ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— DBì— ì¡°íšŒí•˜ì§€ ì•Šê³  ìºì‹œ ì €ì¥ì†Œì—ì„œ í•´ë‹¹ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

        - **'1ì°¨ ìºì‹œ'** ì‚¬ìš©ì˜ ì¥ì 
            1. DB ì¡°íšŒ íšŸìˆ˜ë¥¼ ì¤„ì„
            2. **'1ì°¨ ìºì‹œ'**ë¥¼ ì‚¬ìš©í•´ DB row 1ê°œ ë‹¹ ê°ì²´ 1ê°œê°€ ì‚¬ìš©ë˜ëŠ” ê²ƒì„ ë³´ì¥ (ê°ì²´ ë™ì¼ì„± ë³´ì¥)
            - ê°ì²´ ë™ì¼ì„± ë³´ì¥

                ```sql
                @Test
                @DisplayName("ê°ì²´ ë™ì¼ì„± ë³´ì¥")
                void test4() {
                    EntityTransaction et = em.getTransaction();

                    et.begin();

                    try {
                        Memo memo3 = new Memo();
                        memo3.setId(2L);
                        memo3.setUsername("Robbert");
                        memo3.setContents("ê°ì²´ ë™ì¼ì„± ë³´ì¥");
                        em.persist(memo3);

                        Memo memo1 = em.find(Memo.class, 1);
                        Memo memo2 = em.find(Memo.class, 1);
                        Memo memo  = em.find(Memo.class, 2);

                        System.out.println(memo1 == memo2);
                        System.out.println(memo1 == memo);

                        et.commit();
                    } catch (Exception ex) {
                        ex.printStackTrace();
                        et.rollback();
                    } finally {
                        em.close();
                    }

                    emf.close();
                }
                ```

                - [ì½”ë“œ ìŠ¤ë‹ˆí«] ê°ì²´ ë™ì¼ì„± ë³´ì¥

                    ```java
                    @Test
                    @DisplayName("ê°ì²´ ë™ì¼ì„± ë³´ì¥")
                    void test4() {
                        EntityTransaction et = em.getTransaction();

                        et.begin();

                        try {
                            Memo memo3 = new Memo();
                            memo3.setId(2L);
                            memo3.setUsername("Robbert");
                            memo3.setContents("ê°ì²´ ë™ì¼ì„± ë³´ì¥");
                            em.persist(memo3);

                            Memo memo1 = em.find(Memo.class, 1);
                            Memo memo2 = em.find(Memo.class, 1);
                            Memo memo  = em.find(Memo.class, 2);

                            System.out.println(memo1 == memo2);
                            System.out.println(memo1 == memo);

                            et.commit();
                        } catch (Exception ex) {
                            ex.printStackTrace();
                            et.rollback();
                        } finally {
                            em.close();
                        }

                        emf.close();
                    }
                    ```

                - ê°™ì€ ê°’ì„ ì¡°íšŒí•˜ëŠ” memo1ê³¼ memo2ëŠ” == ê²°ê³¼ trueë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
                - memo1ê³¼ ë‹¤ë¥¸ ê°’ì„ ì¡°íšŒí•˜ëŠ” memoëŠ” == ê²°ê³¼ falseë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

    - Entity ì‚­ì œ
        1. ì‚­ì œí•  Entityë¥¼ ì¡°íšŒí•œ í›„ ìºì‹œ ì €ì¥ì†Œì— ì—†ë‹¤ë©´ DBì— ì¡°íšŒí•´ì„œ ì €ì¥í•©ë‹ˆë‹¤.
        2. `em.remove(entity);`
        - `em.remove(memo);` í˜¸ì¶œ ì‹œ ì‚­ì œí•  Entityë¥¼ DELETED ìƒíƒœë¡œ ë§Œë“  í›„ íŠ¸ëœì­ì…˜ commit í›„ Delete SQLì´ DBì— ìš”ì²­ë©ë‹ˆë‹¤.
        - memo ì‚­ì œ

        ```sql
        @Test
        @DisplayName("Entity ì‚­ì œ")
        void test5() {
            EntityTransaction et = em.getTransaction();

            et.begin();

            try {

                Memo memo = em.find(Memo.class, 2);

                em.remove(memo);

                et.commit();

            } catch (Exception ex) {
                ex.printStackTrace();
                et.rollback();
            } finally {
                em.close();
            }

            emf.close();
        }
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] memo ì‚­ì œ

            ```java
            @Test
            @DisplayName("Entity ì‚­ì œ")
            void test5() {
                EntityTransaction et = em.getTransaction();

                et.begin();

                try {

                    Memo memo = em.find(Memo.class, 2);

                    em.remove(memo);

                    et.commit();

                } catch (Exception ex) {
                    ex.printStackTrace();
                    et.rollback();
                } finally {
                    em.close();
                }

                emf.close();
            }
            ```
        - `em.remove(memo);` í˜¸ì¶œë˜ë©´ì„œ memo Entity ê°ì²´ë¥¼ DELETED ìƒíƒœë¡œ ë§Œë“¤ê³  íŠ¸ëœì­ì…˜ commit í›„ Delete SQLì´ DBì— ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.
        - `em.find(Memo.class, 2);` í˜¸ì¶œ í•˜ì—¬ memo ê°ì²´ë¥¼ ìºì‹œ ì €ì¥ì†Œì— ì €ì¥í•œ í›„
        - entityEntryë¥¼ í™•ì¸í•´ ë³´ì‹œë©´ memo Entity ê°ì²´ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬í•˜ëŠ” MANAGED ìƒíƒœì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - `em.remove(memo);` í˜¸ì¶œ í›„ memo Entity ê°ì²´ê°€ DELETED ìƒíƒœë¡œ ë°”ë€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - íŠ¸ëœì­ì…˜ commit í›„ DB ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ë©´ í•´ë‹¹ ë°ì´í„°ê°€ ì‚­ì œ ë˜ì–´ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ(ActionQueue)
    - JPAì˜ íŠ¸ëœì­ì…˜ì„ í•™ìŠµí•˜ë©´ì„œ JPAê°€ íŠ¸ëœì­ì…˜ ì²˜ëŸ¼ SQLì„ ëª¨ì•„ì„œ í•œë²ˆì— DBì— ë°˜ì˜í•œë‹¤ëŠ” ê²ƒì„ ë°°ì› ìŠµë‹ˆë‹¤.
        - JPAëŠ” ì´ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œë¥¼ ë§Œë“¤ì–´ SQLì„ ëª¨ì•„ë‘ê³  ìˆë‹¤ê°€ íŠ¸ëœì­ì…˜ commit í›„ í•œë²ˆì— DBì— ë°˜ì˜í•©ë‹ˆë‹¤.
    - Debuggingì„ í†µí•´ ì‹¤ì œë¡œ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì— SQLì„ ëª¨ì•„ì„œ í•œë²ˆì— ë°˜ì˜í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.
    - ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ (ActionQueue)
    ```sql
    @Test
    @DisplayName("ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ í™•ì¸")
    void test6() {
        EntityTransaction et = em.getTransaction();

        et.begin();

        try {
            Memo memo = new Memo();
            memo.setId(2L);
            memo.setUsername("Robbert");
            memo.setContents("ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ");
            em.persist(memo);

            Memo memo2 = new Memo();
            memo2.setId(3L);
            memo2.setUsername("Bob");
            memo2.setContents("ê³¼ì—° ì €ì¥ì„ ì˜ í•˜ê³  ìˆì„ê¹Œ?");
            em.persist(memo2);

            System.out.println("íŠ¸ëœì­ì…˜ commit ì „");
            et.commit();
            System.out.println("íŠ¸ëœì­ì…˜ commit í›„");

        } catch (Exception ex) {
            ex.printStackTrace();
            et.rollback();
        } finally {
            em.close();
        }

        emf.close();
    }
    ```

    - [ì½”ë“œ ìŠ¤ë‹ˆí«] ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ (ActionQueue)

        ```java
        @Test
        @DisplayName("ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ í™•ì¸")
        void test6() {
            EntityTransaction et = em.getTransaction();

            et.begin();

            try {
                Memo memo = new Memo();
                memo.setId(2L);
                memo.setUsername("Robbert");
                memo.setContents("ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ");
                em.persist(memo);

                Memo memo2 = new Memo();
                memo2.setId(3L);
                memo2.setUsername("Bob");
                memo2.setContents("ê³¼ì—° ì €ì¥ì„ ì˜ í•˜ê³  ìˆì„ê¹Œ?");
                em.persist(memo2);

                System.out.println("íŠ¸ëœì­ì…˜ commit ì „");
                et.commit();
                System.out.println("íŠ¸ëœì­ì…˜ commit í›„");

            } catch (Exception ex) {
                ex.printStackTrace();
                et.rollback();
            } finally {
                em.close();
            }

            emf.close();
        }
        ```

    - ì“°ê¸° ì§€ì—° ì €ì¥ì†Œ í™•ì¸
        - em > actionQueueë¥¼ í™•ì¸í•´ë³´ë©´ insertions > executablesì— Insertí•  memo#2, memo#3 Entity ê°ì²´ 2ê°œê°€ ë“¤ì–´ê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - íŠ¸ëœì­ì…˜ commit í›„
        - actionQueueì— ìˆë˜ insertions ë°ì´í„°ê°€ ì‚¬ë¼ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ì‹¤ì œë¡œ ê¸°ë¡ì„ í™•ì¸í•´ë³´ë©´ íŠ¸ëœì­ì…˜ commit í˜¸ì¶œ ì „ê¹Œì§€ëŠ” SQL ìš”ì²­ì´ ì—†ë‹¤ê°€ íŠ¸ëœì­ì…˜ commit í›„ í•œë²ˆì— Insert SQL 2ê°œê°€ ìˆœì„œëŒ€ë¡œ ìš”ì²­ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - flush()
        - íŠ¸ëœì­ì…˜ commit í›„ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì˜ SQLë“¤ì´ í•œë²ˆì— ìš”ì²­ë¨ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
        - ì‚¬ì‹¤ íŠ¸ëœì­ì…˜ commit í›„ ì¶”ê°€ì ì¸ ë™ì‘ì´ ìˆëŠ”ë° ë°”ë¡œ `em.flush();` ë©”ì„œë“œì˜ í˜¸ì¶œì…ë‹ˆë‹¤.
        - flush ë©”ì„œë“œëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë³€ê²½ ë‚´ìš©ë“¤ì„ DBì— ë°˜ì˜í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
            - ì¦‰, ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì˜ SQLë“¤ì„ DBì— ìš”ì²­í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
        - flush() ë™ì‘ í™•ì¸ì„ ìœ„í•´ ì§ì ‘ í˜¸ì¶œí•´ë³´ê² ìŠµë‹ˆë‹¤.
        ```sql
        @Test
        @DisplayName("flush() ë©”ì„œë“œ í™•ì¸")
        void test7() {
            EntityTransaction et = em.getTransaction();

            et.begin();

            try {
                Memo memo = new Memo();
                memo.setId(4L);
                memo.setUsername("Flush");
                memo.setContents("Flush() ë©”ì„œë“œ í˜¸ì¶œ");
                em.persist(memo);

                System.out.println("flush() ì „");
                em.flush(); // flush() ì§ì ‘ í˜¸ì¶œ
                System.out.println("flush() í›„\n");


                System.out.println("íŠ¸ëœì­ì…˜ commit ì „");
                et.commit();
                System.out.println("íŠ¸ëœì­ì…˜ commit í›„");

            } catch (Exception ex) {
                ex.printStackTrace();
                et.rollback();
            } finally {
                em.close();
            }

            emf.close();
        }
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] flush()

            ```java
            @Test
            @DisplayName("flush() ë©”ì„œë“œ í™•ì¸")
            void test7() {
                EntityTransaction et = em.getTransaction();

                et.begin();

                try {
                    Memo memo = new Memo();
                    memo.setId(4L);
                    memo.setUsername("Flush");
                    memo.setContents("Flush() ë©”ì„œë“œ í˜¸ì¶œ");
                    em.persist(memo);

                    System.out.println("flush() ì „");
                    em.flush(); // flush() ì§ì ‘ í˜¸ì¶œ
                    System.out.println("flush() í›„\n");


                    System.out.println("íŠ¸ëœì­ì…˜ commit ì „");
                    et.commit();
                    System.out.println("íŠ¸ëœì­ì…˜ commit í›„");

                } catch (Exception ex) {
                    ex.printStackTrace();
                    et.rollback();
                } finally {
                    em.close();
                }

                emf.close();
            }
            ```

        - `em.flush();` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì ë°”ë¡œ DBì— ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì˜ SQLì´ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤.
        - ì´ë¯¸ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì˜ SQLì´ ìš”ì²­ ë˜ì—ˆê¸° ë•Œë¬¸ì— ë” ì´ìƒ ìš”ì²­í•  SQLì´ ì—†ì–´ íŠ¸ëœì­ì…˜ì´ commit ëœ í›„ì— SQL ê¸°ë¡ì´ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.
        - ì¶”ê°€) íŠ¸ëœì­ì…˜ì„ ì„¤ì •í•˜ì§€ ì•Šê³  í”ŒëŸ¬ì‹œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ `no transaction is in progress` ë©”ì‹œì§€ì™€ í•¨ê»˜ `TransactionRequiredException` ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
            - Insert, Update, Delete ì¦‰, ë°ì´í„° ë³€ê²½ SQLì„ DBì— ìš”ì²­ ë° ë°˜ì˜í•˜ê¸° ìœ„í•´ì„œëŠ” íŠ¸ëœì­ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.

- ë³€ê²½ ê°ì§€(Dirty Checking)
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥ëœ Entityê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ Update SQLì´ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì— ì €ì¥ëœë‹¤ë©´?
        - í•˜ë‚˜ì˜ Update SQLë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ìƒí™©ì„ ì—¬ëŸ¬ë²ˆ Update SQLì„ ìš”ì²­í•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì— ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.
    - ê·¸ë ‡ë‹¤ë©´ JPAëŠ” ì–´ë–»ê²Œ Updateë¥¼ ì²˜ë¦¬í• ê¹Œìš”?
        - `em.update(entity);` ê°™ì€ ë©”ì„œë“œë¥¼ ì§€ì›í•  ê²ƒ ê°™ì§€ë§Œ ì°¾ì•„ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    - JPAì—ì„œëŠ” Updateë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
    - JPAëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— Entityë¥¼ ì €ì¥í•  ë•Œ ìµœì´ˆ ìƒíƒœ(LoadedState)ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
        - íŠ¸ëœì­ì…˜ì´ commitë˜ê³  `em.flush();` ê°€ í˜¸ì¶œë˜ë©´ Entityì˜ í˜„ì¬ ìƒíƒœì™€ ì €ì¥í•œ ìµœì´ˆ ìƒíƒœë¥¼ ë¹„êµí•©ë‹ˆë‹¤.
        - ë³€ê²½ ë‚´ìš©ì´ ìˆë‹¤ë©´ Update SQLì„ ìƒì„±í•˜ì—¬ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì— ì €ì¥í•˜ê³  ëª¨ë“  ì“°ê¸°ì§€ì—° ì €ì¥ì†Œì˜ SQLì„ DBì— ìš”ì²­í•©ë‹ˆë‹¤.
        - ë§ˆì§€ë§‰ìœ¼ë¡œ DBì˜ íŠ¸ëœì­ì…˜ì´ commit ë˜ë©´ì„œ ë°˜ì˜ë©ë‹ˆë‹¤.
    - ë”°ë¼ì„œ ë³€ê²½í•˜ê³  ì‹¶ì€ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ë¨¼ì € ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  í•´ë‹¹ Entity ê°ì²´ì˜ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë©´ ìë™ìœ¼ë¡œ Update SQLì´ ìƒì„±ë˜ê³  DBì— ë°˜ì˜ë©ë‹ˆë‹¤.
        - ì´ëŸ¬í•œ ê³¼ì •ì„ ë³€ê²½ ê°ì§€, Dirty Checkingì´ë¼ ë¶€ë¦…ë‹ˆë‹¤.
    - ë³€ê²½í•  memo ë°ì´í„°ë¥¼ ì¡°íšŒí•œ í›„ ë³€ê²½ í•´ë³´ê² ìŠµë‹ˆë‹¤.

    ```sql
    @Test
    @DisplayName("ë³€ê²½ ê°ì§€ í™•ì¸")
    void test8() {
        EntityTransaction et = em.getTransaction();

        et.begin();

        try {
            System.out.println("ë³€ê²½í•  ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.");
            Memo memo = em.find(Memo.class, 4);
            System.out.println("memo.getId() = " + memo.getId());
            System.out.println("memo.getUsername() = " + memo.getUsername());
            System.out.println("memo.getContents() = " + memo.getContents());

            System.out.println("\nìˆ˜ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.");
            memo.setUsername("Update");
            memo.setContents("ë³€ê²½ ê°ì§€ í™•ì¸");

            System.out.println("íŠ¸ëœì­ì…˜ commit ì „");
            et.commit();
            System.out.println("íŠ¸ëœì­ì…˜ commit í›„");

        } catch (Exception ex) {
            ex.printStackTrace();
            et.rollback();
        } finally {
            em.close();
        }

        emf.close();
    }
    ```

    - [ì½”ë“œ ìŠ¤ë‹ˆí«] ë³€ê²½ ê°ì§€ í™•ì¸

        ```java
        @Test
        @DisplayName("ë³€ê²½ ê°ì§€ í™•ì¸")
        void test8() {
            EntityTransaction et = em.getTransaction();

            et.begin();

            try {
                System.out.println("ë³€ê²½í•  ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.");
                Memo memo = em.find(Memo.class, 4);
                System.out.println("memo.getId() = " + memo.getId());
                System.out.println("memo.getUsername() = " + memo.getUsername());
                System.out.println("memo.getContents() = " + memo.getContents());

                System.out.println("\nìˆ˜ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.");
                memo.setUsername("Update");
                memo.setContents("ë³€ê²½ ê°ì§€ í™•ì¸");

                System.out.println("íŠ¸ëœì­ì…˜ commit ì „");
                et.commit();
                System.out.println("íŠ¸ëœì­ì…˜ commit í›„");

            } catch (Exception ex) {
                ex.printStackTrace();
                et.rollback();
            } finally {
                em.close();
            }

            emf.close();
        }
        ```

    - entityInstanceëŠ” Entity ê°ì²´ì˜ í˜„ì¬ ìƒíƒœì…ë‹ˆë‹¤.
    - entityEntry > loadedStateëŠ” ì¡°íšŒí–ˆì„ ë•Œ ì¦‰, í•´ë‹¹ Entityì˜ ìµœì´ˆ ìƒíƒœì…ë‹ˆë‹¤.
    - íŠ¸ëœì­ì…˜ commit í›„ `em.flush();` ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©´ í˜„ì¬ ìƒíƒœì™€ ìµœì´ˆ ìƒíƒœë¥¼ ë¹„êµí•˜ê³  ë³€ê²½ì´ ìˆë‹¤ë©´ Update SQLì„ ìƒì„±í•˜ì—¬ ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì— ì €ì¥í•œ í›„ DBì— ìš”ì²­í•©ë‹ˆë‹¤.
    - ìˆ˜ì •ì„ ì§„í–‰í•˜ê³  íŠ¸ëœì­ì…˜ commit í›„ Update SQLì´ ìš”ì²­ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

