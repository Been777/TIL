# ë‚´ì¼ë°°ì›€ìº í”„ 240613 TIL
Java 43ì¼ì°¨
JPA
-------------------------------------------------------------------------------

# JPA í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ê¸°

## 06. Entity ì—°ê´€ ê´€ê³„

- í”„ë¡œì íŠ¸ ìƒì„±
    - í”„ë¡œì íŠ¸ ì¤€ë¹„í•˜ê¸°
        1. IntelliJë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        2. New Projectë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        3. ì™¼ìª½ ë©”ë‰´ì—ì„œ "Spring Initializrâ€ë¥¼ í´ë¦­í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
        4.  ğŸš’**[ì¤‘ìš”] ê¼­ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.**
            - Name: jpa-advance
            - **Language: Java**
            - **Build system: Gradle - Groovy**
            - Group: com.sparta
            - **JDK: 17**
            - í”„ë¡œì íŠ¸ ê²½ë¡œ(Location)ëŠ” ììœ ë¡­ê²Œ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
        5. Nextë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        6. Dependenciesë¥¼ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ ì¶”ê°€í•´ì£¼ê³  Createë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
    - í”„ë¡œì íŠ¸ ì„¤ì •ì¶”ê°€
        - src > main > resources > application.properties
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] application.properties

                ```xml
                spring.datasource.url=jdbc:mysql://localhost:3306/orderapp
                spring.datasource.username=root
                spring.datasource.password={ë¹„ë°€ë²ˆí˜¸}
                spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

                spring.jpa.hibernate.ddl-auto=update

                spring.jpa.properties.hibernate.show_sql=true
                spring.jpa.properties.hibernate.format_sql=true
                spring.jpa.properties.hibernate.use_sql_comments=true
                ```

        - Intellij Database ì—°ë™
            - CREATE DATABASE

                ```sql
                CREATE DATABASE orderapp;
                ```

            - ì—°ë™ ìˆœì„œ
                1. Database íƒ­ì„ í´ë¦­í•˜ì‹œê³  + ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.
                2. Data Source > MySQL ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
                3. User, Password, Database ì •ë³´ë¥¼ ì¶”ê°€í•œ í›„ Okë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
                4. MySQL Databaseì— ì—°ê²°ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

- ì£¼ë¬¸ APP DB table ì„¤ê³„
    - ê³ ê° (users) í…Œì´ë¸”

        | id | name |
        | --- | --- |
        | 1 | Robbie |
        | 2 | Robbert |
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] create users table

            ```sql
            create table users
            (
                id   bigint not null auto_increment,
                name varchar(255),
                primary key (id)
            );
            ```

    - ìŒì‹ (food) í…Œì´ë¸”

        | id | name | price |
        | --- | --- | --- |
        | 1 | í›„ë¼ì´ë“œ ì¹˜í‚¨ | 15000 |
        | 2 | ì–‘ë… ì¹˜í‚¨ | 20000 |
        | 3 | ê³ êµ¬ë§ˆ í”¼ì | 30000 |
        | 4 | ì•„ë³´ì¹´ë„ í”¼ì | 50000 |
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] create food table

            ```sql
            create table food
            (
                id    bigint not null auto_increment,
                name  varchar(255),
                price float(53) not null,
                primary key (id)
            );
            ```

- DB tableê°„ì˜ ì—°ê´€ ê´€ê³„
    - ì—°ê´€ ê´€ê³„ ê³ ë¯¼
        - ê³ ê°ì´ ìŒì‹ì„ ì£¼ë¬¸ ì‹œ, ì£¼ë¬¸ ì •ë³´ëŠ” ì–´ëŠ í…Œì´ë¸”ì— ë“¤ì–´ê°€ì•¼ í• ê¹Œìš”?
            - ê³ ê° í…Œì´ë¸”? ìŒì‹ í…Œì´ë¸”?
        1. ê³ ê° í…Œì´ë¸”
            - í•œëª…ì˜ ê³ ê°ì€ ìŒì‹ì„ ì—¬ëŸ¬ê°œë¥¼ ì£¼ë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                - ê³ ê°ê³¼ ìŒì‹ì€ 1 ëŒ€ N ê´€ê³„ì…ë‹ˆë‹¤.
            - ì£¼ë¬¸í•œ ìŒì‹ì˜ ì •ë³´ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ food_id ì»¬ëŸ¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] food_id ì»¬ëŸ¼ ì¶”ê°€

                    ```sql
                    ALTER TABLE users ADD food_id bigint;
                    ```

            - ê³ ê° í…Œì´ë¸”ì— ì£¼ë¬¸ ì •ë³´ë¥¼ ë„£ìŠµë‹ˆë‹¤.
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] insert users table

                    ```sql
                    INSERT INTO users (name, food_id) VALUES ('Robbie', 1);
                    INSERT INTO users (name, food_id) VALUES ('Robbert', 1);
                    INSERT INTO users (name, food_id) VALUES ('Robbie', 2);
                    ```

            | id | name | food_id |
            | --- | --- | --- |
            | 1 | Robbie | 1 |
            | 2 | Robbert | 1 |
            | 3 | Robbie | 2 |
            - RobbieëŠ” í›„ë¼ì´ë“œ ì¹˜í‚¨, ì–‘ë… ì¹˜í‚¨ì„ ì£¼ë¬¸í–ˆìŠµë‹ˆë‹¤.
                - ë¶ˆí•„ìš”í•˜ê²Œ ê³ ê°ì˜ ì´ë¦„ì´ ì¤‘ë³µë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.

        2. ìŒì‹ í…Œì´ë¸”
            - í•˜ë‚˜ì˜ ìŒì‹ì€ ì—¬ëŸ¬ëª…ì˜ ê³ ê°ì—ê²Œ ì£¼ë¬¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                - ìŒì‹ê³¼ ê³ ê°ì€ 1 ëŒ€ N ê´€ê³„ì…ë‹ˆë‹¤.
            - ì£¼ë¬¸í•œ ê³ ê°ì˜ ì •ë³´ë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ user_id ì»¬ëŸ¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] user_id ì»¬ëŸ¼ ì¶”ê°€

                    ```sql
                    ALTER TABLE food ADD user_id bigint;
                    ```

            - ìŒì‹ í…Œì´ë¸”ì— ì£¼ë¬¸ ì •ë³´ë¥¼ ë„£ìŠµë‹ˆë‹¤.
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] insert food table

                    ```sql
                    INSERT INTO food (name, price, user_id) VALUES ('í›„ë¼ì´ë“œ ì¹˜í‚¨', 15000, 1);
                    INSERT INTO food (name, price, user_id) VALUES ('í›„ë¼ì´ë“œ ì¹˜í‚¨', 15000, 2);
                    INSERT INTO food (name, price, user_id) VALUES ('ì–‘ë… ì¹˜í‚¨', 20000, 1);
                    ```

            | id | name | price | user_id |
            | --- | --- | --- | --- |
            | 1 | í›„ë¼ì´ë“œ ì¹˜í‚¨ | 15000 | 1 |
            | 2 | í›„ë¼ì´ë“œ ì¹˜í‚¨ | 15000 | 2 |
            | 3 | ì–‘ë… ì¹˜í‚¨ | 20000 | 1 |
            - í›„ë¼ì´ë“œ ì¹˜í‚¨ì„ ì—¬ëŸ¬ì‚¬ëŒì´ ì£¼ë¬¸í•˜ê²Œë˜ì—ˆì„ ë•Œ!
            - ë¶ˆí•„ìš”í•˜ê²Œ ìŒì‹ì˜ ì´ë¦„ì´ ì¤‘ë³µë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.

            | ID | name | price | user_id |
            | --- | --- | --- | --- |
            | 1 | í›„ë¼ì´ë“œì¹˜í‚¨ | 15000 | 1,2 |
            - ê·¸ë ‡ë‹¤ë©´ ìœ„ í‘œì²˜ëŸ¼ â€˜ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë  ë•Œ user_id ì»¬ëŸ¼ì— 1,2 ë¡œ ì €ì¥í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?â€™ë¼ê³  ìƒê°í•  ìˆ˜ë„ ìˆì§€ë§Œ!
            - user_id ê°’ì„ ê³„ì†í•´ì„œ ì¶”ê°€í•  ë•Œ ë¿ë§Œ ì•„ë‹ˆë¼ ê³ ê°ì˜ ì •ë³´ë„ í•¨ê»˜ ì¡°íšŒê°€ í•„ìš”í•  ë•Œ ë§ì€ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í˜„ì‹¤ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

        3. ì£¼ë¬¸ í…Œì´ë¸”
            - ì£¼ë¬¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ê¸°ë¡í•  orders í…Œì´ë¸”ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] create orders table

                    ```sql
                    create table orders
                    (
                        id         bigint not null auto_increment,
                        user_id    bigint,
                        food_id    bigint,
                        order_date date,
                        primary key (id)
                    );
                    ```

            - ì£¼ë¬¸ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì—¬ í…Œì´ë¸”ë“¤ì˜ ì—°ê´€ ê´€ê³„ë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
                - [ì½”ë“œ ìŠ¤ë‹ˆí«] ì£¼ë¬¸ í…Œì´ë¸” ì ìš©

                    ```sql
                    drop table if exists food;
                    drop table if exists users;
                    create table users
                    (
                        id   bigint not null auto_increment,
                        name varchar(255),
                        primary key (id)
                    );

                    create table food
                    (
                        id    bigint    not null auto_increment,
                        name  varchar(255),
                        price float(53) not null,
                        primary key (id)
                    );

                    alter table orders
                        add constraint orders_user_fk
                            foreign key (user_id)
                                references users (id);

                    alter table orders
                        add constraint orders_food_fk
                            foreign key (food_id)
                                references food (id);

                    INSERT INTO users (name) VALUES ('Robbie');
                    INSERT INTO users (name) VALUES ('Robbert');

                    INSERT INTO food (name, price) VALUES ('í›„ë¼ì´ë“œ ì¹˜í‚¨', 15000);
                    INSERT INTO food (name, price) VALUES ('ì–‘ë… ì¹˜í‚¨', 20000);
                    INSERT INTO food (name, price) VALUES ('ê³ êµ¬ë§ˆ í”¼ì', 30000);
                    INSERT INTO food (name, price) VALUES ('ì•„ë³´ì¹´ë„ í”¼ì', 50000);

                    INSERT INTO orders (user_id, food_id, order_date) VALUES (1, 1, SYSDATE());
                    INSERT INTO orders (user_id, food_id, order_date) VALUES (2, 1, SYSDATE());
                    INSERT INTO orders (user_id, food_id, order_date) VALUES (2, 2, SYSDATE());
                    INSERT INTO orders (user_id, food_id, order_date) VALUES (1, 4, SYSDATE());
                    INSERT INTO orders (user_id, food_id, order_date) VALUES (2, 3, SYSDATE());
                    ```

            - ê³ ê°
                | id | name |
                | --- | --- |
                | 1 | Robbie |
                | 2 | Robbert |
            - ìŒì‹

                | id | name | price |
                | --- | --- | --- |
                | 1 | í›„ë¼ì´ë“œ ì¹˜í‚¨ | 15000 |
                | 2 | ì–‘ë… ì¹˜í‚¨ | 20000 |
                | 3 | ê³ êµ¬ë§ˆ í”¼ì | 30000 |
                | 4 | ì•„ë³´ì¹´ë„ í”¼ì | 50000 |
            - ì£¼ë¬¸

                | id | user_id | food_id | ì£¼ë¬¸ì¼ |
                | --- | --- | --- | --- |
                | 1 | 1 | 1 | 2023-01-01 |
                | 2 | 2 | 1 | 2023-01-01 |
                | 3 | 2 | 2 | 2023-01-01 |
                | 4 | 1 | 4 | 2023-01-01 |
                | 5 | 2 | 3 | 2023-01-01 |
            - ê³ ê° 1ëª…ì€ ìŒì‹ Nê°œë¥¼ ì£¼ë¬¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                - ê³ ê° : ìŒì‹ = 1 : N ê´€ê³„
            - ìŒì‹ 1ê°œëŠ” ê³ ê° Nëª…ì—ê²Œ ì£¼ë¬¸ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                - ìŒì‹ : ê³ ê° = 1 : N ê´€ê³„
            - ê²°ë¡ ì ìœ¼ë¡œ ê³ ê°ê³¼ ìŒì‹ì€ N : M ê´€ê³„ì…ë‹ˆë‹¤.
                - ê³ ê° : ìŒì‹ = N : M ê´€ê³„
            - ì´ë ‡ë“¯ N : M ê´€ê³„ì¸ í…Œì´ë¸”ë“¤ì˜ ì—°ê´€ ê´€ê³„ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ orders í…Œì´ë¸”ì²˜ëŸ¼ ì¤‘ê°„ í…Œì´ë¸”ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                - ê³ ê° 1ëª…ì€ ì£¼ë¬¸ì„ ì—¬ëŸ¬ë²ˆ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    - ê³ ê° : ì£¼ë¬¸ = 1 : N
                - ìŒì‹ 1ê°œëŠ” ì£¼ë¬¸ì´ ì—¬ëŸ¬ë²ˆ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    - ìŒì‹ : ì£¼ë¬¸ = 1 : N

- DB tableê°„ì˜ ë°©í–¥
    - DB í…Œì´ë¸”ë“¤ê°„ì˜ ê´€ê³„ì—ì„œ ë°©í–¥ì˜ ê°œë…ì´ ì¡´ì¬í• ê¹Œìš”?
        - ë°©í–¥ì—ëŠ” í¬ê²Œ ë‹¨ë°©í–¥ê³¼ ì–‘ë°©í–¥ì„ ìƒê°í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            - ì˜ˆë¥¼ ë“¤ì–´ ë‹¨ë°©í–¥ì€ users í…Œì´ë¸”ì—ì„œë§Œ food í…Œì´ë¸”ì„ ì°¸ì¡°í•  ìˆ˜ ìˆì„ ë•Œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
            - ì–‘ë°©í–¥ì€ users í…Œì´ë¸”ê³¼ food í…Œì´ë¸”ì´ ì„œë¡œë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆì„ ë•Œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
            - ê·¸ë ‡ë‹¤ë©´ DB í…Œì´ë¸”ê°„ì˜ ë°©í–¥ì´ ìˆëŠ” ê²Œ ë§ì„ê¹Œìš”?

    - ê³ ê° â€˜Robbieâ€™ê°€ ì£¼ë¬¸í•œ ìŒì‹ ì •ë³´ë¥¼ users í…Œì´ë¸” ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒí•´ë³´ê² ìŠµë‹ˆë‹¤.

        ```sql
        SELECT u.name as username, f.name as foodname, o.order_date as orderdate
        FROM users u
                 INNER JOIN orders o on u.id = o.user_id
                 INNER JOIN food f on o.food_id = f.id
        WHERE o.user_id = 1;
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] â€˜Robbieâ€™ê°€ ì£¼ë¬¸í•œ ìŒì‹ ì •ë³´ë¥¼ users í…Œì´ë¸” ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒ

            ```sql
            SELECT u.name as username, f.name as foodname, o.order_date as orderdate
            FROM users u
                     INNER JOIN orders o on u.id = o.user_id
                     INNER JOIN food f on o.food_id = f.id
            WHERE o.user_id = 1;
            ```

    - ê·¸ë ‡ë‹¤ë©´ food í…Œì´ë¸” ê¸°ì¤€ìœ¼ë¡œëŠ” â€˜Robbieâ€™ê°€ ì£¼ë¬¸í•œ ìŒì‹ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ëŠ” ê±¸ê¹Œìš”?

        ```sql
        SELECT u.name as username, f.name as foodname, o.order_date as orderdate
        FROM food f
                 INNER JOIN orders o on f.id = o.food_id
                 INNER JOIN users u on o.user_id = u.id
        WHERE o.user_id = 1;
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] â€˜Robbieâ€™ê°€ ì£¼ë¬¸í•œ ìŒì‹ ì •ë³´ë¥¼ food í…Œì´ë¸” ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒ

            ```sql
            SELECT u.name as username, f.name as foodname, o.order_date as orderdate
            FROM food f
                     INNER JOIN orders o on f.id = o.food_id
                     INNER JOIN users u on o.user_id = u.id
            WHERE o.user_id = 1;
            ```

    - DBì—ì„œëŠ” ì–´ë–¤ í…Œì´ë¸”ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ë“  ì›í•˜ëŠ” ì •ë³´ë¥¼ JOINì„ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ì´ì²˜ëŸ¼ DB í…Œì´ë¸”ê°„ì˜ ê´€ê³„ì—ì„œëŠ” ë°©í–¥ì˜ ê°œë…ì´ ì—†ìŠµë‹ˆë‹¤.

- Entityê°„ì˜ ì—°ê´€ ê´€ê³„
    - ê·¸ë ‡ë‹¤ë©´ JPA Entityì—ì„œëŠ” ì´ëŸ¬í•œ í…Œì´ë¸”ê°„ì˜ ì—°ê´€ ê´€ê³„ë¥¼ ì–´ë–»ê²Œ í‘œí˜„í•˜ê³  ìˆì„ê¹Œìš”?
    - ìŒì‹ : ê³ ê° = N : 1 ê´€ê³„ë¥¼ í‘œí˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.
        - ìŒì‹

            ```java
            @Entity
            @Table(name = "food")
            public class Food {
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;
                private String name;
                private double price;

                @ManyToOne
                @JoinColumn(name = "user_id")
                private User user;
            }
            ```

        - ê³ ê°

            ```java
            @Entity
            @Table(name = "users")
            public class User {
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;
                private String name;

                @OneToMany(mappedBy = "user")
                private List<Food> foodList = new ArrayList<>();
            }
            ```

        - í•œëª…ì˜ ê³ ê°ì€ ì—¬ëŸ¬ë²ˆ ì£¼ë¬¸ì´ ê°€ëŠ¥í•œ ìƒí™©ì…ë‹ˆë‹¤.
            - ì´ë¥¼ Entityì—ì„œ ì—¬ëŸ¬ë²ˆ ê°€ëŠ¥í•¨ì„ í‘œí˜„í•˜ê¸° ìœ„í•´ Java ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ì—¬ `List<Food> foodList = new ArrayList<>()` ì´ì²˜ëŸ¼ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ê·¸ë ‡ë‹¤ë©´ Entityì—ì„œ ì´ë ‡ê²Œê¹Œì§€ í•´ì„œ í‘œí˜„ì„ í•˜ëŠ” ì´ìœ ê°€ ë¬´ì—‡ì¼ê¹Œìš”?
            - DB í…Œì´ë¸”ì—ì„œëŠ” ê³ ê° í…Œì´ë¸” ê¸°ì¤€ìœ¼ë¡œ ìŒì‹ì˜ ì •ë³´ë¥¼ ì¡°íšŒí•˜ë ¤ê³  í•  ë•Œ JOINì„ ì‚¬ìš©í•˜ì—¬ ë°”ë¡œ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ì§€ë§Œ ê³ ê° Entity ì…ì¥ì—ì„œëŠ” ìŒì‹ Entityì˜ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šìœ¼ë©´ ìŒì‹ì˜ ì •ë³´ë¥¼ ì¡°íšŒí•  ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤.
            - ë”°ë¼ì„œ DB í…Œì´ë¸”ì— ì‹¤ì œ ì»¬ëŸ¼ìœ¼ë¡œ ì¡´ì¬í•˜ì§€ëŠ” ì•Šì§€ë§Œ Entity ìƒíƒœì—ì„œ ë‹¤ë¥¸ Entityë¥¼ ì°¸ì¡°í•˜ê¸° ìœ„í•´ ì´ëŸ¬í•œ ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        - í˜„ì¬ ìŒì‹ Entityì™€ ê³ ê° EntityëŠ” ì„œë¡œë¥¼ ì°¸ì¡°í•˜ê³  ìˆìŠµë‹ˆë‹¤.
            - ì´ëŸ¬í•œ ê´€ê³„ë¥¼ ì–‘ë°©í–¥ ê´€ê³„ë¼ ë¶€ë¦…ë‹ˆë‹¤.
        - ê·¸ëŸ¼ ë°˜ëŒ€ë¡œ ë‹¨ë°©í–¥ ê´€ê³„ëŠ” ì–´ë–»ê²Œ í‘œí˜„ ë˜ëŠ”ì§€ ë³´ê² ìŠµë‹ˆë‹¤.
            - ìŒì‹

                ```java
                @Entity
                @Table(name = "food")
                public class Food {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;
                    private double price;

                    @ManyToOne
                    @JoinColumn(name = "user_id")
                    private User user;
                }
                ```

            - ê³ ê°

                ```java
                @Entity
                @Table(name = "users")
                public class User {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;
                }
                ```

            - ìŒì‹ Entityì—ì„œë§Œ ê³ ê° Entityë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                - ì´ëŸ¬í•œ ê´€ê³„ë¥¼ ë‹¨ë°©í–¥ ê´€ê³„ë¼ ë¶€ë¦…ë‹ˆë‹¤.
                - ê³ ê° Entityì—ëŠ” ìŒì‹ Entityì˜ ì •ë³´ê°€ ì—†ê¸° ë•Œë¬¸ì— ìŒì‹ ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    - <ì •ë¦¬>
        - DB í…Œì´ë¸”ì—ì„œëŠ” í…Œì´ë¸” ì‚¬ì´ì˜ ì—°ê´€ê´€ê³„ë¥¼ FK(ì™¸ë˜ í‚¤)ë¡œ ë§ºì„ ìˆ˜ ìˆê³  ë°©í–¥ ìƒê´€ì—†ì´ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        - Entityì—ì„œëŠ” ìƒëŒ€ Entityë¥¼ ì°¸ì¡°í•˜ì—¬ Entity ì‚¬ì´ì˜ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - í•˜ì§€ë§Œ ìƒëŒ€ Entityë¥¼ ì°¸ì¡°í•˜ì§€ ì•Šê³  ìˆë‹¤ë©´ ìƒëŒ€ Entityë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ì—†ìŠµë‹ˆë‹¤.
        - ë”°ë¼ì„œ Entityì—ì„œëŠ” DB í…Œì´ë¸”ì—ëŠ” ì—†ëŠ” ë°©í–¥ì˜ ê°œë…ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

## 07. 1 ëŒ€ 1 ê´€ê³„
- `@OneToOne`
    - `@OneToOne` ì• ë„ˆí…Œì´ì…˜ì€ 1 ëŒ€ 1 ê´€ê³„ë¥¼ ë§ºì–´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
    - ê³ ê° Entityì™€ ìŒì‹ Entityê°€ 1 ëŒ€ 1 ê´€ê³„ë¼ ê°€ì •í•˜ì—¬ ê´€ê³„ë¥¼ ë§ºì–´ë³´ê² ìŠµë‹ˆë‹¤.

- ë‹¨ë°©í–¥ ê´€ê³„
    - ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ ì •í•˜ê¸°
        - Entityì—ì„œ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì€ ì¼ë°˜ì ìœ¼ë¡œ N(ë‹¤)ì˜ ê´€ê³„ì¸ Entity ì´ì§€ë§Œ 1 ëŒ€ 1 ê´€ê³„ì—ì„œëŠ” ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì„ ì§ì ‘ ì§€ì •í•´ì•¼í•©ë‹ˆë‹¤.
            > **ì™¸ë˜ í‚¤ ì£¼ì¸**ë§Œì´Â **ì™¸ë˜ í‚¤** ë¥¼ **ë“±ë¡, ìˆ˜ì •, ì‚­ì œ**í•  ìˆ˜ ìˆìœ¼ë©°,Â **ì£¼ì¸ì´ ì•„ë‹Œ ìª½**ì€ ì˜¤ì§ **ì™¸ë˜ í‚¤**ë¥¼Â **ì½ê¸°ë§Œ ê°€ëŠ¥**í•©ë‹ˆë‹¤.
            >
        - @JoinColumn()ì€ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì´ í™œìš©í•˜ëŠ” ì• ë„ˆí…Œì´ì…˜ì…ë‹ˆë‹¤.
            - ì»¬ëŸ¼ëª…, null ì—¬ë¶€, unique ì—¬ë¶€ ë“±ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - ìŒì‹ Entityê°€ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì¸ ê²½ìš°!
            - ìŒì‹

                ```java
                @Entity
                @Table(name = "food")
                public class Food {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;
                    private double price;

                    @OneToOne
                    @JoinColumn(name = "user_id")
                    private User user;
                }
                ```

            - ê³ ê°

                ```java
                @Entity
                @Table(name = "users")
                public class User {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;
                }
                ```

        - ê³ ê° Entityê°€ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì¸ ê²½ìš°!
            - ìŒì‹

                ```java
                @Entity
                @Table(name = "food")
                public class Food {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;
                    private double price;
                }
                ```

            - ê³ ê°

                ```java
                @Entity
                @Table(name = "users")
                public class User {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;

                    @OneToOne
                    @JoinColumn(name = "food_id")
                    private Food food;
                }
                ```

- ì–‘ë°©í–¥ ê´€ê³„
    - ì–‘ë°©í–¥ ì„¤ì •
        - ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì„ ì§€ì •í•´ ì¤„ ë•Œ mappedBy ì˜µì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
            - mappedByì˜ ì†ì„±ê°’ì€ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì¸ ìƒëŒ€ Entityì˜ í•„ë“œëª…ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
        - ê´€ê³„ ì„¤ì • ë°©ë²•ì— ëŒ€í•´ ì •ë¦¬ í•´ë³´ê² ìŠµë‹ˆë‹¤.
            - ë‹¨ë°©í–¥ì´ë¼ë©´ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ë§Œ ìƒëŒ€ Entity íƒ€ì…ì˜ í•„ë“œë¥¼ ê°€ì§€ë©´ì„œ @JoinColumn()ì„ í™œìš©í•˜ì—¬ ì™¸ë˜ í‚¤ì˜ ì†ì„±ì„ ì„¤ì •í•´ì£¼ë©´ë©ë‹ˆë‹¤.
            - ì–‘ë°©í–¥ì´ë¼ë©´ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì€ ìƒëŒ€ Entity íƒ€ì…ì˜ í•„ë“œë¥¼ ê°€ì§€ë©´ì„œ @JoinColumn()ì„ í™œìš©í•˜ì—¬ ì™¸ë˜ í‚¤ì˜ ì†ì„±ì„ ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.
                - ê·¸ë¦¬ê³  ìƒëŒ€ EntityëŠ” ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ Entity íƒ€ì…ì˜ í•„ë“œë¥¼ ê°€ì§€ë©´ì„œ mappedBy ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì†ì„± ê°’ìœ¼ë¡œ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ Entityì— ì„ ì–¸ëœ @JoinColumn()ìœ¼ë¡œ ì„¤ì •ë˜ê³  ìˆëŠ” í•„ë“œëª…ì„ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.
            âš ï¸ ì£¼ì˜!
            1.  ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ Entityì—ì„œ @JoinColumn() ì• ë„ˆí…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ default ì˜µì…˜ì´ ì ìš©ë˜ê¸° ë•Œë¬¸ì— ìƒëµì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                - ë‹¤ë§Œ 1 ëŒ€ N ê´€ê³„ì—ì„œ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ Entityê°€ @JoinColumn() ì• ë„ˆí…Œì´ì…˜ì„ ìƒëµí•œë‹¤ë©´ JPAê°€ ì™¸ë˜ í‚¤ë¥¼ ì €ì¥í•  ì»¬ëŸ¼ì„ íŒŒì•…í•  ìˆ˜ê°€ ì—†ì–´ì„œ ì˜ë„í•˜ì§€ ì•Šì€ ì¤‘ê°„ í…Œì´ë¸”ì´ ìƒì„±ë©ë‹ˆë‹¤.
                - ë”°ë¼ì„œ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ Entityì—ì„œ @JoinColumn() ì• ë„ˆí…Œì´ì…˜ì„ í™œìš©í•˜ì‹œëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.
            2.  ì–‘ë°©í–¥ ê´€ê³„ì—ì„œ mappedBy ì˜µì…˜ì„ ìƒëµí•  ê²½ìš° JPAê°€ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ Entityë¥¼ íŒŒì•…í•  ìˆ˜ê°€ ì—†ì–´ ì˜ë„í•˜ì§€ ì•Šì€ ì¤‘ê°„ í…Œì´ë¸”ì´ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ ì„¤ì •í•´ì£¼ì‹œëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.

        - ìŒì‹ Entityê°€ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì¸ ê²½ìš°!
            - ìŒì‹

                ```java
                @Entity
                @Table(name = "food")
                public class Food {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;
                    private double price;

                    @OneToOne
                    @JoinColumn(name = "user_id")
                    private User user;
                }
                ```

            - ê³ ê°

                ```java
                @Entity
                @Table(name = "users")
                public class User {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;

                    @OneToOne(mappedBy = "user")
                    private Food food;
                }
                ```

        - ê³ ê° Entityê°€ ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì¸ ê²½ìš°!
            - ìŒì‹

                ```java
                @Entity
                @Table(name = "food")
                public class Food {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;
                    private double price;

                    @OneToOne(mappedBy = "food")
                    private User user;
                }
                ```

            - ê³ ê°

                ```java
                @Entity
                @Table(name = "users")
                public class User {
                    @Id
                    @GeneratedValue(strategy = GenerationType.IDENTITY)
                    private Long id;
                    private String name;

                    @OneToOne
                    @JoinColumn(name = "food_id")
                    private Food food;
                }
                ```

- ì—°ìŠµí•˜ê¸°
    - ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì´ ìŒì‹ Entityì¸ ê²½ìš°ë¥¼ ì—°ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤.
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] OneToOneTest

            ```java
            package com.sparta.jpaadvance.relation;

            import com.sparta.jpaadvance.repository.FoodRepository;
            import com.sparta.jpaadvance.repository.UserRepository;
            import org.springframework.beans.factory.annotation.Autowired;
            import org.springframework.boot.test.context.SpringBootTest;
            import org.springframework.transaction.annotation.Transactional;

            @Transactional
            @SpringBootTest
            public class OneToOneTest {

                @Autowired
                UserRepository userRepository;
                @Autowired
                FoodRepository foodRepository;

            }
            ```

    - ë‹¨ë°©í–¥
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] Food Entity

            ```java
            package com.sparta.jpaadvance.entity;

            import jakarta.persistence.*;
            import lombok.Getter;
            import lombok.Setter;

            @Entity
            @Getter
            @Setter
            @Table(name = "food")
            public class Food {
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;
                private String name;
                private double price;

                @OneToOne
                @JoinColumn(name = "user_id")
                private User user;
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] User Entity

            ```java
            package com.sparta.jpaadvance.entity;

            import jakarta.persistence.*;
            import lombok.Getter;
            import lombok.Setter;

            @Entity
            @Getter
            @Setter
            @Table(name = "users")
            public class User {
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;
                private String name;
            }
            ```

    - ë‹¨ë°©í–¥ í…ŒìŠ¤íŠ¸
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] OneToOne ë‹¨ë°©í–¥ í…ŒìŠ¤íŠ¸

            ```java
            @Test
            @Rollback(value = false) // í…ŒìŠ¤íŠ¸ì—ì„œëŠ” @Transactional ì— ì˜í•´ ìë™ rollback ë¨ìœ¼ë¡œ false ì„¤ì •í•´ì¤€ë‹¤.
            @DisplayName("1ëŒ€1 ë‹¨ë°©í–¥ í…ŒìŠ¤íŠ¸")
            void test1() {

                User user = new User();
                user.setName("Robbie");

                // ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì¸ Food Entity user í•„ë“œì— user ê°ì²´ë¥¼ ì¶”ê°€í•´ ì¤ë‹ˆë‹¤.
                Food food = new Food();
                food.setName("í›„ë¼ì´ë“œ ì¹˜í‚¨");
                food.setPrice(15000);
                food.setUser(user); // ì™¸ë˜ í‚¤(ì—°ê´€ ê´€ê³„) ì„¤ì •

                userRepository.save(user);
                foodRepository.save(food);
            }
            ```

    - ì–‘ë°©í–¥
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] ì–‘ë°©í–¥ User Entity

            ```java
            package com.sparta.jpaadvance.entity;

            import jakarta.persistence.*;
            import lombok.Getter;
            import lombok.Setter;

            @Entity
            @Getter
            @Setter
            @Table(name = "users")
            public class User {
                @Id
                @GeneratedValue(strategy = GenerationType.IDENTITY)
                private Long id;
                private String name;

                @OneToOne(mappedBy = "user")
                private Food food;

                public void addFood(Food food) {
                    this.food = food;
                    food.setUser(this);
                }
            }
            ```

    - ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] OneToOne ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸

            ```java
            @Test
            @Rollback(value = false)
            @DisplayName("1ëŒ€1 ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸ : ì™¸ë˜ í‚¤ ì €ì¥ ì‹¤íŒ¨")
            void test2() {
                Food food = new Food();
                food.setName("ê³ êµ¬ë§ˆ í”¼ì");
                food.setPrice(30000);

                // ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì´ ì•„ë‹Œ User ì—ì„œ Food ë¥¼ ì €ì¥í•´ë³´ê² ìŠµë‹ˆë‹¤.
                User user = new User();
                user.setName("Robbie");
                user.setFood(food);

                userRepository.save(user);
                foodRepository.save(food);

                // í™•ì¸í•´ ë³´ì‹œë©´ user_id ê°’ì´ ë“¤ì–´ê°€ ìˆì§€ ì•Šì€ ê²ƒì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            }

            @Test
            @Rollback(value = false)
            @DisplayName("1ëŒ€1 ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸ : ì™¸ë˜ í‚¤ ì €ì¥ ì‹¤íŒ¨ -> ì„±ê³µ")
            void test3() {
                Food food = new Food();
                food.setName("ê³ êµ¬ë§ˆ í”¼ì");
                food.setPrice(30000);

                // ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì´ ì•„ë‹Œ User ì—ì„œ Food ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ addFood() ë©”ì„œë“œ ì¶”ê°€
                // ì™¸ë˜ í‚¤(ì—°ê´€ ê´€ê³„) ì„¤ì • food.setUser(this); ì¶”ê°€
                User user = new User();
                user.setName("Robbie");
                user.addFood(food);

                userRepository.save(user);
                foodRepository.save(food);
            }

            @Test
            @Rollback(value = false)
            @DisplayName("1ëŒ€1 ì–‘ë°©í–¥ í…ŒìŠ¤íŠ¸")
            void test4() {
                User user = new User();
                user.setName("Robbert");

                Food food = new Food();
                food.setName("ê³ êµ¬ë§ˆ í”¼ì");
                food.setPrice(30000);
                food.setUser(user); // ì™¸ë˜ í‚¤(ì—°ê´€ ê´€ê³„) ì„¤ì •

                userRepository.save(user);
                foodRepository.save(food);
            }
            ```

    - ì¡°íšŒ
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] OneToOne ì¡°íšŒ í…ŒìŠ¤íŠ¸

            ```java
            @Test
            @DisplayName("1ëŒ€1 ì¡°íšŒ : Food ê¸°ì¤€ user ì •ë³´ ì¡°íšŒ")
            void test5() {
                Food food = foodRepository.findById(1L).orElseThrow(NullPointerException::new);
                // ìŒì‹ ì •ë³´ ì¡°íšŒ
                System.out.println("food.getName() = " + food.getName());

                // ìŒì‹ì„ ì£¼ë¬¸í•œ ê³ ê° ì •ë³´ ì¡°íšŒ
                System.out.println("food.getUser().getName() = " + food.getUser().getName());
            }

            @Test
            @DisplayName("1ëŒ€1 ì¡°íšŒ : User ê¸°ì¤€ food ì •ë³´ ì¡°íšŒ")
            void test6() {
                User user = userRepository.findById(1L).orElseThrow(NullPointerException::new);
                // ê³ ê° ì •ë³´ ì¡°íšŒ
                System.out.println("user.getName() = " + user.getName());

                // í•´ë‹¹ ê³ ê°ì´ ì£¼ë¬¸í•œ ìŒì‹ ì •ë³´ ì¡°íšŒ
                Food food = user.getFood();
                System.out.println("food.getName() = " + food.getName());
                System.out.println("food.getPrice() = " + food.getPrice());
            }
            ```