# ë‚´ì¼ë°°ì›€ìº í”„ 240612 TIL
Java 42ì¼ì°¨
RestTemplate & Open API, ì˜¤ë¥˜ í•´ê²°
-------------------------------------------------------------------------------


# RestTemplate & Open API
## 01. RestTemplateì´ë€ ë¬´ì—‡ì¼ê¹Œ?
- Server To Server
    - ì§€ê¸ˆê¹Œì§€ëŠ” Client ì¦‰, ë¸Œë¼ìš°ì €ë¡œë¶€í„° ìš”ì²­ì„ ë°›ëŠ” ì„œë²„ì˜ ì…ì¥ì—ì„œ ê°œë°œì„ ì§„í–‰í•´ì™”ìŠµë‹ˆë‹¤.
    - ì„œë¹„ìŠ¤ ê°œë°œì„ ì§„í–‰í•˜ë‹¤ë³´ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ë§Œìœ¼ë¡œëŠ” êµ¬í˜„ì´ í˜ë“  ê¸°ëŠ¥ë“¤ì´ ë¬´ìˆ˜íˆ ë§ì´ ì¡´ì¬í•©ë‹ˆë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´ ìš°ë¦¬ì˜ ì„œë¹„ìŠ¤ì—ì„œ íšŒì›ê°€ì…ì„ ì§„í–‰í•  ë•Œ ì‚¬ìš©ìì˜ ì£¼ì†Œë¥¼ ë°›ì•„ì•¼ í•œë‹¤ë©´?
        - ì£¼ì†Œë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•´ì•¼í•˜ëŠ”ë° ì§ì ‘ êµ¬í˜„ì„ í•˜ê²Œë˜ë©´ ë§ì€ ì‹œê°„ê³¼ ë¹„ìš©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.
    - ì´ ë•Œ, ì¹´ì¹´ì˜¤ì—ì„œ ë§Œë“  [ì£¼ì†Œ ê²€ìƒ‰ API](https://postcode.map.daum.net/guide)ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ í•´ë‹¹ ê¸°ëŠ¥ì„ ê°„í¸í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ì´ëŸ´ ë•Œ ìš°ë¦¬ì˜ ì„œë²„ëŠ” Clientì˜ ì…ì¥ì´ ë˜ì–´ Kakao ì„œë²„ì— ìš”ì²­ì„ ì§„í–‰í•´ì•¼í•©ë‹ˆë‹¤.
    - Springì—ì„œëŠ” ì„œë²„ì—ì„œ ë‹¤ë¥¸ ì„œë²„ë¡œ ê°„í¸í•˜ê²Œ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡ RestTemplate ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.

- í”„ë¡œì íŠ¸ ìƒì„±
    - í”„ë¡œì íŠ¸ ì¤€ë¹„í•˜ê¸°(Client ì…ì¥ ì„œë²„)
        1. IntelliJë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        2. New Projectë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        3. ì™¼ìª½ ë©”ë‰´ì—ì„œ "Spring Initializrâ€ë¥¼ í´ë¦­í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
        4.  ğŸš’**[ì¤‘ìš”] ê¼­ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.**
            - Name: spring-resttemplate-client
            - **Language: Java**
            - **Build system: Gradle - Groovy**
            - Group: com.sparta
            - **JDK: 17**
            - í”„ë¡œì íŠ¸ ê²½ë¡œ(Location)ëŠ” ììœ ë¡­ê²Œ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
        5. Nextë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        6. Dependenciesë¥¼ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ ì¶”ê°€í•´ì£¼ê³  Createë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

    - í”„ë¡œì íŠ¸ ì¤€ë¹„í•˜ê¸°(Server ì…ì¥ ì„œë²„)
        1. IntelliJë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        2. New Projectë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        3. ì™¼ìª½ ë©”ë‰´ì—ì„œ "Spring Initializrâ€ë¥¼ í´ë¦­í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
        4.  ğŸš’**[ì¤‘ìš”] ê¼­ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.**
            - Name: spring-resttemplate-server
            - **Language: Java**
            - **Build system: Gradle - Groovy**
            - Group: com.sparta
            - **JDK: 17**
            - í”„ë¡œì íŠ¸ ê²½ë¡œ(Location)ëŠ” ììœ ë¡­ê²Œ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
        5. Nextë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        6. Dependenciesë¥¼ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ ì¶”ê°€í•´ì£¼ê³  Createë¥¼ í´ë¦­í•©ë‹ˆë‹¤.

- RestTemplate ì‚¬ìš©ë°©ë²•
    - í”„ë¡œì íŠ¸ 2ê°œë¥¼ ë§Œë“¤ì–´ì„œ Client ì…ì¥ì˜ ì„œë²„ëŠ” 8080 port, Server ì…ì¥ì˜ ì„œë²„ëŠ” 7070 portë¡œ ë™ì‹œì— ì‹¤í–‰ì‹œí‚¤ê² ìŠµë‹ˆë‹¤.
    - Client ì…ì¥ ì„œë²„

            ```java
            package com.sparta.springresttemplateclient.controller;

            import com.sparta.springresttemplateclient.dto.ItemDto;
            import com.sparta.springresttemplateclient.service.RestTemplateService;
            import org.springframework.web.bind.annotation.GetMapping;
            import org.springframework.web.bind.annotation.RequestHeader;
            import org.springframework.web.bind.annotation.RequestMapping;
            import org.springframework.web.bind.annotation.RestController;

            import java.util.List;

            @RestController
            @RequestMapping("/api/client")
            public class RestTemplateController {

                private final RestTemplateService restTemplateService;

                public RestTemplateController(RestTemplateService restTemplateService) {
                    this.restTemplateService = restTemplateService;
                }

                @GetMapping("/get-call-obj")
                public ItemDto getCallObject(String query) {
                    return restTemplateService.getCallObject(query);
                }

                @GetMapping("/get-call-list")
                public List<ItemDto> getCallList() {
                    return restTemplateService.getCallList();
                }

                @GetMapping("/post-call")
                public ItemDto postCall(String query) {
                    return restTemplateService.postCall(query);
                }

                @GetMapping("/exchange-call")
                public List<ItemDto> exchangeCall(@RequestHeader("Authorization") String token) {
                    return restTemplateService.exchangeCall(token);
                }
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] dto > ItemDto

            ```java
            package com.sparta.springresttemplateclient.dto;

            import lombok.Getter;
            import lombok.NoArgsConstructor;

            @Getter
            @NoArgsConstructor
            public class ItemDto {
                private String title;
                private int price;
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] entity > User

            ```java
            package com.sparta.springresttemplateclient.entity;

            import lombok.Getter;

            @Getter
            public class User {
                private String username;
                private String password;

                public User(String username, String password) {
                    this.username = username;
                    this.password = password;
                }
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] service > RestTemplateService

            ```java
            package com.sparta.springresttemplateclient.service;

            import com.sparta.springresttemplateclient.dto.ItemDto;
            import org.springframework.stereotype.Service;

            import java.util.List;

            @Slf4j
            @Service
            public class RestTemplateService {

                public ItemDto getCallObject(String query) {
                    return null;
                }

                public List<ItemDto> getCallList() {
                    return null;
                }

                public ItemDto postCall(String query) {
                    return null;
                }

                public List<ItemDto> exchangeCall(String token) {
                    return null;
                }
            }
            ```

    - Server ì…ì¥ ì„œë²„
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] controller > ItemController

            ```java
            package com.sparta.springresttemplateserver.controller;

            import com.sparta.springresttemplateserver.dto.ItemResponseDto;
            import com.sparta.springresttemplateserver.dto.UserRequestDto;
            import com.sparta.springresttemplateserver.entity.Item;
            import com.sparta.springresttemplateserver.service.ItemService;
            import org.springframework.web.bind.annotation.*;

            @RestController
            @RequestMapping("/api/server")
            public class ItemController {

                private final ItemService itemService;

                public ItemController(ItemService itemService) {
                    this.itemService = itemService;
                }

                @GetMapping("/get-call-obj")
                public Item getCallObject(@RequestParam String query) {
                    return itemService.getCallObject(query);
                }

                @GetMapping("/get-call-list")
                public ItemResponseDto getCallList() {
                    return itemService.getCallList();
                }

                @PostMapping("/post-call/{query}")
                public Item postCall(@PathVariable String query, @RequestBody UserRequestDto requestDto) {
                    return itemService.postCall(query, requestDto);
                }

                @PostMapping("/exchange-call")
                public ItemResponseDto exchangeCall(@RequestHeader("X-Authorization") String token, @RequestBody UserRequestDto requestDto) {
                    return itemService.exchangeCall(token, requestDto);
                }
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] dto > UserRequestDto

            ```java
            package com.sparta.springresttemplateserver.dto;

            import lombok.Getter;

            @Getter
            public class UserRequestDto {
                private String username;
                private String password;
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] dto > ItemResponseDto

            ```java
            package com.sparta.springresttemplateserver.dto;

            import com.sparta.springresttemplateserver.entity.Item;
            import lombok.Getter;

            import java.util.ArrayList;
            import java.util.List;

            @Getter
            public class ItemResponseDto {
                private final List<Item> items = new ArrayList<>();

                public void setItems(Item item) {
                    items.add(item);
                }
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] entity > Item

            ```java
            package com.sparta.springresttemplateserver.entity;

            import lombok.Getter;

            @Getter
            public class Item {
                private String title;
                private int price;

                public Item(String title, int price) {
                    this.title = title;
                    this.price = price;
                }
            }
            ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] service > ItemService

            ```java
            package com.sparta.springresttemplateserver.service;

            import com.sparta.springresttemplateserver.dto.ItemResponseDto;
            import com.sparta.springresttemplateserver.dto.UserRequestDto;
            import com.sparta.springresttemplateserver.entity.Item;
            import org.springframework.stereotype.Service;

            import java.util.Arrays;
            import java.util.List;

            @Service
            public class ItemService {

                private final List<Item> itemList = Arrays.asList(
                        new Item("Mac", 3_888_000),
                        new Item("iPad", 1_230_000),
                        new Item("iPhone", 1_550_000),
                        new Item("Watch", 450_000),
                        new Item("AirPods", 350_000)
                );

                public Item getCallObject(String query) {
                    return null;
                }

                public ItemResponseDto getCallList() {
                    return null;
                }

                public Item postCall(String query, UserRequestDto requestDto) {
                    return null;
                }

                public ItemResponseDto exchangeCall(String token, UserRequestDto requestDto) {
                    return null;
                }
            }
            ```

## 02. RestTemplateì˜ Get ìš”ì²­
- Get ìš”ì²­ ë°©ë²•
    - Client ì…ì¥ ì„œë²„
        1. RestTemplateì„ ì£¼ì… ë°›ìŠµë‹ˆë‹¤.

            ```java
            private final RestTemplate restTemplate;

            // RestTemplateBuilderì˜ build()ë¥¼ ì‚¬ìš©í•˜ì—¬ RestTemplateì„ ìƒì„±í•©ë‹ˆë‹¤.
            public RestTemplateService(RestTemplateBuilder builder) {
                this.restTemplate = builder.build();
            }
            ```

        2. ìš”ì²­ ë°›ì€ ê²€ìƒ‰ì–´ë¥¼ Query String  ë°©ì‹ìœ¼ë¡œ Server ì…ì¥ì˜ ì„œë²„ë¡œ  RestTemplateë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­í•©ë‹ˆë‹¤.

            ```java
            public ItemDto getCallObject(String query) {
                // ìš”ì²­ URL ë§Œë“¤ê¸°
                URI uri = UriComponentsBuilder
                        .fromUriString("http://localhost:7070")
                        .path("/api/server/get-call-obj")
                        .queryParam("query", query)
                        .encode()
                        .build()
                        .toUri();
                log.info("uri = " + uri);

                ResponseEntity<ItemDto> responseEntity = restTemplate.getForEntity(uri, ItemDto.class);

                log.info("statusCode = " + responseEntity.getStatusCode());

                return responseEntity.getBody();
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] RestTemplateService - getCallObject

                ```java
                public ItemDto getCallObject(String query) {
                    // ìš”ì²­ URL ë§Œë“¤ê¸°
                    URI uri = UriComponentsBuilder
                            .fromUriString("http://localhost:7070")
                            .path("/api/server/get-call-obj")
                            .queryParam("query", query)
                            .encode()
                            .build()
                            .toUri();
                    log.info("uri = " + uri);

                    ResponseEntity<ItemDto> responseEntity = restTemplate.getForEntity(uri, ItemDto.class);

                    log.info("statusCode = " + responseEntity.getStatusCode());

                    return responseEntity.getBody();
                }
                ```

            - Springì˜ UriComponentsBuilderë¥¼ ì‚¬ìš©í•´ì„œ URIë¥¼ ì†ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            - RestTemplateì˜ getForEntityëŠ” Get ë°©ì‹ìœ¼ë¡œ í•´ë‹¹ URIì˜ ì„œë²„ì— ìš”ì²­ì„ ì§„í–‰í•©ë‹ˆë‹¤.
                - ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” URI, ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” ì „ë‹¬ ë°›ì€ ë°ì´í„°ì™€ ë§¤í•‘í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤í™”í•  í´ë˜ìŠ¤ì˜ íƒ€ì…ì„ ì£¼ë©´ë©ë‹ˆë‹¤.
            - ìš”ì²­ì˜ ê²°ê³¼ê°’ì— ëŒ€í•´ì„œ ì§ì ‘ JSON TO Objectë¥¼ êµ¬í˜„í•  í•„ìš”ì—†ì´ RestTemplateì„ ì‚¬ìš©í•˜ë©´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ í•´ì¤ë‹ˆë‹¤.
                - ë”°ë¼ì„œ `response.getBody()` ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•œ í´ë˜ìŠ¤ íƒ€ì…ìœ¼ë¡œ ìë™ ë³€í™˜ëœ ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - Server ì…ì¥ ì„œë²„
        1. Server ì…ì¥ì˜ ì„œë²„ì—ì„œ itemListë¥¼ ì¡°íšŒí•˜ì—¬ ìš”ì²­ë°›ì€ ê²€ìƒ‰ì–´ì— ë§ëŠ” Itemì„ ë°˜í™˜í•©ë‹ˆë‹¤.

            ```java
            public Item getCallObject(String query) {
                for (Item item : itemList) {
                    if(item.getTitle().equals(query)) {
                        return item;
                    }
                }
                return null;
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] ItemService - getCallObject

                ```java
                public Item getCallObject(String query) {
                    for (Item item : itemList) {
                        if(item.getTitle().equals(query)) {
                            return item;
                        }
                    }
                    return null;
                }
                ```

- ìš”ì²­í•œ Itemì´ ì—¬ëŸ¬ ê°œë¼ë©´?
    - Client ì…ì¥ ì„œë²„
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] build.gradle : json

            ```groovy
            // json
            implementation 'org.json:json:20230227'
            ```

        1. Item List ì¡°íšŒ

            ```java
            public List<ItemDto> getCallList() {
                // ìš”ì²­ URL ë§Œë“¤ê¸°
                URI uri = UriComponentsBuilder
                        .fromUriString("http://localhost:7070")
                        .path("/api/server/get-call-list")
                        .encode()
                        .build()
                        .toUri();
                log.info("uri = " + uri);

                ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);

                log.info("statusCode = " + responseEntity.getStatusCode());
                log.info("Body = " + responseEntity.getBody());

                return fromJSONtoItems(responseEntity.getBody());
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] RestTemplateService - getCallList

                ```java
                public List<ItemDto> getCallList() {
                    // ìš”ì²­ URL ë§Œë“¤ê¸°
                    URI uri = UriComponentsBuilder
                            .fromUriString("http://localhost:7070")
                            .path("/api/server/get-call-list")
                            .encode()
                            .build()
                            .toUri();
                    log.info("uri = " + uri);

                    ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);

                    log.info("statusCode = " + responseEntity.getStatusCode());
                    log.info("Body = " + responseEntity.getBody());

                    return fromJSONtoItems(responseEntity.getBody());
                }
                ```

            - ê²°ê³¼ ê°’ì´ ë‹¤ì¤‘ JSONìœ¼ë¡œ ë„˜ì–´ì˜¤ê¸° ë•Œë¬¸ì— JSON To Objectë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì¼ë‹¨ String ê°’ ê·¸ëŒ€ë¡œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
                - Server ì…ì¥ ì„œë²„ì˜ ItemResponseDtoëŠ” ì•„ë˜ì˜ JSON í˜•íƒœë¡œ ë³€í™˜ë˜ì–´ ì „ë‹¬ë©ë‹ˆë‹¤.

                    ```json
                    {
                    "items":[
                    		{"title":"Mac","price":3888000},
                    		{"title":"iPad","price":1230000},
                    		{"title":"iPhone","price":1550000},
                    		{"title":"Watch","price":450000},
                    		{"title":"AirPods","price":350000}
                    	]
                    }
                    ```

                - JSON ì²˜ë¦¬ë¥¼ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ ë°›ì•„ì˜¨ JSON í˜•íƒœì˜ Stringì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

                    ```java
                    public List<ItemDto> fromJSONtoItems(String responseEntity) {
                        JSONObject jsonObject = new JSONObject(responseEntity);
                        JSONArray items  = jsonObject.getJSONArray("items");
                        List<ItemDto> itemDtoList = new ArrayList<>();

                        for (Object item : items) {
                            ItemDto itemDto = new ItemDto((JSONObject) item);
                            itemDtoList.add(itemDto);
                        }

                        return itemDtoList;
                    }
                    ```

                    - [ì½”ë“œ ìŠ¤ë‹ˆí«] RestTemplateService - fromJSONtoItems

                        ```java
                        public List<ItemDto> fromJSONtoItems(String responseEntity) {
                            JSONObject jsonObject = new JSONObject(responseEntity);
                            JSONArray items  = jsonObject.getJSONArray("items");
                            List<ItemDto> itemDtoList = new ArrayList<>();

                            for (Object item : items) {
                                ItemDto itemDto = new ItemDto((JSONObject) item);
                                itemDtoList.add(itemDto);
                            }

                            return itemDtoList;
                        }
                        ```

                    - JSONObject, JSONArray ì´í•´í•˜ê¸°
                        1. **ë¬¸ìì—´ ì •ë³´ë¥¼ JSONObjectë¡œ ë°”ê¾¸ê¸°**

                            ```java
                            JSONObject jsonObject = new JSONObject(responseEntity);
                            ```

                        2. **JSONObjectì—ì„œ items ë°°ì—´ êº¼ë‚´ê¸°**

                            ```java
                            JSONArray items  = jsonObject.getJSONArray("items");
                            ```

                        3. **JSONArrayë¡œ forë¬¸ ëŒë©´ì„œ ìƒí’ˆ í•˜ë‚˜ì”© ItemDtoë¡œ ë³€í™˜í•˜ê¸°**

                            ```java
                            List<ItemDto> itemDtoList = new ArrayList<>();

                            for (Object item : items) {
                                ItemDto itemDto = new ItemDto((JSONObject) item);
                                itemDtoList.add(itemDto);
                            }
                            ```

                        4. **JSONObjectì—ì„œ ItemDtoë¡œ ë³€í™˜í•˜ê¸°**

                            ```java
                            this.title = itemJson.getString("title");
                            this.price = itemJson.getInt("price");
                            ```

        - ItemDtoì— ë°›ì•„ì˜¨ JSONObjectë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ˆê¸°í™”í•˜ëŠ” ìƒì„±ìë¥¼ ì¶”ê°€ í•´ì¤ë‹ˆë‹¤.

            ```java
            @Getter
            @NoArgsConstructor
            public class ItemDto {
                private String title;
                private int price;

                public ItemDto(JSONObject itemJson) {
                    this.title = itemJson.getString("title");
                    this.price = itemJson.getInt("price");
                }
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] ItemDto

                ```java
                package com.sparta.springresttemplateclient.dto;

                import lombok.Getter;
                import lombok.NoArgsConstructor;
                import org.json.JSONObject;

                @Getter
                @NoArgsConstructor
                public class ItemDto {
                    private String title;
                    private int price;

                    public ItemDto(JSONObject itemJson) {
                        this.title = itemJson.getString("title");
                        this.price = itemJson.getInt("price");
                    }
                }
                ```

    - Server ì…ì¥ì˜ ì„œë²„
        1. Server ì…ì¥ì˜ ì„œë²„ì—ì„œ itemListë¥¼ ItemResponseDtoì— ë‹´ì•„ ë°˜í™˜í•©ë‹ˆë‹¤.

            ```java
            public ItemResponseDto getCallList() {
                ItemResponseDto responseDto = new ItemResponseDto();
                for (Item item : itemList) {
                    responseDto.setItems(item);
                }
                return responseDto;
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] ItemService - getCallList

                ```java
                public ItemResponseDto getCallList() {
                    ItemResponseDto responseDto = new ItemResponseDto();
                    for (Item item : itemList) {
                        responseDto.setItems(item);
                    }
                    return responseDto;
                }
                ```

## 03. RestTemplateì˜ Post ìš”ì²­

- Post ìš”ì²­ ë°©ë²•
    - Client ì…ì¥ ì„œë²„
        1. ìš”ì²­ ë°›ì€ ê²€ìƒ‰ì–´ë¥¼ Query String  ë°©ì‹ìœ¼ë¡œ Server ì…ì¥ì˜ ì„œë²„ë¡œ  RestTemplateë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­í•©ë‹ˆë‹¤.

            ```java
            public ItemDto postCall(String query) {
                // ìš”ì²­ URL ë§Œë“¤ê¸°
                URI uri = UriComponentsBuilder
                        .fromUriString("http://localhost:7070")
                        .path("/api/server/post-call/{query}")
                        .encode()
                        .build()
                        .expand(query)
                        .toUri();
                log.info("uri = " + uri);

                User user = new User("Robbie", "1234");

                ResponseEntity<ItemDto> responseEntity = restTemplate.postForEntity(uri, user, ItemDto.class);

                log.info("statusCode = " + responseEntity.getStatusCode());

                return responseEntity.getBody();
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] RestTemplateService - postCall

                ```java
                public ItemDto postCall(String query) {
                    // ìš”ì²­ URL ë§Œë“¤ê¸°
                    URI uri = UriComponentsBuilder
                            .fromUriString("http://localhost:7070")
                            .path("/api/server/post-call/{query}")
                            .encode()
                            .build()
                            .expand(query)
                            .toUri();
                    log.info("uri = " + uri);

                    User user = new User("Robbie", "1234");

                    ResponseEntity<ItemDto> responseEntity = restTemplate.postForEntity(uri, user, ItemDto.class);

                    log.info("statusCode = " + responseEntity.getStatusCode());

                    return responseEntity.getBody();
                }
                ```

            - UriComponentsBuilderì˜ expandë¥¼ ì‚¬ìš©í•˜ì—¬ {query} ì•ˆì˜ ê°’ì„ ë™ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            - RestTemplateì˜ postForEntityëŠ”  Post ë°©ì‹ìœ¼ë¡œ í•´ë‹¹ URIì˜ ì„œë²„ì— ìš”ì²­ì„ ì§„í–‰í•©ë‹ˆë‹¤.
                - ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” URI, ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” HTTP Bodyì— ë„£ì–´ì¤„ ë°ì´í„°ë¥¼ ë„£ìŠµë‹ˆë‹¤.
                    - Java ê°ì²´ë¥¼ ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ JSON í˜•íƒœë¡œ ë³€í™˜ë©ë‹ˆë‹¤.
                - ì„¸ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” ì „ë‹¬ ë°›ì€ ë°ì´í„°ì™€ ë§¤í•‘í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤í™”í•  í´ë˜ìŠ¤ì˜ íƒ€ì…ì„ ì£¼ë©´ë©ë‹ˆë‹¤.
    - Server ì…ì¥ ì„œë²„
        1. Server ì…ì¥ì˜ ì„œë²„ì—ì„œ itemListë¥¼ ì¡°íšŒí•˜ì—¬ ìš”ì²­ë°›ì€ ê²€ìƒ‰ì–´ì— ë§ëŠ” Itemì„ ë°˜í™˜í•©ë‹ˆë‹¤.

            ```java
            public Item postCall(String query, UserRequestDto userRequestDto) {
                System.out.println("userRequestDto.getUsername() = " + userRequestDto.getUsername());
                System.out.println("userRequestDto.getPassword() = " + userRequestDto.getPassword());

                return getCallObject(query);
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] ItemService - postCall

                ```java
                public Item postCall(String query, UserRequestDto userRequestDto) {
                    System.out.println("userRequestDto.getUsername() = " + userRequestDto.getUsername());
                    System.out.println("userRequestDto.getPassword() = " + userRequestDto.getPassword());

                    return getCallObject(query);
                }
                ```

            - ì „ë‹¬ ë°›ì€ HTTP Bodyì˜  User ë°ì´í„°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

## 04. RestTemplateì˜ exchange

- ìš”ì²­ Headerì— ì •ë³´ë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´?
    - RestTemplateìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ Headerì— íŠ¹ì • ì •ë³´ë¥¼ ê°™ì´ ì „ë‹¬ í•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•˜ë©´ ë ê¹Œìš”?
    - Client ì…ì¥ ì„œë²„
        1. RestTemplateì˜ exchangeë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

            ```java
            public List<ItemDto> exchangeCall(String token) {
                // ìš”ì²­ URL ë§Œë“¤ê¸°
                URI uri = UriComponentsBuilder
                        .fromUriString("http://localhost:7070")
                        .path("/api/server/exchange-call")
                        .encode()
                        .build()
                        .toUri();
                log.info("uri = " + uri);

                User user = new User("Robbie", "1234");

                RequestEntity<User> requestEntity = RequestEntity
                        .post(uri)
                        .header("X-Authorization", token)
                        .body(user);

                ResponseEntity<String> responseEntity = restTemplate.exchange(requestEntity, String.class);

                return fromJSONtoItems(responseEntity.getBody());
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] RestTemplateService - exchangeCall

                ```java
                public List<ItemDto> exchangeCall(String token) {
                    // ìš”ì²­ URL ë§Œë“¤ê¸°
                    URI uri = UriComponentsBuilder
                            .fromUriString("http://localhost:7070")
                            .path("/api/server/exchange-call")
                            .encode()
                            .build()
                            .toUri();
                    log.info("uri = " + uri);

                    User user = new User("Robbie", "1234");

                    RequestEntity<User> requestEntity = RequestEntity
                            .post(uri)
                            .header("X-Authorization", token)
                            .body(user);

                    ResponseEntity<String> responseEntity = restTemplate.exchange(requestEntity, String.class);

                    return fromJSONtoItems(responseEntity.getBody());
                }
                ```

            - exchange ë©”ì„œë“œì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì— RequestEntity ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì „ë‹¬í•´ì£¼ë©´ uri, header, bodyì˜ ì •ë³´ë¥¼ í•œë²ˆì— ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - Server ì…ì¥ ì„œë²„
        1. ì „ë‹¬ëœ headerì™€ bodyì˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

            ```java
            public ItemResponseDto exchangeCall(String token, UserRequestDto requestDto) {
                System.out.println("token = " + token);
                System.out.println("requestDto.getUsername() = " + requestDto.getUsername());
                System.out.println("requestDto.getPassword() = " + requestDto.getPassword());

                return getCallList();
            }
            ```

            - [ì½”ë“œ ìŠ¤ë‹ˆí«] ItemService - exchangeCall

                ```java
                public ItemResponseDto exchangeCall(String token, UserRequestDto requestDto) {
                    System.out.println("token = " + token);
                    System.out.println("requestDto.getUsername() = " + requestDto.getUsername());
                    System.out.println("requestDto.getPassword() = " + requestDto.getPassword());

                    return getCallList();
                }
                ```



------------------------------------------------------------------------
ì˜¤ë¥˜ í•´ê²°

@GetMapping("/user-folder")
    public String getUserInfo(Model model, @AuthenticationPrincipal UserDetailsImpl userDetails) {

        model.addAttribute("folders", folderService.getFolders(userDetails.getUser()));

        return "index :: #fragment";
    }


addAttribute < ì˜¤ë¥˜ ë°œìƒ
'Model'ì˜ ë©”ì„œë“œ 'addAttribute'ì„(ë¥¼) í•´ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤

ê°•ì˜ ë‚´ìš© ë”°ë¼ì„œ ë˜‘ê°™ì´ ì‘ì„±í•˜ì˜€ëŠ”ë° ì•ˆëœë‹¤.. ì½”ë“œ ìŠ¤ë‹ˆí« ë³µì‚¬í•˜ì—¬ë„ ë˜‘ê°™ìŒ
íŠœí„°ë‹˜ê»˜ ë‹¬ë ¤ê°€ë‹ˆ
import ê°€ ì˜ëª»ëœê±° ê°™ë‹¤! ë¼ê³  í•˜ì‹¬
í•´ë‹¹ import
import ch.qos.logback.core.model.Model;

ì§€ìš°ê³  ìƒˆë¡œ import
import org.springframework.ui.Model;
í•´ê²°ì™„ë£Œ !!