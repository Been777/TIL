# ë‚´ì¼ë°°ì›€ìº í”„ 240524 TIL
Java 27ì¼ì°¨
Bean, ì¸ì¦ê³¼ ì¸ê°€
-------------------------------------------------------------------------------

# Bean
## 01. Beanì„ ìˆ˜ë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ë°©ë²•

- í”„ë¡œì íŠ¸ ìƒì„±
    - í”„ë¡œì íŠ¸ ì¤€ë¹„í•˜ê¸°
        1. IntelliJë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        2. New Projectë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        3. ì™¼ìª½ ë©”ë‰´ì—ì„œ "Spring Initializrâ€ë¥¼ í´ë¦­í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•©ë‹ˆë‹¤.
        4.  ğŸš’**[ì¤‘ìš”] ê¼­ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.**
            - Name: spring-auth
            - **Language: Java**
            - **Build system: Gradle - Groovy**
            - Group: com.sparta
            - **JDK: 17**
            - í”„ë¡œì íŠ¸ ê²½ë¡œ(Location)ëŠ” ììœ ë¡­ê²Œ ì„¤ì •í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
        5. Nextë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
        6. Dependenciesë¥¼ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ ì¶”ê°€í•´ì£¼ê³  Createë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
    - í”„ë¡œì íŠ¸ ì„¤ì •ì¶”ê°€
        - build.gradle
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] build.gradle : Security ì¶”ê°€

                ```groovy
                // Security
                implementation 'org.springframework.boot:spring-boot-starter-security'
                ```

        - Security ê¸°ëŠ¥ ì œí•œ
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] SpringAuthApplication

                ```java
                package com.sparta.springauth;

                import org.springframework.boot.SpringApplication;
                import org.springframework.boot.autoconfigure.SpringBootApplication;
                import org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration;

                @SpringBootApplication(exclude = SecurityAutoConfiguration.class) // Spring Security ì¸ì¦ ê¸°ëŠ¥ ì œì™¸
                public class SpringAuthApplication {

                    public static void main(String[] args) {
                        SpringApplication.run(SpringAuthApplication.class, args);
                    }

                }
                ```

- Bean ìˆ˜ë™ ë“±ë¡ì´ë€?
    - @Componentë¥¼ ì‚¬ìš©í•˜ë©´ @ComponentScanì— ì˜í•´ ìë™ìœ¼ë¡œ ìŠ¤ìº”ë˜ì–´ í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ Beanìœ¼ë¡œ ë“±ë¡ í•´ì¤ë‹ˆë‹¤.
    - ì¼ë°˜ì ìœ¼ë¡œ @Componentë¥¼ ì‚¬ìš©í•˜ì—¬ Beanì„ ìë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
        - í”„ë¡œì íŠ¸ì˜ ê·œëª¨ê°€ ì»¤ì§ˆ ìˆ˜ë¡ ë“±ë¡í•  Beanë“¤ì´ ë§ì•„ì§€ê¸° ë•Œë¬¸ì— ìë™ë“±ë¡ì„ ì‚¬ìš©í•˜ë©´ í¸ë¦¬í•©ë‹ˆë‹¤.
        - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ê´€ë ¨ëœ í´ë˜ìŠ¤ë“¤ì€ ê·¸ ìˆ˜ê°€ ë§ê¸° ë•Œë¬¸ì— @Controller, @Serviceì™€ ê°™ì€ ì• ë„ˆí…Œì´ì…˜ë“¤ì„ ì‚¬ìš©í•´ì„œ Beanìœ¼ë¡œ ë“±ë¡í•˜ê³  ê´€ë¦¬í•˜ë©´ ê°œë°œ ìƒì‚°ì„±ì— ìœ ë¦¬í•©ë‹ˆë‹¤.
    - ê·¸ë ‡ë‹¤ë©´ Bean ìˆ˜ë™ ë“±ë¡ì€ ì–¸ì œ ì‚¬ìš©ë ê¹Œìš”?
    - ê¸°ìˆ ì ì¸ ë¬¸ì œë‚˜ ê³µí†µì ì¸ ê´€ì‹¬ì‚¬ë¥¼ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ë“¤ì„ ìˆ˜ë™ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
        - ê³µí†µ ë¡œê·¸ì²˜ë¦¬ì™€ ê°™ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì§€ì›í•˜ê¸° ìœ„í•œ ë¶€ê°€ ì ì´ê³  ê³µí†µì ì¸ ê¸°ëŠ¥ë“¤ì„ ê¸°ìˆ  ì§€ì› Beanì´ë¼ ë¶€ë¥´ê³  ìˆ˜ë™ë“±ë¡ í•©ë‹ˆë‹¤.
        - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ Bean ë³´ë‹¤ëŠ” ê·¸ ìˆ˜ê°€ ì ê¸° ë•Œë¬¸ì— ìˆ˜ë™ìœ¼ë¡œ ë“±ë¡í•˜ê¸° ë¶€ë‹´ìŠ¤ëŸ½ì§€ ì•ŠìŠµë‹ˆë‹¤.
        - ë˜í•œ ìˆ˜ë™ë“±ë¡ëœ Beanì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ í•´ë‹¹ ìœ„ì¹˜ë¥¼ íŒŒì•…í•˜ê¸° ì‰½ë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.

- Bean ìˆ˜ë™ ë“±ë¡í•˜ëŠ” ë°©ë²•

    ```java
    @Configuration
    public class PasswordConfig {

        @Bean
        public PasswordEncoder passwordEncoder() {
            return new BCryptPasswordEncoder();
        }
    }
    ```

    - Beanìœ¼ë¡œ ë“±ë¡í•˜ê³ ìí•˜ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œë¥¼ ì„ ì–¸í•˜ê³  @Beanì„ ì„¤ì •í•©ë‹ˆë‹¤.
    - Beanì„ ë“±ë¡í•˜ëŠ” ë©”ì„œë“œê°€ ì†í•œ í•´ë‹¹ í´ë˜ìŠ¤ì— @Configurationì„ ì„¤ì •í•©ë‹ˆë‹¤.
    - Spring ì„œë²„ê°€ ëœ° ë•Œ Spring IoC ì»¨í…Œì´ë„ˆì— 'Bean'ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

        ```java
        // 1. @Bean ì„¤ì •ëœ ë©”ì„œë“œ í˜¸ì¶œ
        PasswordEncoder passwordEncoder = passwordConfig.passwordEncoder();

        // 2. Spring IoC ì»¨í…Œì´ë„ˆì— ë¹ˆ (passwordEncoder) ì €ì¥
        // passwordEncoder -> Spring IoC ì»¨í…Œì´ë„ˆ
        ```

        - 'Bean' ì´ë¦„: @Bean ì´ ì„¤ì •ëœ ë©”ì„œë“œëª…
            - public PasswordEncoder **passwordEncoder()** {..} â†’ **passwordEncoder**

- Bean ë“±ë¡í•´ë³´ê¸°
    - ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•  ë•Œ ì‚¬ìš©í•˜ëŠ” PasswordEncoderì˜ êµ¬í˜„ì²´ BCryptPasswordEncoderë¥¼ Beanìœ¼ë¡œ ìˆ˜ë™ë“±ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.
    - [ì½”ë“œ ìŠ¤ë‹ˆí«] PasswordConfig

        ```java
        package com.sparta.springauth.config;

        import org.springframework.context.annotation.Bean;
        import org.springframework.context.annotation.Configuration;
        import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
        import org.springframework.security.crypto.password.PasswordEncoder;

        @Configuration
        public class PasswordConfig {

            @Bean
            public PasswordEncoder passwordEncoder() {
                return new BCryptPasswordEncoder();
            }
        }
        ```

    - ë“±ë¡í•œ passwordEncoder â€˜Beanâ€™ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ìì—´ì„ ì•”í˜¸í™” í•´ë³´ê² ìŠµë‹ˆë‹¤.
    - [ì½”ë“œ ìŠ¤ë‹ˆí«] PasswordEncoderTest

        ```java
        package com.sparta.springauth;

        import org.junit.jupiter.api.DisplayName;
        import org.junit.jupiter.api.Test;
        import org.springframework.beans.factory.annotation.Autowired;
        import org.springframework.boot.test.context.SpringBootTest;
        import org.springframework.security.crypto.password.PasswordEncoder;

        @SpringBootTest
        public class PasswordEncoderTest {

            @Autowired
            PasswordEncoder passwordEncoder;

            @Test
            @DisplayName("ìˆ˜ë™ ë“±ë¡í•œ passwordEncoderë¥¼ ì£¼ì… ë°›ì•„ì™€ ë¬¸ìì—´ ì•”í˜¸í™”")
            void test1() {
                String password = "Robbie's password";

                // ì•”í˜¸í™”
                String encodePassword = passwordEncoder.encode(password);
                System.out.println("encodePassword = " + encodePassword);

                String inputPassword = "Robbie";

                // ë³µí˜¸í™”ë¥¼ í†µí•´ ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„êµ
                boolean matches = passwordEncoder.matches(inputPassword, encodePassword);
                System.out.println("matches = " + matches); // ì•”í˜¸í™”í•  ë•Œ ì‚¬ìš©ëœ ê°’ê³¼ ë‹¤ë¥¸ ë¬¸ìì—´ê³¼ ë¹„êµí–ˆê¸° ë•Œë¬¸ì— false
            }
        }
        ```

## 02. ê°™ì€ íƒ€ì…ì˜ Beanì´ 2ê°œë¼ë©´?

- ê°™ì€ íƒ€ì… Bean ë“±ë¡
    1. Food Interface
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] food > Food

            ```java
            package com.sparta.springauth.food;

            public interface Food {
                void eat();
            }
            ```

    2. Chicken
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] food > Chicken

            ```java
            package com.sparta.springauth.food;

            import org.springframework.stereotype.Component;

            @Component
            public class Chicken implements Food {
                @Override
                public void eat() {
                    System.out.println("ì¹˜í‚¨ì„ ë¨¹ìŠµë‹ˆë‹¤.");
                }
            }
            ```

    3. Pizza
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] food > Pizza

            ```java
            package com.sparta.springauth.food;

            import org.springframework.stereotype.Component;

            @Component
            public class Pizza implements Food {
                @Override
                public void eat() {
                    System.out.println("í”¼ìë¥¼ ë¨¹ìŠµë‹ˆë‹¤.");
                }
            }
            ```

    - Food íƒ€ì…ì˜ Bean ê°ì²´ Chicken, Pizzaë¥¼ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.

    ```java
    @SpringBootTest
    public class BeanTest {

        @Autowired
        Food food;

    }
    ```

    - í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
    - ì´ë•Œ, `Food food;` í•„ë“œì— @Autowiredë¥¼ ì‚¬ìš©í•˜ì—¬ Bean ê°ì²´ë¥¼ ì£¼ì…ë ¤ê³  ì‹œë„í•©ë‹ˆë‹¤.
    - ì£¼ì…ì„ í•  ìˆ˜ ì—†ë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
    - í•´ì„í•´ë³´ìë©´ â€œ**Food** íƒ€ì…ì˜ **Bena** ê°ì²´ê°€ **í•˜ë‚˜ ì´ìƒ** ìˆìŠµë‹ˆë‹¤. **â€œ** ë¼ê³  ì•Œë ¤ì£¼ê³  ìˆìŠµë‹ˆë‹¤.
    - ì¦‰, food í•„ë“œì— Beanì„ ì£¼ì…í•´ì¤˜ì•¼í•˜ëŠ”ë° ê°™ì€ íƒ€ì…ì˜ Bean ê°ì²´ê°€ í•˜ë‚˜ ì´ìƒì´ê¸° ë•Œë¬¸ì— ì–´ë–¤ Beanì„ ë“±ë¡í•´ì¤˜ì•¼í• ì§€ ëª°ë¼ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²ƒì…ë‹ˆë‹¤.
    - ì–´ë–»ê²Œ í•˜ë©´ ì´ë¥¼ í•´ê²°í•  ìˆ˜ ìˆì„ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.

- ë“±ë¡ëœ Bean ì´ë¦„ ëª…ì‹œí•˜ê¸°

    ```java
    @SpringBootTest
    public class BeanTest {

        @Autowired
        Food pizza;

        @Autowired
        Food chicken;

    }
    ```

    - ì´ë ‡ê²Œ ë“±ë¡ëœ Bean ì´ë¦„ pizza, chickenì„ ì •í™•í•˜ê²Œ ëª…ì‹œí•´ì£¼ë©´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - ì—¬ê¸°ì„œ ìš°ë¦¬ê°€ ì•Œ ìˆ˜ ìˆëŠ” ì ì€ @Autowiredê°€ ê¸°ë³¸ì ìœ¼ë¡œëŠ” Bean Type(Food)ìœ¼ë¡œ DIë¥¼ ì§€ì›í•˜ë©° ì—°ê²°ì´ ë˜ì§€ì•Šì„ ê²½ìš° Bean Name(pizza, chicken)ìœ¼ë¡œ ì°¾ëŠ” ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- @Primary ì‚¬ìš©í•˜ê¸°

    ```java
    @Component
    @Primary
    public class Chicken implements Food {
        @Override
        public void eat() {
            System.out.println("ì¹˜í‚¨ì„ ë¨¹ìŠµë‹ˆë‹¤.");
        }
    }
    ```

    - Chicken í´ë˜ìŠ¤ì— @Primaryë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

    ```java
    @SpringBootTest
    public class BeanTest {
        @Autowired
        Food food;
    }
    ```

    - @Primaryê°€ ì¶”ê°€ë˜ë©´ ê°™ì€ íƒ€ì…ì˜ Beanì´ ì—¬ëŸ¬ ê°œ ìˆë”ë¼ë„ ìš°ì„  @Primaryê°€ ì„¤ì •ëœ Bean ê°ì²´ë¥¼ ì£¼ì… í•´ì¤ë‹ˆë‹¤.

- @Qualifier ì‚¬ìš©í•˜ê¸°

    ```java
    @Component
    @Qualifier("pizza")
    public class Pizza implements Food {
        @Override
        public void eat() {
            System.out.println("í”¼ìë¥¼ ë¨¹ìŠµë‹ˆë‹¤.");
        }
    }
    ```

    - Pizza í´ë˜ìŠ¤ì— `@Qualifier("pizza")` ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

    ```java
    @SpringBootTest
    public class BeanTest {

        @Autowired
        @Qualifier("pizza")
        Food food;
    }
    ```

    - ì£¼ì…í•˜ê³ ìí•˜ëŠ” í•„ë“œì—ë„ `@Qualifier("pizza")` ë¥¼ ì¶”ê°€í•´ì£¼ë©´ í•´ë‹¹ Bean ê°ì²´ê°€ ì£¼ì…ë©ë‹ˆë‹¤.

    ```java
    @SpringBootTest
    public class BeanTest {

        @Autowired
        @Qualifier("pizza")
        Food food;

        @Test
        @DisplayName("Primary ì™€ Qualifier ìš°ì„ ìˆœìœ„ í™•ì¸")
        void test1() {
            // í˜„ì¬ Chicken ì€ Primary ê°€ ì ìš©ëœ ìƒíƒœ
            // PizzaëŠ” Qualifier ê°€ ì¶”ê°€ëœ ìƒíƒœì…ë‹ˆë‹¤.
            food.eat();
        }
    }
    ```

    - ê°™ì€ íƒ€ì…ì˜ Beanë“¤ì— Qualifierì™€ Primaryê°€ ë™ì‹œì— ì ìš©ë˜ì–´ìˆë‹¤ë©´ Qualifierì˜ ìš°ì„ ìˆœìœ„ê°€ ë” ë†’ìŠµë‹ˆë‹¤.
    - í•˜ì§€ë§Œ QualifierëŠ” ì ìš©í•˜ê¸° ìœ„í•´ì„œ ì£¼ì… ë°›ê³ ìí•˜ëŠ” ê³³ì— í•´ë‹¹ Qualifierë¥¼ ë°˜ë“œì‹œ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.
    - ë”°ë¼ì„œ ê°™ì€ íƒ€ì…ì˜ Beanì´ ì—¬ëŸ¬ ê°œ ìˆì„ ë•ŒëŠ” ë²”ìš©ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” Bean ê°ì²´ì—ëŠ” Primaryë¥¼ ì„¤ì •í•˜ê³  ì§€ì—½ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” Bean ê°ì²´ì—ëŠ” Qualifierë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.