# ë‚´ì¼ë°°ì›€ìº í”„ 240611 TIL
Java 41ì¼ì°¨
ã„·ã…”ì´í„° ê²€ì¦í•˜ê¸°
-------------------------------------------------------------------------------




# ë°ì´í„° ê²€ì¦í•˜ê¸°

## 14. Validation

- Validationì´ë€?

    <aside>
    ğŸ“Œ í”„ë¡œê·¸ë˜ë°ì„ í•˜ëŠ”ë°ì— ìˆì–´ì„œ ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

    - íŠ¹íˆë‚˜ JavaëŠ” null ê°’ì— ëŒ€í•œ ì ‘ê·¼ì— ëŒ€í•´ NullPointerException ì˜¤ë¥˜ê°€ ë°œí–‰í•˜ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ë¶€ë¶„ì„ ì˜ˆë°©í•˜ê¸° ìœ„í•´ Validation ì¦‰, ê²€ì¦ ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
    - Springì—ì„œëŠ” null í™•ì¸ ë¿ ì•„ë‹ˆë¼ ë¬¸ìì˜ ê¸¸ì´ ì¸¡ì •ê³¼ ê°™ì€ ë‹¤ë¥¸ ê²€ì¦ ê³¼ì •ë„ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ **Bean Validation** ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.
    </aside>

    - **Bean Validation**
        - ê°„í¸í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ì• ë„ˆí…Œì´ì…˜ì„ ì œê³µ í•´ì¤ë‹ˆë‹¤.
        - ì œê³µë˜ëŠ” ì• ë„ˆí…Œì´ì…˜ ì¼ë¶€ë¥¼ í•™ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤.


            | @NotNull | null ë¶ˆê°€ |
            | --- | --- |
            | @NotEmpty | null, â€œâ€ ë¶ˆê°€ |
            | @NotBlank | null, â€œâ€. â€œ â€œ ë¶ˆê°€ |
            | @Size | ë¬¸ì ê¸¸ì´ ì¸¡ì • |
            | @Max | ìµœëŒ€ê°’ |
            | @Min | ìµœì†Œê°’ |
            | @Positive | ì–‘ìˆ˜ |
            | @Negative | ìŒìˆ˜ |
            | @Email | E-mail í˜•ì‹ |
            | @Pattern | ì •ê·œ í‘œí˜„ì‹ |
    - í”„ë¡œì íŠ¸ ì„¤ì •
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] build.gradle : validation

            ```groovy
            implementation 'org.springframework.boot:spring-boot-starter-validation'
            ```


- Validation ì ìš©
    1. ProductRequestDto
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] ProductRequestDto

            ```java
            package com.sparta.springauth.dto;

            import jakarta.validation.constraints.*;
            import lombok.Getter;

            @Getter
            public class ProductRequestDto {
                @NotBlank
                private String name;
                @Email
                private String email;
                @Positive(message = "ì–‘ìˆ˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
                private int price;
                @Negative(message = "ìŒìˆ˜ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
                private int discount;
                @Size(min=2, max=10)
                private String link;
                @Max(10)
                private int max;
                @Min(2)
                private int min;
            }
            ```

    2. @Valid
        - **Bean Validation**ì„ ì ìš©í•œ í•´ë‹¹ Object validation ì‹¤í–‰
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] testValid

                ```java
                @PostMapping("/validation")
                @ResponseBody
                public ProductRequestDto testValid(@RequestBody @Valid ProductRequestDto requestDto) {
                    return requestDto;
                }
                ```

        - JSON ë°ì´í„°
            - [ì½”ë“œ ìŠ¤ë‹ˆí«] JSON ë°ì´í„°

                ```json
                {
                    "name" : "Robbie",
                    "email" : "Robbie@gmail.com",
                    "price" : 1234,
                    "discount" : -1234,
                    "link" : "54321",
                    "max" : 10,
                    "min" : 2
                }
                ```



## 15. Validation ì˜ˆì™¸ì²˜ë¦¬

- íšŒì›ê°€ì… ì ìš©
    1. SignupRequestDto
        - [ì½”ë“œ ìŠ¤ë‹ˆí«] SignupRequestDto

            ```java
            package com.sparta.springauth.dto;

            import jakarta.validation.constraints.Email;
            import jakarta.validation.constraints.NotBlank;
            import lombok.Getter;
            import lombok.Setter;

            @Getter
            @Setter
            public class SignupRequestDto {
                @NotBlank
                private String username;
                @NotBlank
                private String password;
                @Email
                @NotBlank
                private String email;
                private boolean admin = false;
                private String adminToken = "";
            }
            ```

    2. UserController : signupì— `@Valid` ì ìš©

        ```java
        @PostMapping("/user/signup")
        public String signup(@Valid SignupRequestDto requestDto) {
            userService.signup(requestDto);

            return "redirect:/api/user/login-page";
        }
        ```

- Validation ì˜ˆì™¸ì²˜ë¦¬
    - íšŒì›ê°€ì… ì§„í–‰ ì‹œ ë°ì´í„° ê²€ì¦ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œ ë¡œê·¸ì¸ í˜ì´ì§€ê°€ ì•„ë‹ˆë¼ íšŒì›ê°€ì… í˜ì´ì§€ë¡œ ì´ë™ í•˜ë ¤ë©´ Validation ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•´ì•¼í•©ë‹ˆë‹¤.


    - **BindingResult**
        - ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ BindingResult ê°ì²´ì— ì˜¤ë¥˜ì— ëŒ€í•œ ì •ë³´ê°€ ë‹´ê¹ë‹ˆë‹¤.
        - íŒŒë¼ë¯¸í„°ë¡œ BindingResult ê°ì²´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        ```java
        @PostMapping("/user/signup")
        public String signup(@Valid SignupRequestDto requestDto, BindingResult bindingResult) {
            // Validation ì˜ˆì™¸ì²˜ë¦¬
            List<FieldError> fieldErrors = bindingResult.getFieldErrors();
            if(fieldErrors.size() > 0) {
                for (FieldError fieldError : bindingResult.getFieldErrors()) {
                    log.error(fieldError.getField() + " í•„ë“œ : " + fieldError.getDefaultMessage());
                }
                return "redirect:/api/user/signup";
            }

            userService.signup(requestDto);

            return "redirect:/api/user/login-page";
        }
        ```

        - [ì½”ë“œ ìŠ¤ë‹ˆí«] UserController

            ```java
            package com.sparta.springauth.controller;

            import com.sparta.springauth.dto.LoginRequestDto;
            import com.sparta.springauth.dto.SignupRequestDto;
            import com.sparta.springauth.service.UserService;
            import jakarta.servlet.http.HttpServletResponse;
            import jakarta.validation.Valid;
            import lombok.extern.slf4j.Slf4j;
            import org.springframework.stereotype.Controller;
            import org.springframework.validation.BindingResult;
            import org.springframework.validation.FieldError;
            import org.springframework.web.bind.annotation.GetMapping;
            import org.springframework.web.bind.annotation.PostMapping;
            import org.springframework.web.bind.annotation.RequestMapping;

            import java.util.List;

            @Slf4j
            @Controller
            @RequestMapping("/api")
            public class UserController {

                private final UserService userService;

                public UserController(UserService userService) {
                    this.userService = userService;
                }

                @GetMapping("/user/login-page")
                public String loginPage() {
                    return "login";
                }

                @GetMapping("/user/signup")
                public String signupPage() {
                    return "signup";
                }

                @PostMapping("/user/signup")
                public String signup(@Valid SignupRequestDto requestDto, BindingResult bindingResult) {
                    // Validation ì˜ˆì™¸ì²˜ë¦¬
                    List<FieldError> fieldErrors = bindingResult.getFieldErrors();
                    if(fieldErrors.size() > 0) {
                        for (FieldError fieldError : bindingResult.getFieldErrors()) {
                            log.error(fieldError.getField() + " í•„ë“œ : " + fieldError.getDefaultMessage());
                        }
                        return "redirect:/api/user/signup";
                    }

                    userService.signup(requestDto);

                    return "redirect:/api/user/login-page";
                }
            }
            ```

        - `bindingResult.getFieldErrors()`
            - ë°œìƒí•œ ì˜¤ë¥˜ë“¤ì— ëŒ€í•œ ì •ë³´ê°€ ë‹´ê¸´ `List<FieldError>` ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.